"use strict";(globalThis["webpackChunktbls"]=globalThis["webpackChunktbls"]||[]).push([[156],{1627:(e,l,t)=>{t.r(l),t.d(l,{default:()=>N});t(310),t(5962);var a=t(1758),o=t(6683),r=t(2901);const n={class:"q-mt-md"},i={class:"q-pa-sm flex flex-center"},u={class:"q-pa-sm flex flex-center"},d={class:"row items-center justify-end"};function s(e,l,t,s,c,m){const p=(0,a.g2)("q-tooltip"),b=(0,a.g2)("q-btn"),_=(0,a.g2)("q-btn-group"),g=(0,a.g2)("q-space"),k=(0,a.g2)("q-icon"),v=(0,a.g2)("q-input"),w=(0,a.g2)("q-td"),f=(0,a.g2)("EditableCell"),h=(0,a.g2)("q-tr"),y=(0,a.g2)("q-table"),F=(0,a.g2)("q-pagination"),V=(0,a.g2)("q-bar"),x=(0,a.g2)("q-date"),C=(0,a.g2)("q-popup-proxy"),D=(0,a.g2)("q-card-section"),A=(0,a.g2)("q-card-actions"),q=(0,a.g2)("q-card"),K=(0,a.g2)("q-dialog"),I=(0,a.g2)("view-dialog"),$=(0,a.gN)("close-popup");return(0,a.uX)(),(0,a.CE)("div",n,[(0,a.bF)(o.eB,{appear:"","enter-active-class":"animated fadeIn"},{default:(0,a.k6)((()=>[(0,a.bF)(y,{separator:"cell",class:"my-sticky-header-column-table shadow-24",rows:s.paginatedRows,"row-key":"id",loading:s.loading,filter:s.filter,columns:s.columns,"hide-bottom":"",pagination:s.pagination,"onUpdate:pagination":l[5]||(l[5]=e=>s.pagination=e),paginationModifiers:{sync:!0},"no-data-label":"No data","no-results-label":"No data you want",style:{height:"calc(100vh - 200px)","max-height":"calc(100vh - 200px)"},flat:"",bordered:""},{top:(0,a.k6)((()=>[(0,a.bF)(_,{push:""},{default:(0,a.k6)((()=>[(0,a.bF)(b,{label:e.$t("new"),icon:"sym_r_add",onClick:l[0]||(l[0]=e=>s.newForm=!0)},{default:(0,a.k6)((()=>[(0,a.bF)(p,(0,r._B)((0,a.Ng)(s.tooltip)),{default:(0,a.k6)((()=>[(0,a.eW)((0,r.v_)(e.$t("newtip")),1)])),_:1},16)])),_:1},8,["label"]),(0,a.bF)(b,{label:e.$t("refresh"),icon:"sym_r_refresh",onClick:s.reFresh},{default:(0,a.k6)((()=>[(0,a.bF)(p,(0,r._B)((0,a.Ng)(s.tooltip)),{default:(0,a.k6)((()=>[(0,a.eW)((0,r.v_)(e.$t("refreshtip")),1)])),_:1},16)])),_:1},8,["label","onClick"])])),_:1}),(0,a.bF)(g),(0,a.bF)(v,{outlined:"",rounded:"",dense:"",debounce:"300",color:"primary",modelValue:s.filter,"onUpdate:modelValue":l[2]||(l[2]=e=>s.filter=e),placeholder:e.$t("search"),onInput:l[3]||(l[3]=e=>s.getSearchList()),onKeyup:l[4]||(l[4]=(0,o.jR)((e=>s.getSearchList()),["enter"]))},{append:(0,a.k6)((()=>[(0,a.bF)(k,{name:"sym_r_search",onClick:l[1]||(l[1]=e=>s.getSearchList())})])),_:1},8,["modelValue","placeholder"])])),body:(0,a.k6)((e=>[(0,a.bF)(h,{props:e},{default:(0,a.k6)((()=>[(0,a.bF)(w,{key:"code",props:e},{default:(0,a.k6)((()=>[(0,a.eW)((0,r.v_)(e.row.code),1)])),_:2},1032,["props"]),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(s.editableColumns,(l=>((0,a.uX)(),(0,a.Wv)(f,{key:l.field,row:e.row,field:l.field,label:l.label,rules:l.rules,mask:l.mask,"edit-id":s.editId,"model-value":e.row.id===s.editId?s.editFormData[l.field]:e.row[l.field],dateField:l.dateField||!1,translate:l.translate||!1,options:l.options||[],"options-label":l.optionsLabel||"label","options-value":l.optionsValue||"value","onUpdate:modelValue":e=>s.editFormData[l.field]=e,props:e},null,8,["row","field","label","rules","mask","edit-id","model-value","dateField","translate","options","options-label","options-value","onUpdate:modelValue","props"])))),128)),(0,a.bF)(w,{key:"sail_count",props:e},{default:(0,a.k6)((()=>[(0,a.eW)((0,r.v_)(e.row.sail_count),1)])),_:2},1032,["props"]),(0,a.bF)(w,{key:"creator",props:e},{default:(0,a.k6)((()=>[(0,a.eW)((0,r.v_)(e.row.creator),1)])),_:2},1032,["props"]),(0,a.bF)(w,{key:"create_time",props:e},{default:(0,a.k6)((()=>[(0,a.eW)((0,r.v_)(e.row.create_time),1)])),_:2},1032,["props"]),(0,a.bF)(w,{key:"action",props:e,style:(0,r.Tr)([{width:"100px"},s.actionCellStyle(e)])},{default:(0,a.k6)((()=>[e.row.id!==s.editId?((0,a.uX)(!0),(0,a.CE)(a.FK,{key:0},(0,a.pI)(s.rowActions,(l=>((0,a.uX)(),(0,a.Wv)(b,(0,a.v6)({key:l.icon,ref_for:!0},l,{onClick:t=>l.action(e.row)}),{default:(0,a.k6)((()=>[(0,a.bF)(p,(0,a.v6)({ref_for:!0},s.tooltip),{default:(0,a.k6)((()=>[(0,a.eW)((0,r.v_)(l.tip),1)])),_:2},1040)])),_:2},1040,["onClick"])))),128)):((0,a.uX)(!0),(0,a.CE)(a.FK,{key:1},(0,a.pI)(s.editActions,(e=>((0,a.uX)(),(0,a.Wv)(b,(0,a.v6)({key:e.icon,ref_for:!0},e,{onClick:e.action}),null,16,["onClick"])))),128))])),_:2},1032,["props","style"])])),_:2},1032,["props"])])),_:1},8,["rows","loading","filter","columns","pagination"])])),_:1}),(0,a.bo)((0,a.Lk)("div",i,[(0,a.bF)(F,{modelValue:s.current,"onUpdate:modelValue":[l[6]||(l[6]=e=>s.current=e),l[7]||(l[7]=e=>s.paginationIpt=e)],max:s.max,"max-pages":10,"boundary-links":"",color:"red-8"},null,8,["modelValue","max"]),(0,a.bF)(v,{modelValue:s.paginationIpt,"onUpdate:modelValue":l[8]||(l[8]=e=>s.paginationIpt=e),modelModifiers:{number:!0},outlined:"",round:"",dense:"",color:"red-8",onBlur:s.changePageEnter,onKeyup:(0,o.jR)(s.changePageEnter,["enter"]),style:{width:"50px"},class:"center"},null,8,["modelValue","onBlur","onKeyup"])],512),[[o.aG,s.max]]),(0,a.bo)((0,a.Lk)("div",u,[(0,a.bF)(b,{flat:"",push:"",color:"darkText",label:e.$t("no_data")},null,8,["label"])],512),[[o.aG,!s.max]]),(0,a.bF)(K,{modelValue:s.newForm,"onUpdate:modelValue":l[16]||(l[16]=e=>s.newForm=e),"transition-show":"slide-up","transition-hide":"slide-down"},{default:(0,a.k6)((()=>[(0,a.bF)(q,{class:"shadow-24 column no-wrap",style:{"max-height":"90vh","max-width":"400px",width:"90vw"}},{default:(0,a.k6)((()=>[(0,a.bF)(V,{class:"bg-primary text-white rounded-borders",style:{height:"50px"}},{default:(0,a.k6)((()=>[(0,a.eW)((0,r.v_)(e.$t("truck.view_truck.create_truck"))+" ",1),(0,a.bF)(g),(0,a.bo)((0,a.bF)(b,{dense:"",flat:"",icon:"sym_r_close"},null,512),[[$]])])),_:1}),(0,a.bF)(D,{class:"scroll custom-scrollbar-color",style:{"overflow-y":"auto",flex:"1"}},{default:(0,a.k6)((()=>[(0,a.bF)(v,{dense:"",outlined:"",square:"",modelValue:s.newFormData.truck_number,"onUpdate:modelValue":l[9]||(l[9]=e=>s.newFormData.truck_number=e),label:e.$t("truck.view_truck.truck_number"),rules:[s.validateTruckNumber],"lazy-rules":"",autofocus:"",maxlength:"10"},null,8,["modelValue","label","rules"]),(0,a.bF)(v,{dense:"",outlined:"",square:"",modelValue:s.newFormData.model,"onUpdate:modelValue":l[10]||(l[10]=e=>s.newFormData.model=e),type:"number",min:"1980",max:"2200",label:e.$t("truck.view_truck.model"),rules:[s.validateTruckModel],"lazy-rules":""},null,8,["modelValue","label","rules"]),(0,a.bF)(v,{dense:"",outlined:"",square:"",modelValue:s.newFormData.color,"onUpdate:modelValue":l[11]||(l[11]=e=>s.newFormData.color=e),label:e.$t("truck.view_truck.color"),rules:[s.validateStringValue],"lazy-rules":""},null,8,["modelValue","label","rules"]),(0,a.bF)(v,{dense:"",outlined:"",square:"",modelValue:s.newFormData.wheels,"onUpdate:modelValue":l[12]||(l[12]=e=>s.newFormData.wheels=e),label:e.$t("truck.view_truck.wheels"),rules:[s.validateIntValue],hint:e.$t("truck.view_truck.wheels_hint"),mask:"##","lazy-rules":""},null,8,["modelValue","label","rules","hint"]),(0,a.bF)(v,{dense:"",outlined:"",square:"",modelValue:s.newFormData.engine_type,"onUpdate:modelValue":l[13]||(l[13]=e=>s.newFormData.engine_type=e),label:e.$t("truck.view_truck.engine_type"),rules:[s.validateStringValue],"lazy-rules":"",maxlength:"20",hint:e.$t("truck.view_truck.engine_type_hint")},null,8,["modelValue","label","rules","hint"]),(0,a.bF)(v,{outlined:"",modelValue:s.newFormData.license_expiration_date,"onUpdate:modelValue":l[15]||(l[15]=e=>s.newFormData.license_expiration_date=e),label:e.$t("truck.view_truck.license_expd"),dense:"",mask:"date","lazy-rules":"",rules:["date"]},{append:(0,a.k6)((()=>[(0,a.bF)(k,{name:"sym_r_event",class:"cursor-pointer"},{default:(0,a.k6)((()=>[(0,a.bF)(C,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.k6)((()=>[(0,a.bF)(x,{modelValue:s.newFormData.license_expiration_date,"onUpdate:modelValue":l[14]||(l[14]=e=>s.newFormData.license_expiration_date=e)},{default:(0,a.k6)((()=>[(0,a.Lk)("div",d,[(0,a.bo)((0,a.bF)(b,{unelevated:"",label:"Close",color:"primary",flat:""},null,512),[[$]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue","label"])])),_:1}),(0,a.bF)(A,{align:"right"},{default:(0,a.k6)((()=>[(0,a.bo)((0,a.bF)(b,{flat:"",label:s.t("cancel"),onClick:s.resetNewForm},null,8,["label","onClick"]),[[$]]),(0,a.bF)(b,{color:"primary",label:s.t("submit"),disable:!s.isNewFormValid,onClick:s.newDataSubmit},null,8,["label","disable","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.bF)(I,{modelValue:s.viewDialog,"onUpdate:modelValue":l[17]||(l[17]=e=>s.viewDialog=e),data:s.viewDataForm,title:e.$t("truck.view_truck.view_truck_tip")},null,8,["modelValue","data","title"]),(0,a.bF)(K,{modelValue:s.deleteForm,"onUpdate:modelValue":l[18]||(l[18]=e=>s.deleteForm=e)},{default:(0,a.k6)((()=>[(0,a.bF)(q,{class:"shadow-24",style:{"max-width":"350px",width:"100%"}},{default:(0,a.k6)((()=>[(0,a.bF)(V,{style:{height:"50px"},class:"bg-primary text-white"},{default:(0,a.k6)((()=>[(0,a.eW)((0,r.v_)(e.$t("delete"))+" ",1),(0,a.bF)(g),(0,a.bo)(((0,a.uX)(),(0,a.Wv)(b,{dense:"",flat:"",icon:"sym_r_close"},{default:(0,a.k6)((()=>[(0,a.bF)(p,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,r.v_)(e.$t("index.close")),1)])),_:1})])),_:1})),[[$]])])),_:1}),(0,a.bF)(D,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,r.v_)(e.$t("deletetip")),1)])),_:1}),(0,a.bF)(A,{align:"right"},{default:(0,a.k6)((()=>[(0,a.bF)(b,{flat:"",label:s.t("cancel"),onClick:s.resetDelete},null,8,["label","onClick"]),(0,a.bF)(b,{color:"primary",label:s.t("delete"),onClick:s.deleteDataSubmit},null,8,["label","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])}t(95),t(6724),t(9240);var c=t(2261),m=t(1271),p=t(4907),b=t(555),_=t(3537),g=t(5677),k=t(9571),v=t(7144);const w={name:"PageTruckList",components:{EditableCell:g.A,ViewDialog:k.A},setup(){const{t:e}=(0,_.s9)(),l=(0,p.A)(),t="truck",o=(0,b.KR)(!1),r=(0,b.KR)(m.A.getItem("userRole")),n=(0,b.KR)(m.A.getItem(t)||[]),i=(0,b.KR)(""),u=(0,b.KR)(1),d=(0,b.KR)(25),s=(0,b.KR)({page:1,rowsPerPage:d.value}),g=(0,b.KR)(1),k=(0,a.EW)((()=>{if(!i.value)return n.value;const e=i.value.toLowerCase();return n.value.filter((l=>Object.values(l).some((l=>l?.toString().toLowerCase().includes(e)))))})),w=(0,a.EW)((()=>{const e=(u.value-1)*d.value;return k.value.slice(e,e+d.value)})),f=(0,a.EW)((()=>Math.ceil(k.value.length/d.value))),h=(0,b.KR)(!1),y=(0,b.Kh)({truck_number:"",model:"",color:"",wheels:"",engine_type:"",license_expiration_date:""}),F=(0,b.Kh)({}),V=(0,b.KR)(0),x=(0,b.Kh)({}),C=(0,b.KR)(!1),D=(0,b.KR)(!1),A=(0,b.KR)(0),q=(0,b.KR)(!1),K=(0,b.Kh)({}),I={class:"bg-blue text-white shadow-4",offset:[10,10],contentStyle:"font-size: 12px"},$=l=>{const t=/^\d[A-Z]\/\d{4}$/;return t.test(l)||e("error.invalidtruckformat")},S=l=>{const t=/^\d{4}$/;return t.test(l)||e("error.invalidmodelformat")},E=l=>!!l||e("error.input.enterValue"),W=l=>l>0||e("error.input.enterValue"),R=l=>!!l||e("error.input.dateValue"),Q=(0,a.EW)((()=>!0===$(x.truck_number)&&!0===S(x.model)&&!0===E(x.color)&&!0===W(x.wheels)&&!0===E(x.engine_type)&&!0===R(x.license_expiration_date))),L=(0,a.EW)((()=>!0===$(y.truck_number)&&!0===S(y.model)&&!0===E(y.color)&&!0===W(y.wheels)&&!0===E(y.engine_type)&&!0===R(y.license_expiration_date))),U=()=>{const e=Math.min(Math.max(Number(g.value),1),f.value||1);u.value=g.value=e},T=async()=>{if(i.value){const e=i.value.toLowerCase();n.value=m.A.getItem(t).filter((l=>Object.values(l).some((l=>l&&l.toString().toLowerCase().includes(e)))))}else n.value=m.A.getItem(t);u.value=1,g.value=1},j=async()=>{o.value=!0,M(),await(0,v.e7)(t),n.value=m.A.getItem(t)||[],o.value=!1},N=async()=>{o.value=!0,P(),M(),await j(),o.value=!1},z=async()=>{if(!L.value)return l.notify({message:e("error.data_invalid"),icon:"sym_r_close",color:"negative"}),void l.loading.hide();try{console.log(y);const a=await(0,c.postauth)(t+"/",y);if("200"!==a.code)throw new Error;await j(),P(),l.notify({message:e("successful.create"),color:"green"})}catch{l.notify({message:e("error.data_invalid"),color:"negative"})}finally{l.loading.hide()}},P=()=>{for(const e in y)y[e]="";h.value=!1},O=e=>{C.value=!0,V.value=e.id,Object.assign(x,e),Object.assign(F,e)},B=async()=>{if(!Q.value)return void l.notify({message:e("error.data_invalid"),icon:"sym_r_close",color:"negative"});console.log(x);const a=Object.fromEntries(Object.entries(x).filter((([e,l])=>l!==F[e])));if(!Object.keys(a).length)return l.notify({message:e("warning.no_changes"),color:"warning"});try{l.loading.show();const o=await(0,c.patchauth)(`${t}/${V.value}/`,a);if("200"!==o.code)throw new Error;await j(),n.value=m.A.getItem(t),l.notify({message:e("successful.update"),color:"green"})}catch{l.notify({message:e("error.updateFailed"),color:"negative"})}finally{l.loading.hide()}},M=()=>{C.value=!1,V.value=0,Object.keys(x).forEach((e=>delete x[e]))},X=e=>{q.value=!0,Object.assign(K,e),delete K.id,delete K.create_time,delete K.creator,delete K.update_time},G=e=>{D.value=!0,A.value=e},Z=async()=>{try{l.loading.show();const a=await(0,c.deleteauth)(`${t}/${A.value}/`);if(H(),"200"!==a.code)throw new Error;l.notify({message:e("successful.delete"),icon:"sym_r_check"}),await(0,v.e7)(t),n.value=m.A.getItem(t)}catch{l.notify({message:e("error.delete"),icon:"sym_r_close"})}finally{l.loading.hide()}},H=()=>{D.value=!1,A.value=0},J=e=>C.value&&e.row.id===V.value?{backgroundColor:"#cbc6d2"}:{},Y=[{round:!0,flat:!0,push:!0,color:"green",icon:"sym_r_check",action:B},{round:!0,flat:!0,push:!0,color:"red",icon:"sym_r_close",action:M}],ee=(0,b.Kh)([{field:"truck_number",label:e("truck.view_truck.truck_number"),rules:[$],truncate:!1},{field:"model",label:e("truck.view_truck.model"),rules:[S]},{field:"color",label:e("truck.view_truck.color"),rules:[E],truncate:!0,truncateLength:20},{field:"wheels",label:e("truck.view_truck.wheels"),rules:[W],truncate:!1,mask:"##"},{field:"engine_type",label:e("truck.view_truck.engine_type"),rules:[E],truncate:!0,truncateLength:30},{field:"license_expiration_date",label:e("truck.view_truck.license_expiration_date"),rules:[R],dateField:!0}]),le=[{round:!0,flat:!0,push:!0,color:"amber-2",icon:"sym_r_visibility",tip:e("index.view_detail"),action:X},{round:!0,flat:!0,push:!0,color:"amber-4",icon:"sym_r_edit",tip:e("edit"),action:O},{round:!0,flat:!0,push:!0,color:"amber-13",icon:"sym_r_delete",tip:e("delete"),action:e=>G(e.id)}],te=l=>{const t=[{name:"code",label:e("truck.view_truck.code"),field:"code",align:"center",sortable:!0},{name:"truck_number",label:e("truck.view_truck.truck_number"),field:"truck_number",align:"center"},{name:"model",label:e("truck.view_truck.model"),field:"model",align:"center",sortable:!0},{name:"color",label:e("truck.view_truck.color"),field:"color",align:"center"},{name:"wheels",label:e("truck.view_truck.wheels"),field:"wheels",align:"center",sortable:!0},{name:"engine_type",label:e("truck.view_truck.engine_type"),field:"engine_type",align:"center",sortable:!0},{name:"license_expiration_date",label:e("truck.view_truck.license_expiration_date"),field:"license_expiration_date",align:"center"}],a=[{name:"sail_count",label:e("truck.view_truck.sail_count"),field:"sail_count",align:"left"},{name:"creator",label:e("creator"),field:"creator",align:"left"},{name:"create_time",label:e("createtime"),field:"create_time",align:"left"}],o={name:"action",label:e("action"),align:"center"};return[...t.map((e=>({...e,headerStyle:"font-weight: bold; font-size: 13px"}))),..."Admin"===l?a.map((e=>({...e,headerStyle:"font-weight: bold; font-size: 13px"}))):[],{...o,headerStyle:"font-weight: bold; font-size: 13px"}]},ae=(0,b.Kh)(te(r.value));return(0,a.sV)((()=>{n.value.length||N()})),{pathname:t,loading:o,tableList:n,filter:i,pagination:s,newForm:h,newFormData:y,editId:V,editFormData:x,editMode:C,deleteForm:D,deleteId:A,viewDialog:q,viewDataForm:K,current:u,max:f,paginationIpt:g,isEditFormValid:Q,isNewFormValid:L,changePageEnter:U,getSearchList:T,reFresh:N,newDataSubmit:z,editData:O,editDataSubmit:B,editDataCancel:M,deleteData:G,deleteDataSubmit:Z,columns:ae,t:e,q:l,validateTruckNumber:$,validateTruckModel:S,validateStringValue:E,validateIntValue:W,validateDate:R,actionCellStyle:J,editActions:Y,rowActions:le,editableColumns:ee,resetNewForm:P,resetDelete:H,paginatedRows:w,tooltip:I}}};var f=t(2807),h=t(6653),y=t(6031),F=t(6384),V=t(7410),x=t(3676),C=t(9270),D=t(492),A=t(4488),q=t(5262),K=t(4700),I=t(2156),$=t(3316),S=t(8670),E=t(4189),W=t(1356),R=t(8462),Q=t(2669),L=t(8672),U=t(8582),T=t.n(U);const j=(0,f.A)(w,[["render",s]]),N=j;T()(w,"components",{QTable:h.A,QBtnGroup:y.A,QBtn:F.A,QTooltip:V.A,QSpace:x.A,QInput:C.A,QIcon:D.A,QTr:A.A,QTd:q.A,QPagination:K.A,QDialog:I.A,QCard:$.A,QBar:S.A,QCardSection:E.A,QPopupProxy:W.A,QDate:R.A,QCardActions:Q.A}),T()(w,"directives",{ClosePopup:L.A})}}]);