"use strict";(globalThis["webpackChunktbls"]=globalThis["webpackChunktbls"]||[]).push([[602],{7931:(e,o,a)=>{a.r(o),a.d(o,{default:()=>T});a(310),a(5962);var l=a(1758),t=a(6683),i=a(2901);const n={class:"q-mt-md"},s={class:"q-pa-sm flex flex-center"},d={class:"q-pa-sm flex flex-center"};function r(e,o,a,r,u,g){const c=(0,l.g2)("q-tooltip"),p=(0,l.g2)("q-btn"),m=(0,l.g2)("q-btn-group"),b=(0,l.g2)("q-space"),_=(0,l.g2)("q-icon"),w=(0,l.g2)("q-input"),v=(0,l.g2)("q-td"),h=(0,l.g2)("EditableCell"),f=(0,l.g2)("q-tr"),y=(0,l.g2)("q-table"),F=(0,l.g2)("q-pagination"),k=(0,l.g2)("q-bar"),V=(0,l.g2)("q-select"),C=(0,l.g2)("q-card-section"),x=(0,l.g2)("q-card-actions"),D=(0,l.g2)("q-card"),A=(0,l.g2)("q-dialog"),q=(0,l.g2)("view-dialog"),K=(0,l.gN)("close-popup");return(0,l.uX)(),(0,l.CE)("div",n,[(0,l.bF)(t.eB,{appear:"","enter-active-class":"animated fadeIn"},{default:(0,l.k6)((()=>[(0,l.bF)(y,{separator:"cell",class:"my-sticky-header-column-table shadow-24",rows:r.paginatedRows,"row-key":"id",loading:r.loading,filter:r.filter,columns:r.columns,"hide-bottom":"",pagination:r.pagination,"onUpdate:pagination":o[6]||(o[6]=e=>r.pagination=e),paginationModifiers:{sync:!0},"no-data-label":"No data","no-results-label":"No data you want",style:{height:"calc(100vh - 190px)"},flat:"",bordered:""},{top:(0,l.k6)((()=>[(0,l.bF)(m,{push:""},{default:(0,l.k6)((()=>[(0,l.bF)(p,{label:e.$t("new"),icon:"sym_r_add",onClick:o[0]||(o[0]=e=>r.newForm=!0)},{default:(0,l.k6)((()=>[(0,l.bF)(c,(0,i._B)((0,l.Ng)(r.tooltip)),{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.$t("newtip")),1)])),_:1},16)])),_:1},8,["label"]),(0,l.bF)(p,{label:e.$t("refresh"),icon:"sym_r_refresh",onClick:o[1]||(o[1]=e=>r.fetchTableData())},{default:(0,l.k6)((()=>[(0,l.bF)(c,(0,i._B)((0,l.Ng)(r.tooltip)),{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.$t("refreshtip")),1)])),_:1},16)])),_:1},8,["label"])])),_:1}),(0,l.bF)(b),(0,l.bF)(w,{outlined:"",rounded:"",dense:"",debounce:"600",color:"primary",modelValue:r.filter,"onUpdate:modelValue":o[3]||(o[3]=e=>r.filter=e),placeholder:e.$t("search"),onInput:o[4]||(o[4]=e=>r.getSearchList()),onKeyup:o[5]||(o[5]=(0,t.jR)((e=>r.getSearchList()),["enter"]))},{append:(0,l.k6)((()=>[(0,l.bF)(_,{name:"sym_r_search",onClick:o[2]||(o[2]=e=>r.getSearchList())})])),_:1},8,["modelValue","placeholder"])])),body:(0,l.k6)((e=>[(0,l.bF)(f,{props:e},{default:(0,l.k6)((()=>[(0,l.bF)(v,{key:"code",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.row.code),1)])),_:2},1032,["props"]),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.editableColumns,(o=>((0,l.uX)(),(0,l.Wv)(h,{key:o.field,row:e.row,field:o.field,label:o.label,rules:o.rules,mask:o.mask,"edit-id":r.editId,"model-value":e.row.id===r.editId?r.editFormData[o.field]:e.row[o.field],translate:o.translate||!1,options:o.options||[],"options-label":o.optionsLabel||"label","options-value":o.optionsValue||"value","onUpdate:modelValue":e=>r.editFormData[o.field]=e,props:e},null,8,["row","field","label","rules","mask","edit-id","model-value","translate","options","options-label","options-value","onUpdate:modelValue","props"])))),128)),(0,l.bF)(v,{key:"creator",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.row.creator),1)])),_:2},1032,["props"]),(0,l.bF)(v,{key:"create_time",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.row.create_time),1)])),_:2},1032,["props"]),(0,l.bF)(v,{key:"action",props:e,style:(0,i.Tr)([{width:"100px"},r.actionCellStyle(e)])},{default:(0,l.k6)((()=>[e.row.id!==r.editId?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:0},(0,l.pI)(r.rowActions,(o=>((0,l.uX)(),(0,l.Wv)(p,(0,l.v6)({key:o.icon,ref_for:!0},o,{onClick:a=>o.action(e.row)}),{default:(0,l.k6)((()=>[(0,l.bF)(c,(0,l.v6)({ref_for:!0},r.tooltip),{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(o.tip),1)])),_:2},1040)])),_:2},1040,["onClick"])))),128)):((0,l.uX)(!0),(0,l.CE)(l.FK,{key:1},(0,l.pI)(r.editActions,(e=>((0,l.uX)(),(0,l.Wv)(p,(0,l.v6)({key:e.icon,ref_for:!0},e,{onClick:e.action}),null,16,["onClick"])))),128))])),_:2},1032,["props","style"])])),_:2},1032,["props"])])),_:1},8,["rows","loading","filter","columns","pagination"])])),_:1}),(0,l.bo)((0,l.Lk)("div",s,[(0,l.bF)(F,{modelValue:r.current,"onUpdate:modelValue":[o[7]||(o[7]=e=>r.current=e),o[8]||(o[8]=e=>r.paginationIpt=e)],max:r.max,"max-pages":10,"boundary-links":"",color:"red-8"},null,8,["modelValue","max"]),(0,l.bF)(w,{modelValue:r.paginationIpt,"onUpdate:modelValue":o[9]||(o[9]=e=>r.paginationIpt=e),modelModifiers:{number:!0},outlined:"",round:"",dense:"",color:"red-8",onBlur:r.changePageEnter,onKeyup:(0,t.jR)(r.changePageEnter,["enter"]),style:{width:"50px"},class:"center"},null,8,["modelValue","onBlur","onKeyup"])],512),[[t.aG,r.max]]),(0,l.bo)((0,l.Lk)("div",d,[(0,l.bF)(p,{flat:"",push:"",color:"darkText",label:e.$t("no_data")},null,8,["label"])],512),[[t.aG,!r.max]]),(0,l.bF)(A,{modelValue:r.newForm,"onUpdate:modelValue":o[17]||(o[17]=e=>r.newForm=e),"transition-show":"slide-up","transition-hide":"slide-down"},{default:(0,l.k6)((()=>[(0,l.bF)(D,{class:"shadow-24 column no-wrap custom-scrollbar-color",style:{"max-height":"90vh","max-width":"400px",width:"90vw"}},{default:(0,l.k6)((()=>[(0,l.bF)(k,{class:"bg-primary text-white rounded-borders",style:{height:"50px"}},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.$t("goods.view_goods.create_goods"))+" ",1),(0,l.bF)(b),(0,l.bo)((0,l.bF)(p,{dense:"",flat:"",icon:"sym_r_close"},null,512),[[K]])])),_:1}),(0,l.bF)(C,{class:"scroll",style:{"overflow-y":"auto",flex:"1"}},{default:(0,l.k6)((()=>[(0,l.bF)(w,{dense:"",outlined:"",modelValue:r.newFormData.name,"onUpdate:modelValue":o[10]||(o[10]=e=>r.newFormData.name=e),label:e.$t("goods.view_goods.name"),rules:[r.validate.required],autofocus:"",maxlength:"255"},null,8,["modelValue","label","rules"]),(0,l.bF)(w,{dense:"",outlined:"",modelValue:r.newFormData.description,"onUpdate:modelValue":o[11]||(o[11]=e=>r.newFormData.description=e),label:e.$t("goods.view_goods.description")+" (Optional)",rules:[null],type:"textarea",maxlength:"255"},null,8,["modelValue","label"]),(0,l.bF)(V,{dense:"",outlined:"",modelValue:r.newFormData.goods_type,"onUpdate:modelValue":o[12]||(o[12]=e=>r.newFormData.goods_type=e),options:r.goodsTypeList,"transition-show":"scale","transition-hide":"scale","option-value":"id","option-label":"name",label:e.$t("goods.view_goods.goods_type"),rules:[r.validate.required],onFilter:o[13]||(o[13]=(e,o)=>{o((()=>{const o=e.toLowerCase(),a=r.goodsTypeList.filter((e=>e.name.toLowerCase().includes(o)));a.length?r.newFormData.goods_type=a[0]:r.newFormData.goods_type=""}))}),"use-input":"","input-debounce":"600"},null,8,["modelValue","options","label","rules"]),(0,l.bF)(w,{dense:"",outlined:"",modelValue:r.newFormData.goods_rate,"onUpdate:modelValue":o[14]||(o[14]=e=>r.newFormData.goods_rate=e),modelModifiers:{number:!0},type:"number",label:e.$t("goods.view_goods.rate"),rules:[r.validate.intValue],maxlength:"10"},null,8,["modelValue","label","rules"]),(0,l.bF)(w,{dense:"",outlined:"",modelValue:r.newFormData.goods_weight,"onUpdate:modelValue":o[15]||(o[15]=e=>r.newFormData.goods_weight=e),modelModifiers:{number:!0},type:"number",label:e.$t("goods.view_goods.weight"),rules:[r.validate.intValue],maxlength:"10"},null,8,["modelValue","label","rules"]),(0,l.bF)(V,{dense:"",outlined:"",modelValue:r.newFormData.goods_shape,"onUpdate:modelValue":o[16]||(o[16]=e=>r.newFormData.goods_shape=e),options:r.goodsShapeList,"transition-show":"scale","transition-hide":"scale",label:e.$t("goods.view_goods.goods_shape"),rules:[r.validate.required]},null,8,["modelValue","options","label","rules"])])),_:1}),(0,l.bF)(x,{align:"right"},{default:(0,l.k6)((()=>[(0,l.bo)((0,l.bF)(p,{flat:"",label:r.t("cancel"),onClick:r.resetNewForm},null,8,["label","onClick"]),[[K]]),(0,l.bF)(p,{color:"primary",label:r.t("submit"),disable:!r.isNewFormValid,onClick:r.newDataSubmit},null,8,["label","disable","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,l.bF)(q,{modelValue:r.viewDialog,"onUpdate:modelValue":o[18]||(o[18]=e=>r.viewDialog=e),data:r.viewDataForm},null,8,["modelValue","data"]),(0,l.bF)(A,{modelValue:r.deleteForm,"onUpdate:modelValue":o[19]||(o[19]=e=>r.deleteForm=e)},{default:(0,l.k6)((()=>[(0,l.bF)(D,{class:"shadow-24",style:{"max-width":"350px",width:"100%"}},{default:(0,l.k6)((()=>[(0,l.bF)(k,{style:{height:"50px"},class:"bg-primary text-white"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.$t("delete"))+" ",1),(0,l.bF)(b),(0,l.bo)(((0,l.uX)(),(0,l.Wv)(p,{dense:"",flat:"",icon:"sym_r_close"},{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.$t("index.close")),1)])),_:1})])),_:1})),[[K]])])),_:1}),(0,l.bF)(C,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.$t("deletetip")),1)])),_:1}),(0,l.bF)(x,{align:"right"},{default:(0,l.k6)((()=>[(0,l.bF)(p,{flat:"",label:r.t("cancel"),onClick:r.resetDelete},null,8,["label","onClick"]),(0,l.bF)(p,{color:"primary",label:r.t("delete"),onClick:r.deleteDataSubmit},null,8,["label","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])}a(95),a(6724),a(9240);var u=a(2261),g=a(1271),c=a(4907),p=a(7144),m=a(555),b=a(3537),_=a(7268),w=a(5971);const v={name:"PageGoodsList",components:{EditableCell:w.A,ViewDialog:_.A},setup(){const{t:e}=(0,b.s9)(),o=(0,c.A)(),a="goods",t="goodstype",i=(0,m.KR)(!1),n=(0,m.KR)(g.A.getItem("userRole")),s=(0,m.KR)(g.A.getItem(a)||[]),d=(0,m.KR)(""),r=(0,m.KR)(1),_=(0,m.KR)(25),w=(0,m.KR)({page:1,rowsPerPage:_.value}),v=(0,m.KR)(1),h=(0,l.EW)((()=>{if(!d.value)return s.value;const e=d.value.toLowerCase();return s.value.filter((o=>Object.values(o).some((o=>o?.toString().toLowerCase().includes(e)))))})),f=(0,l.EW)((()=>{const e=(r.value-1)*_.value;return h.value.slice(e,e+_.value)})),y=(0,l.EW)((()=>Math.ceil(h.value.length/_.value))),F=(0,m.KR)(!1),k=(0,m.Kh)({name:"",description:"",goods_type:"",goods_rate:"",goods_weight:"",goods_shape:""}),V=(0,m.Kh)({}),C=(0,m.KR)(0),x=(0,m.KR)(!1),D=(0,m.Kh)({}),A=(0,m.KR)(!1),q=(0,m.KR)(0),K=(0,m.KR)(g.A.getItem(t)||[]),I=(0,m.KR)(!1),R=(0,m.Kh)({}),L="goods.view_goods.goodsRound",S="goods.view_goods.goodsRectangle",E="goods.view_goods.goodsIrregular",$=(0,m.KR)([{label:e(L),value:L},{label:e(S),value:S},{label:e(E),value:E}]),W={class:"bg-blue text-white shadow-4",offset:[10,10],contentStyle:"font-size: 12px"},Q={required:o=>!!o||e("error.input.enterValue"),intValue:o=>o>0||e("error.input.enterNumber")},U=(0,l.EW)((()=>!0===Q.required(D.name)&&!0===Q.required(D.goods_type)&&!0===Q.required(D.goods_shape)&&!0===Q.intValue(D.goods_weight)&&!0===Q.intValue(D.goods_rate))),T=(0,l.EW)((()=>!0===Q.required(k.name)&&!0===Q.required(k.goods_type)&&!0===Q.required(k.goods_shape)&&!0===Q.intValue(k.goods_weight)&&!0===Q.intValue(k.goods_rate))),j=()=>{const e=Math.min(Math.max(Number(v.value),1),y.value||1);r.value=v.value=e},N=async()=>{if(d.value){const e=d.value.toLowerCase();s.value=g.A.getItem(a).filter((o=>Object.values(o).some((o=>o&&o.toString().toLowerCase().includes(e)))))}else s.value=g.A.getItem(a);r.value=1,v.value=1},O=async()=>{i.value=!0,await(0,p.e7)(t),K.value=g.A.getItem(t)||[],i.value=!1},B=async()=>{i.value=!0,H(),await(0,p.e7)(a),s.value=g.A.getItem(a)||[],console.log(s.value),i.value=!1},M=async()=>{i.value=!0,X(),H(),await B(),await O(),i.value=!1},P=async()=>{if(!T.value)return o.notify({message:e("error.data_invalid"),icon:"sym_r_close",color:"negative"}),void o.loading.hide();try{o.loading.show();const l={...k};l.goods_type=l.goods_type.id,l.goods_shape=l.goods_shape.value;const t=await(0,u.postauth)(a+"/",l);if("200"!==t.code)throw new Error;await B(),X(),o.notify({message:e("successful.create"),color:"green"})}catch{o.notify({message:e("error.data_invalid"),color:"negative"})}finally{o.loading.hide()}},X=()=>{for(const e in k)k[e]="";F.value=!1},G=e=>{x.value=!0,C.value=e.id,Object.assign(D,e),Object.assign(V,e)},z=async()=>{if(!U.value)return void o.notify({message:e("error.data_invalid"),icon:"sym_r_close",color:"negative"});const l=Object.fromEntries(Object.entries(D).filter((([e,o])=>o!==V[e])));if(!Object.keys(l).length)return o.notify({message:e("warning.no_changes"),color:"warning"});try{o.loading.show();const t=await(0,u.patchauth)(`${a}/${C.value}/`,l);if("200"!==t.code)throw new Error;await B(),s.value=g.A.getItem(a),o.notify({message:e("successful.update"),color:"green"})}catch{o.notify({message:e("error.updateFailed"),color:"negative"})}finally{o.loading.hide()}},H=()=>{x.value=!1,C.value=0,Object.keys(D).forEach((e=>delete D[e]))},J=o=>{I.value=!0,Object.assign(R,o),delete R.id,delete R.update_time,R.goods_type=e(R.goods_type),R.goods_shape=e(R.goods_shape)},Y=e=>{A.value=!0,q.value=e},Z=async()=>{try{o.loading.show();const l=await(0,u.deleteauth)(`${a}/${q.value}/`);if(ee(),"200"!==l.code)throw new Error;o.notify({message:e("successful.delete"),icon:"sym_r_check"}),await(0,p.e7)(a),s.value=g.A.getItem(a)}catch{o.notify({message:e("error.delete"),icon:"sym_r_close"})}finally{o.loading.hide()}},ee=()=>{A.value=!1,q.value=0},oe=e=>x.value&&e.row.id===C.value?{backgroundColor:"#cbc6d2"}:{},ae=[{round:!0,flat:!0,push:!0,color:"green",icon:"sym_r_check",action:z},{round:!0,flat:!0,push:!0,color:"red",icon:"sym_r_close",action:H}],le=(0,m.Kh)([{field:"name",label:e("goods.view_goods.name"),rules:[Q.required],truncate:!0,truncateLength:35},{field:"description",label:e("goods.view_goods.description"),rules:[null],truncate:!0,truncateLength:40},{field:"goods_type",label:e("goods.view_goods.goods_type"),rules:[Q.required],truncate:!1,translate:!1,options:K.value,optionsLabel:"name",optionsValue:"id"},{field:"goods_rate",label:e("goods.view_goods.goods_rate"),rules:[Q.intValue],truncate:!1},{field:"goods_weight",label:e("goods.view_goods.goods_weight"),rules:[Q.intValue],truncate:!1},{field:"goods_shape",label:e("goods.view_goods.goods_shape"),rules:[Q.required],truncate:!1,translate:!0,options:$.value}]),te=[{round:!0,flat:!0,push:!0,color:"amber-2",icon:"sym_r_visibility",tip:e("index.view_detail"),action:J},{round:!0,flat:!0,push:!0,color:"amber-4",icon:"sym_r_edit",tip:e("edit"),action:G},{round:!0,flat:!0,push:!0,color:"amber-13",icon:"sym_r_delete",tip:e("delete"),action:e=>Y(e.id)}],ie=o=>{const a=[{name:"code",label:e("goods.view_goods.code"),field:"code",align:"center",sortable:!0},{name:"name",label:e("goods.view_goods.name"),field:"name",align:"left",sortable:!0},{name:"description",label:e("goods.view_goods.description"),field:"description",align:"left",sortable:!0},{name:"goods_type",label:e("goods.view_goods.goods_type"),field:"goods_type",align:"left",sortable:!0},{name:"goods_rate",label:e("goods.view_goods.rate"),field:"goods_rate",align:"left",sortable:!0},{name:"goods_weight",label:e("goods.view_goods.weight"),field:"goods_weight",align:"left",sortable:!0},{name:"goods_shape",label:e("goods.view_goods.goods_shape"),field:"goods_shape",align:"left",sortable:!0}],l=[{name:"creator",label:e("creator"),field:"creator",align:"left"},{name:"create_time",label:e("createtime"),field:"create_time",align:"left"}],t={name:"action",label:e("action"),align:"center"};return[...a.map((e=>({...e,headerStyle:"font-weight: bold; font-size: 13px"}))),..."Admin"===o?l.map((e=>({...e,headerStyle:"font-weight: bold; font-size: 13px"}))):[],{...t,headerStyle:"font-weight: bold; font-size: 13px"}]},ne=(0,m.Kh)(ie(n.value));return(0,l.sV)((()=>{s.value.length||M()})),{tooltip:W,pathname:a,loading:i,tableList:s,columns:ne,filter:d,pagination:w,newForm:F,newFormData:k,editId:C,editFormData:D,editMode:x,deleteForm:A,deleteId:q,current:r,max:y,paginationIpt:v,goodsTypeList:K,goodsShapeList:$,getGoodsType:O,changePageEnter:j,getSearchList:N,reFresh:M,newDataSubmit:P,resetNewForm:X,editData:G,editDataSubmit:z,editDataCancel:H,deleteData:Y,deleteDataSubmit:Z,resetDelete:ee,t:e,q:o,isEditFormValid:U,isNewFormValid:T,userRole:n,paginatedRows:f,validate:Q,actionCellStyle:oe,editActions:ae,rowActions:te,editableColumns:le,viewData:J,viewDialog:I,viewDataForm:R,fetchTableData:B}}};var h=a(2807),f=a(6653),y=a(6031),F=a(6384),k=a(7410),V=a(3676),C=a(9270),x=a(492),D=a(4488),A=a(5262),q=a(4700),K=a(2156),I=a(3316),R=a(8670),L=a(4189),S=a(4940),E=a(2669),$=a(8672),W=a(8582),Q=a.n(W);const U=(0,h.A)(v,[["render",r]]),T=U;Q()(v,"components",{QTable:f.A,QBtnGroup:y.A,QBtn:F.A,QTooltip:k.A,QSpace:V.A,QInput:C.A,QIcon:x.A,QTr:D.A,QTd:A.A,QPagination:q.A,QDialog:K.A,QCard:I.A,QBar:R.A,QCardSection:L.A,QSelect:S.A,QCardActions:E.A}),Q()(v,"directives",{ClosePopup:$.A})}}]);