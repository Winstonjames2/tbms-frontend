"use strict";(globalThis["webpackChunktbls"]=globalThis["webpackChunktbls"]||[]).push([[485],{8485:(e,a,t)=>{t.r(a),t.d(a,{default:()=>q});var l=t(1758),s=t(2901);const r={class:"track-vehicle-container"},c={class:"text-h5 text-left"},o={class:"text-subtitle1 text-left"};function n(e,a,t,n,i,u){const d=(0,l.g2)("q-btn"),p=(0,l.g2)("q-card-section"),h=(0,l.g2)("q-card"),m=(0,l.g2)("MapboxMap"),b=(0,l.g2)("q-th"),v=(0,l.g2)("q-chip"),g=(0,l.g2)("q-td"),k=(0,l.g2)("q-table");return(0,l.uX)(),(0,l.CE)("div",r,[(0,l.bF)(h,{class:"margin-bottom",style:{width:"300px"}},{default:(0,l.k6)((()=>[(0,l.bF)(p,{style:{display:"flex","flex-direction":"column","align-items":"center"}},{default:(0,l.k6)((()=>[(0,l.Lk)("div",c,(0,s.v_)(e.$t("trackvehicle.trackvehicle")),1),(0,l.Lk)("div",o,(0,s.v_)(e.$t("trackvehicle.desc")),1),n.isMapOpen?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(d,{key:0,onClick:a[0]||(a[0]=e=>n.openMap()),label:e.$t("trackvehicle.openMap"),color:"primary","icon-right":"sym_r_arrow_drop_down",style:{"margin-top":"20px",width:"200px"}},null,8,["label"]))])),_:1})])),_:1}),n.isMapOpen?((0,l.uX)(),(0,l.Wv)(h,{key:0,class:"map-wrapper"},{default:(0,l.k6)((()=>[(0,l.bF)(p,{class:"map-card"},{default:(0,l.k6)((()=>[(0,l.bF)(m,{deviceData:n.deviceData},null,8,["deviceData"]),(0,l.Lk)("div",null,[(0,l.bF)(d,{onClick:a[1]||(a[1]=e=>n.RefreshMap()),padding:"",style:{"margin-top":"20px"},label:e.$t("refresh"),color:"primary",icon:"sym_r_refresh"},null,8,["label"])])])),_:1}),(0,l.bF)(p,{class:"content-card"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{rows:n.vehicleData,columns:n.columns,"row-key":"truckNumber",class:"vehicle-status-table","hide-bottom":""},{"header-cell":(0,l.k6)((e=>[(0,l.bF)(b,{props:e,class:"custom-header"},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(e.col.label),1)])),_:2},1032,["props"])])),"body-cell-status":(0,l.k6)((e=>[(0,l.bF)(g,{props:e},{default:(0,l.k6)((()=>[(0,l.bF)(v,{color:"Stopped"===e.row.status?"red":"Moving"===e.row.status?"green":"Idling"===e.row.status?"orange":"gray","text-color":"white"},{default:(0,l.k6)((()=>[(0,l.eW)((0,s.v_)(e.row.status),1)])),_:2},1032,["color"])])),_:2},1032,["props"])])),_:1},8,["rows","columns"])])),_:1})])),_:1})):(0,l.Q3)("",!0)])}t(310),t(6724);var i=t(6153),u=t(1271),d=t(4907),p=t(2261),h=t(555),m=t(3537);const b={name:"PageTrackVehicle",components:{MapboxMap:(0,l.$V)((()=>Promise.all([t.e(121),t.e(343)]).then(t.bind(t,343))))},setup(){const{t:e}=(0,m.s9)(),a=(0,d.A)(),t=(0,h.KR)(""),l=(0,h.KR)(!1),s=(0,h.KR)(null),r=(0,h.KR)([]),c=()=>{console.log(u.A.getItem("userRole")),"admin"===u.A.getItem("userRole")||"Admin"===u.A.getItem("userRole")?(s.value="MapboxMap",l.value=!0,n()):k("You are not authorized to view the map")},o=async()=>{l.value=!1,await n(),l.value=!0},n=async()=>{i.A.show();try{const e=await(0,p.getauth)("tracksolid/get-device-data/");if(200!==e.status)return void k("Error Fetching Data!");if(t.value=e.data,!t.value||0===t.value.length)return void k("Error Fetching Data!");r.value=await Promise.all(t.value.map((async e=>({truckNumber:e.deviceName,nearestAddress:await b(e.longitude,e.latitude),speed:e.speed,status:e.status})))),g("Data Successfully Fetched!")}catch(e){k("Error Fetching Data!")}i.A.hide()},b=async(e,a)=>{const t="pk.eyJ1Ijoid2luc3RvbjNvIiwiYSI6ImNtM282eHl4MTAwY3Aya3NkeGwxaWhsemgifQ.FM7yc1gc2BdH0t9IBTk7bg",l=`https://api.mapbox.com/geocoding/v5/mapbox.places/${e},${a}.json?access_token=${t}`;try{const e=await fetch(l),a=await e.json();return a.features.length>0?a.features[0].place_name:"Unknown Location"}catch(e){return"Unknown Location"}},v=[{name:"truckNumber",required:!0,label:e("trackvehicle.table.truckNumber"),align:"left",field:e=>e.truckNumber},{name:"nearestLocation",required:!0,label:e("trackvehicle.table.nearestLocation"),align:"left",field:e=>e.nearestAddress},{name:"speed",required:!0,label:e("trackvehicle.table.speed"),align:"left",field:e=>e.speed},{name:"status",required:!0,label:e("trackvehicle.table.status"),align:"left",field:e=>e.status}],g=e=>a.notify({message:e,icon:"sym_r_check",color:"positive"}),k=e=>a.notify({message:e,icon:"sym_r_close",color:"negative"});return{t:e,isMapOpen:l,openMap:c,mapComponent:s,vehicleData:r,columns:v,deviceData:t,RefreshMap:o}}};var v=t(2807),g=t(3316),k=t(4189),f=t(6384),w=t(6653),y=t(7722),_=t(5262),A=t(6760),M=t(8582),x=t.n(M);const F=(0,v.A)(b,[["render",n],["__scopeId","data-v-2b409169"]]),q=F;x()(b,"components",{QCard:g.A,QCardSection:k.A,QBtn:f.A,QTable:w.A,QTh:y.A,QTd:_.A,QChip:A.A})}}]);