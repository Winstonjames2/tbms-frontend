"use strict";(globalThis["webpackChunktbls"]=globalThis["webpackChunktbls"]||[]).push([[317],{8317:(e,a,l)=>{l.r(a),l.d(a,{default:()=>j});var s=l(1758),t=l(2901),o=l(6683);const r={class:"row items-center"},n={class:"text-h6"},i={class:"text-caption text-grey-7"},d={class:"row items-center q-gutter-x-sm"},u={class:"text-subtitle2"},m={class:"float-right q-ma-sm row items-center"},c={class:"text-caption q-mr-sm"},g={class:"text-caption q-mr-sm"},b={class:"text-h6"},p={class:"row justify-end q-mt-md"},_={class:"text-h6"},v={key:0,class:"q-mt-sm"},h={class:"row justify-end q-mt-md"};function f(e,a,l,f,w,y){const k=(0,s.g2)("q-icon"),F=(0,s.g2)("q-card-section"),C=(0,s.g2)("q-separator"),q=(0,s.g2)("q-input"),x=(0,s.g2)("q-tooltip"),$=(0,s.g2)("q-btn"),V=(0,s.g2)("q-td"),A=(0,s.g2)("q-table"),P=(0,s.g2)("q-select"),U=(0,s.g2)("q-form"),R=(0,s.g2)("q-card"),E=(0,s.g2)("q-dialog"),S=(0,s.g2)("q-chip"),D=(0,s.g2)("q-card-actions"),L=(0,s.g2)("q-popup-proxy"),Q=(0,s.gN)("close-popup");return(0,s.uX)(),(0,s.Wv)(R,{class:"glass-card user-management-card custom-scrollbar-color"},{default:(0,s.k6)((()=>[(0,s.bF)(F,{class:"card-header row items-center justify-between"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",r,[(0,s.bF)(k,{name:"sym_r_people",class:"header-icon q-mr-sm"}),(0,s.Lk)("div",n,(0,t.v_)(e.$t("dashboard.user_management.title")),1)]),(0,s.Lk)("div",i,(0,t.v_)(e.$t("dashboard.user_management.manage_tip")),1)])),_:1}),(0,s.bF)(C,{dark:""}),(0,s.bF)(F,{class:"row"},{default:(0,s.k6)((()=>[(0,s.bF)(q,{dense:"",outlined:"",clearable:"",debounce:"100",modelValue:f.searchQuery,"onUpdate:modelValue":a[0]||(a[0]=e=>f.searchQuery=e),placeholder:"Search by name or email",style:{width:"80%","max-width":"400px"}},{prepend:(0,s.k6)((()=>[(0,s.bF)(k,{name:"sym_r_search"})])),_:1},8,["modelValue"]),(0,s.bF)($,{dense:"",class:"q-px-sm q-mx-sm",color:"primary",icon:"sym_r_person_add",onClick:f.openAddDialog},{default:(0,s.k6)((()=>[(0,s.bF)(x,(0,t._B)((0,s.Ng)(f.tooltip)),{default:(0,s.k6)((()=>[(0,s.eW)((0,t.v_)(e.$t("dashboard.user_management.add_user")),1)])),_:1},16)])),_:1},8,["onClick"])])),_:1}),(0,s.bF)(F,{class:"table-wrapper custom-scrollbar-color"},{default:(0,s.k6)((()=>[(0,s.bF)(A,{flat:"","hide-bottom":"","row-key":"id",class:"scrollable-table",style:{"background-color":"transparent"},columns:f.columns,rows:f.paginatedUsers,pagination:f.pagination},{"body-cell-email":(0,s.k6)((e=>[(0,s.bF)(V,{align:"left"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",d,[(0,s.Lk)("div",u,(0,t.v_)(f.isRevealed(e.row.id)?e.row.email:f.maskEmail(e.row.email)),1),(0,s.bF)($,{dense:"",flat:"",round:"",size:"sm",icon:f.isRevealed(e.row.id)?"sym_r_visibility_off":"sym_r_visibility",onClick:(0,o.D$)((a=>f.toggleReveal(e.row.id)),["stop"]),title:f.isRevealed(e.row.id)?"Hide email":"Reveal email"},null,8,["icon","onClick","title"])])])),_:2},1024)])),"body-cell-actions":(0,s.k6)((e=>[(0,s.bF)(V,{align:"center"},{default:(0,s.k6)((()=>[(0,s.bF)($,{flat:"",dense:"",round:"",color:"primary",icon:"sym_r_edit",onClick:a=>f.openEditDialog(e.row),title:"Edit user"},null,8,["onClick"])])),_:2},1024)])),_:1},8,["columns","rows","pagination"]),(0,s.Lk)("div",m,[(0,s.Lk)("div",c,(0,t.v_)(`${e.$t("dashboard.user_management.page")} ${f.pagination.page} / ${f.totalPages}`),1),(0,s.Lk)("div",g,(0,t.v_)(`${e.$t("dashboard.user_management.total")} ${l.totalCount}`),1),(0,s.bF)($,{dense:"",color:"primary",rounded:"",icon:"sym_r_keyboard_arrow_left",class:"q-mr-sm",disable:!f.hasPrevPage||f.loadingPage,onClick:f.goPrev},{default:(0,s.k6)((()=>[(0,s.bF)(x,(0,t._B)((0,s.Ng)(f.tooltip)),{default:(0,s.k6)((()=>[(0,s.eW)((0,t.v_)(e.$t("dashboard.user_management.previous_page")),1)])),_:1},16)])),_:1},8,["disable","onClick"]),(0,s.bF)($,{dense:"",color:"primary",rounded:"",icon:"sym_r_keyboard_arrow_right",class:"q-ml-sm",disable:!f.hasNextPage||f.loadingPage,onClick:f.goNext},{default:(0,s.k6)((()=>[(0,s.bF)(x,(0,t._B)((0,s.Ng)(f.tooltip)),{default:(0,s.k6)((()=>[(0,s.eW)((0,t.v_)(e.$t("dashboard.user_management.next_page")),1)])),_:1},16)])),_:1},8,["disable","onClick"])])])),_:1}),(0,s.bF)(E,{modelValue:f.showAddDialog,"onUpdate:modelValue":a[5]||(a[5]=e=>f.showAddDialog=e),persistent:""},{default:(0,s.k6)((()=>[(0,s.bF)(R,{style:{"min-width":"420px","max-width":"90vw"}},{default:(0,s.k6)((()=>[(0,s.bF)(F,{class:"bg-primary text-white"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",b,(0,t.v_)(e.$t("dashboard.user_management.user_add_title")),1)])),_:1}),(0,s.bF)(F,{class:"form-wrapper"},{default:(0,s.k6)((()=>[(0,s.bF)(U,{ref:"addFormRef",onSubmit:(0,o.D$)(f.handleAddUser,["prevent"])},{default:(0,s.k6)((()=>[(0,s.bF)(q,{modelValue:f.newUser.first_name,"onUpdate:modelValue":a[1]||(a[1]=e=>f.newUser.first_name=e),label:e.$t("dashboard.user_management.display_name"),outlined:"",dense:"",autofocus:"",rules:[f.rules.required,f.rules.minName],"lazy-rules":""},null,8,["modelValue","label","rules"]),(0,s.bF)(q,{modelValue:f.newUser.email,"onUpdate:modelValue":a[2]||(a[2]=e=>f.newUser.email=e),label:e.$t("dashboard.user_management.email"),outlined:"",dense:"",rules:[f.rules.required,f.rules.email],hint:"e.g. some@example.com","lazy-rules":""},null,8,["modelValue","label","rules"]),(0,s.bF)(P,{modelValue:f.newUser.role,"onUpdate:modelValue":a[3]||(a[3]=e=>f.newUser.role=e),label:e.$t("dashboard.user_management.role"),outlined:"",dense:"",options:f.roleOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",rules:[f.rules.required],"lazy-rules":""},null,8,["modelValue","label","options","rules"]),(0,s.bF)(q,{modelValue:f.newUser.password,"onUpdate:modelValue":a[4]||(a[4]=e=>f.newUser.password=e),type:"password",label:e.$t("dashboard.user_management.password"),outlined:"",dense:"",autocomplete:"new-password",rules:[f.rules.required,f.rules.password],"lazy-rules":"",hint:e.$t("auth.password_hint")},null,8,["modelValue","label","rules","hint"]),(0,s.Lk)("div",p,[(0,s.bF)($,{flat:"",label:"Cancel",onClick:f.closeAddDialog},null,8,["onClick"]),(0,s.bF)($,{loading:f.addLoading,disable:f.addLoading,label:"Add",class:"bg-primary text-white q-ml-sm",onClick:f.submitAddForm},null,8,["loading","disable","onClick"])])])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,s.bF)(E,{modelValue:f.showEditDialog,"onUpdate:modelValue":a[13]||(a[13]=e=>f.showEditDialog=e),persistent:""},{default:(0,s.k6)((()=>[(0,s.bF)(R,{style:{"min-width":"420px","max-width":"90vw"}},{default:(0,s.k6)((()=>[(0,s.bF)(F,{class:"bg-primary text-white"},{default:(0,s.k6)((()=>[(0,s.Lk)("div",_,(0,t.v_)(e.$t("dashboard.user_management.edit_user")),1)])),_:1}),(0,s.bF)(F,{class:"form-wrapper"},{default:(0,s.k6)((()=>[(0,s.bF)(U,{ref:"editFormRef",onSubmit:(0,o.D$)(f.handleEditUser,["prevent"])},{default:(0,s.k6)((()=>[(0,s.bF)(q,{modelValue:f.editUser.first_name,"onUpdate:modelValue":a[6]||(a[6]=e=>f.editUser.first_name=e),label:e.$t("dashboard.user_management.display_name"),outlined:"",dense:"",rules:[f.rules.required,f.rules.minName]},null,8,["modelValue","label","rules"]),(0,s.bF)(q,{modelValue:f.editUser.email,"onUpdate:modelValue":a[7]||(a[7]=e=>f.editUser.email=e),label:e.$t("dashboard.user_management.email"),outlined:"",dense:"",rules:[f.rules.required,f.rules.email]},null,8,["modelValue","label","rules"]),(0,s.bF)(P,{modelValue:f.editUser.role,"onUpdate:modelValue":a[8]||(a[8]=e=>f.editUser.role=e),label:e.$t("dashboard.user_management.role"),outlined:"",dense:"",options:f.roleOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",rules:[f.rules.required]},null,8,["modelValue","label","options","rules"]),f.changePassword&&f.paswordChangedConfirm?((0,s.uX)(),(0,s.CE)("div",v,[(0,s.bF)(S,{color:"accent","text-color":"grey-7",outlined:"",removable:"",onRemove:a[9]||(a[9]=e=>(f.changePassword=null,f.paswordChangedConfirm=!1))},{default:(0,s.k6)((()=>[(0,s.eW)((0,t.v_)(e.$t("dashboard.user_management.password_changed")),1)])),_:1})])):((0,s.uX)(),(0,s.Wv)($,{key:1,class:"q-mt-sm",dense:"",label:e.$t("dashboard.user_management.change_password")+" ?",color:"primary",flat:"",style:{display:"block","margin-left":"auto"}},{default:(0,s.k6)((()=>[(0,s.bF)(L,{"transition-show":"scale","transition-hide":"scale"},{default:(0,s.k6)((()=>[(0,s.bF)(R,{style:{"min-width":"300px","max-width":"90vw"}},{default:(0,s.k6)((()=>[(0,s.bF)(F,{class:"text-h6"},{default:(0,s.k6)((()=>[(0,s.bF)(k,{name:"sym_r_lock",class:"q-mr-sm",style:{"vertical-align":"middle"}}),(0,s.eW)(" "+(0,t.v_)(e.$t("dashboard.user_management.change_password")),1)])),_:1}),(0,s.bF)(C),(0,s.bF)(F,null,{default:(0,s.k6)((()=>[(0,s.bF)(q,{modelValue:f.changePassword,"onUpdate:modelValue":a[11]||(a[11]=e=>f.changePassword=e),type:f.showPassword?"text":"password",label:e.$t("dashboard.user_management.new_password"),outlined:"",dense:"",autocomplete:"new-password",rules:[f.rules.password],"lazy-rules":"",hint:e.$t("auth.password_hint")},{append:(0,s.k6)((()=>[(0,s.bF)(k,{name:f.showPassword?"sym_r_visibility_off":"sym_r_visibility",class:"cursor-pointer",onClick:a[10]||(a[10]=e=>f.showPassword=!f.showPassword)},null,8,["name"])])),_:1},8,["modelValue","type","label","rules","hint"])])),_:1}),(0,s.bF)(D,{align:"right"},{default:(0,s.k6)((()=>[(0,s.bo)((0,s.bF)($,{flat:"",label:e.$t("dashboard.user_management.cancel"),onClick:a[12]||(a[12]=e=>(f.changePassword=null,f.paswordChangedConfirm=!1)),"aria-label":"Close menu"},null,8,["label"]),[[Q]]),(0,s.bF)($,{label:e.$t("dashboard.user_management.ok"),class:"bg-primary text-white q-ml-sm",onClick:f.confirmPasswordChange},null,8,["label","onClick"])])),_:1})])),_:1})])),_:1})])),_:1},8,["label"])),(0,s.Lk)("div",h,[(0,s.bF)($,{flat:"",label:e.$t("dashboard.user_management.cancel"),onClick:f.closeEditDialog},null,8,["label","onClick"]),(0,s.bF)($,{loading:f.editLoading,disable:f.editLoading,label:e.$t("dashboard.user_management.save"),class:"bg-primary text-white q-ml-sm",onClick:f.submitEditForm},null,8,["loading","disable","label","onClick"])])])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}l(310),l(5962),l(7225),l(8743),l(2858),l(2071),l(5520),l(2775),l(6203);var w=l(555),y=l(4907),k=l(2261),F=l(3537);const C={name:"UserManagement",props:{users:{type:Array,required:!0},totalCount:{type:Number,required:!0}},emits:["reload-user"],setup(e,{emit:a}){const l=(0,y.A)(),{t}=(0,F.s9)(),o=(0,w.KR)(""),r=(0,w.KR)(!1),n=(0,w.KR)(!1),i=(0,w.KR)(!1),d=(0,w.KR)(null),u=(0,w.KR)(null),m=(0,w.KR)(!1),c=(0,w.KR)(!1),g=(0,w.KR)(!1),b=25,p=(0,w.KR)({page:1,rowsPerPage:b}),_=(0,w.KR)(null),v=(0,w.KR)(!1),h=(0,w.KR)(!1),f=(0,w.KR)(new Set),C=(0,w.KR)({first_name:"",email:"",password:"",role:null}),q=(0,w.KR)({}),x=(0,w.KR)(null),$=[{label:"Staff",value:"staff"},{label:"User",value:"user"}],V={required:e=>null!==e&&void 0!==e&&String(e).trim().length>0||t("auth.required"),minName:e=>!e||String(e).trim().length>=4||t("auth.min4"),email:e=>{if(!e)return t("auth.email_required");const a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return a.test(e)||t("auth.invalid_email_rule")},password:e=>{if(!e)return t("auth.password_required");const a=/^(?=.*[A-Za-z])(?=.*\d).{8,}$/;return a.test(e)||t("auth.password_rule")}},A=(0,s.EW)((()=>{const a=(o.value||"").toLowerCase().trim();return a?(e.users||[]).filter((e=>String(e.first_name||"").toLowerCase().includes(a)||String(e.email||"").toLowerCase().includes(a))):e.users||[]})),P=(0,s.EW)((()=>{const e=(p.value.page-1)*p.value.rowsPerPage;return A.value.slice(e,e+p.value.rowsPerPage)})),U=(0,s.EW)((()=>{const a=Number(e.totalCount||0);return Math.max(1,Math.ceil(a/b))})),R={class:"bg-blue text-white shadow-4",offset:[10,10],contentStyle:"font-size: 12px"},E=(0,s.EW)((()=>p.value.page<U.value)),S=(0,s.EW)((()=>p.value.page>1));function D(e){if(!e)return"";const a=String(e).split("@");if(2!==a.length)return"***";const[l,s]=a;if(!l)return`***@${s}`;const t=l.charAt(0);return`${t}***@${s}`}function L(e){return f.value.has(e)}function Q(e){f.value.has(e)?f.value.delete(e):f.value.add(e),f.value=new Set(f.value)}function K(){C.value={first_name:"",email:"",password:"",role:null},d.value&&d.value.resetValidation&&d.value.resetValidation()}function N(){E.value&&p.value.page++}function W(){S.value&&p.value.page--}function z(){K(),r.value=!0,(0,s.dY)((()=>d.value&&d.value.resetValidation&&d.value.resetValidation()))}function B(){r.value=!1}async function T(){const e=!d.value||await d.value.validate();e?I():l.notify({message:t("warning.fix_validation"),color:"negative"})}async function I(){m.value=!0;try{const e={first_name:String(C.value.first_name||"").trim(),email:String(C.value.email||"").trim(),password:C.value.password,role:C.value.role},s=await(0,k.postauth)("/dashboard/userlist/",e);if("200"!==s.code)return l.notify({message:t("dashboard.user_management.failed_user_add"),color:"negative"}),void(m.value=!1);const o=s&&s.data&&s.data.data||s&&s.data||s;a("reload-user",o),l.notify({message:t("dashboard.user_management.success_user_add"),color:"positive"}),B(),K()}catch(e){l.notify({message:t("dashboard.user_management.failed_user_add"),color:"negative"})}finally{m.value=!1}}function j(e){q.value={id:e.id,first_name:e.first_name??"",email:e.email??"",role:e.role??null},x.value={...q.value},n.value=!0,(0,s.dY)((()=>u.value&&u.value.resetValidation&&u.value.resetValidation()))}function M(){_.value=null,v.value=!1,n.value=!1}function O(){if(!x.value)return{};const e={},a=["first_name","email","role"];return a.forEach((a=>{const l=String(x.value[a]||"").trim(),s=String(q.value[a]||"").trim();l!==s&&(e[a]=q.value[a])})),e}(0,s.wB)(o,(()=>{p.value.page=1}));const X=()=>{_.value?(v.value=!0,h.value=!1):l.notify({message:t("auth.password_empty"),color:"warning"})};async function Y(){const e=!u.value||await u.value.validate();if(!e)return void l.notify({message:t("warning.fix_validation"),color:"warning"});const a=O();_.value&&(a.password=_.value),a?(console.log("Payload: ",a),H(a)):l.notify({message:t("warning.no_changes"),color:"warning"})}async function H(e){c.value=!0;try{const s=await(0,k.patchauth)(`/dashboard/userlist/${q.value.id}/`,e);if(console.log("Edit response: ",s),"200"!==s.code)return l.notify({message:t("dashboard.user_management.failed_user_update"),color:"negative"}),void(c.value=!1);a("reload-user",{id:q.value.id,...e}),l.notify({color:"positive",message:t("dashboard.user_management.success_user_update")}),M()}catch(e){l.notify({message:t("dashboard.user_management.failed_user_update"),color:"negative"})}finally{c.value=!1}}const Z=[{name:"id",label:"ID",field:"id",align:"left",sortable:!0},{name:"first_name",label:"Display Name",field:"first_name",align:"left",sortable:!0},{name:"email",label:"Email",align:"left",field:"email"},{name:"role",label:"Role",field:e=>e.role?String(e.role).charAt(0).toUpperCase()+String(e.role).slice(1):"",align:"left",sortable:!0},{name:"actions",label:"Actions",align:"center"}];return(0,s.wB)((()=>e.totalCount),(()=>{p.value.page>U.value&&(p.value.page=U.value)})),{searchQuery:o,showAddDialog:r,showEditDialog:n,showNoChangesDialog:i,addFormRef:d,editFormRef:u,addLoading:m,editLoading:c,loadingPage:g,newUser:C,editUser:q,roleOptions:$,columns:Z,pagination:p,paginatedUsers:P,totalPages:U,hasNextPage:E,hasPrevPage:S,rules:V,maskEmail:D,isRevealed:L,toggleReveal:Q,openAddDialog:z,closeAddDialog:B,openEditDialog:j,closeEditDialog:M,submitAddForm:T,submitEditForm:Y,goNext:N,goPrev:W,handleAddUser:I,handleEditUser:H,tooltip:R,paswordChangedConfirm:v,changePassword:_,showPassword:h,confirmPasswordChange:X}}};var q=l(2807),x=l(3316),$=l(4189),V=l(492),A=l(386),P=l(9270),U=l(6384),R=l(7410),E=l(6653),S=l(5262),D=l(2156),L=l(9200),Q=l(4940),K=l(6760),N=l(1356),W=l(2669),z=l(8672),B=l(8582),T=l.n(B);const I=(0,q.A)(C,[["render",f],["__scopeId","data-v-15ed1b0d"]]),j=I;T()(C,"components",{QCard:x.A,QCardSection:$.A,QIcon:V.A,QSeparator:A.A,QInput:P.A,QBtn:U.A,QTooltip:R.A,QTable:E.A,QTd:S.A,QDialog:D.A,QForm:L.A,QSelect:Q.A,QChip:K.A,QPopupProxy:N.A,QCardActions:W.A}),T()(C,"directives",{ClosePopup:z.A})}}]);