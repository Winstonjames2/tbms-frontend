"use strict";(globalThis["webpackChunktbls"]=globalThis["webpackChunktbls"]||[]).push([[915],{4586:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Q});a(310),a(5962);var l=a(1758),o=a(6683),n=a(2901);const r={class:"q-mt-md"},i={class:"q-pa-sm flex flex-center"},s={class:"q-pa-sm flex flex-center"};function u(e,t,a,u,c,d){const v=(0,l.g2)("q-tooltip"),p=(0,l.g2)("q-btn"),m=(0,l.g2)("q-btn-group"),y=(0,l.g2)("q-space"),f=(0,l.g2)("q-icon"),g=(0,l.g2)("q-input"),b=(0,l.g2)("q-td"),h=(0,l.g2)("EditableCell"),_=(0,l.g2)("q-tr"),w=(0,l.g2)("q-table"),k=(0,l.g2)("q-pagination"),X=(0,l.g2)("q-bar"),F=(0,l.g2)("q-card-section"),A=(0,l.g2)("q-card-actions"),C=(0,l.g2)("q-card"),I=(0,l.g2)("q-dialog"),K=(0,l.gN)("close-popup");return(0,l.uX)(),(0,l.CE)("div",r,[(0,l.bF)(o.eB,{appear:"","enter-active-class":"animated fadeIn"},{default:(0,l.k6)((()=>[(0,l.bF)(w,{separator:"cell",class:"my-sticky-header-column-table shadow-24",rows:u.tableList,"row-key":"id",loading:u.loading,columns:u.columns,"hide-bottom":"",pagination:u.pagination,"no-data-label":"No data","no-results-label":"No data you want",style:{height:"calc(100vh - 190px)"},flat:"",bordered:""},{top:(0,l.k6)((()=>[(0,l.bF)(m,{push:""},{default:(0,l.k6)((()=>[(0,l.bF)(p,{label:e.$t("refresh"),icon:"sym_r_refresh",onClick:t[0]||(t[0]=e=>u.reFresh())},{default:(0,l.k6)((()=>[(0,l.bF)(v,(0,n._B)((0,l.Ng)(u.tooltip)),{default:(0,l.k6)((()=>[(0,l.eW)((0,n.v_)(e.$t("refreshtip")),1)])),_:1},16)])),_:1},8,["label"])])),_:1}),(0,l.bF)(y),(0,l.bF)(g,{outlined:"",rounded:"",dense:"",debounce:"300",color:"primary",modelValue:u.filter,"onUpdate:modelValue":t[1]||(t[1]=e=>u.filter=e),placeholder:e.$t("search"),onKeyup:(0,o.jR)(u.onFilterApply,["enter"]),onBlur:u.onFilterApply,onClear:u.onFilterClear,clearable:""},{append:(0,l.k6)((()=>[(0,l.bF)(f,{name:"sym_r_search",class:"search-icon-hover",onClick:u.onFilterApply},null,8,["onClick"])])),_:1},8,["modelValue","placeholder","onKeyup","onBlur","onClear"])])),body:(0,l.k6)((e=>[(0,l.bF)(_,{props:e},{default:(0,l.k6)((()=>[(0,l.bF)(b,{key:"code",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,n.v_)(e.row.code),1)])),_:2},1032,["props"]),(0,l.bF)(b,{key:"received_date",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,n.v_)(e.row.received_date),1)])),_:2},1032,["props"]),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(u.editableColumns,(t=>((0,l.uX)(),(0,l.Wv)(h,{key:t.field,row:e.row,field:t.field,label:t.label,rules:t.rules,mask:t.mask,"edit-id":u.editId,"model-value":e.row.id===u.editId?u.editFormData[t.field]:e.row[t.field],translate:t.translate||!1,options:t.options||[],"onUpdate:modelValue":e=>u.editFormData[t.field]=e,props:e},null,8,["row","field","label","rules","mask","edit-id","model-value","translate","options","onUpdate:modelValue","props"])))),128)),(0,l.bF)(b,{key:"status",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,n.v_)(u.t(e.row.status)),1)])),_:2},1032,["props"]),(0,l.bF)(b,{key:"total_weight",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,n.v_)(e.row.total_weight),1)])),_:2},1032,["props"]),(0,l.bF)(b,{key:"total_amount",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,n.v_)(e.row.total_amount),1)])),_:2},1032,["props"]),(0,l.bF)(b,{key:"creator",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,n.v_)(e.row.creator),1)])),_:2},1032,["props"]),(0,l.bF)(b,{key:"create_time",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,n.v_)(e.row.create_time),1)])),_:2},1032,["props"]),(0,l.bF)(b,{key:"action",props:e,style:(0,n.Tr)([{width:"100px"},u.actionCellStyle(e)])},{default:(0,l.k6)((()=>[e.row.id!==u.editId?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:0},(0,l.pI)(u.rowActions,(t=>((0,l.uX)(),(0,l.Wv)(p,(0,l.v6)({key:t.icon,ref_for:!0},t,{onClick:a=>t.action(e.row)}),{default:(0,l.k6)((()=>[(0,l.bF)(v,(0,l.v6)({ref_for:!0},u.tooltip),{default:(0,l.k6)((()=>[(0,l.eW)((0,n.v_)(t.tip),1)])),_:2},1040)])),_:2},1040,["onClick"])))),128)):((0,l.uX)(!0),(0,l.CE)(l.FK,{key:1},(0,l.pI)(u.editActions,(e=>((0,l.uX)(),(0,l.Wv)(p,(0,l.v6)({key:e.icon,ref_for:!0},e,{onClick:e.action}),null,16,["onClick"])))),128))])),_:2},1032,["props","style"])])),_:2},1032,["props"])])),_:1},8,["rows","loading","columns","pagination"])])),_:1}),(0,l.bo)((0,l.Lk)("div",i,[(0,l.bF)(k,{modelValue:u.current,"onUpdate:modelValue":[t[2]||(t[2]=e=>u.current=e),u.handlePaginationChange],max:u.max,"max-pages":10,"boundary-links":"",color:"red-8"},null,8,["modelValue","max","onUpdate:modelValue"]),(0,l.bF)(g,{modelValue:u.paginationIpt,"onUpdate:modelValue":t[3]||(t[3]=e=>u.paginationIpt=e),modelModifiers:{number:!0},outlined:"",round:"",dense:"",color:"red-8",onBlur:u.changePageEnter,onKeyup:(0,o.jR)(u.changePageEnter,["enter"]),style:{width:"50px"},class:"center"},null,8,["modelValue","onBlur","onKeyup"])],512),[[o.aG,u.max]]),(0,l.bo)((0,l.Lk)("div",s,[(0,l.bF)(p,{flat:"",push:"",color:"darkText",label:e.$t("no_data")},null,8,["label"])],512),[[o.aG,!u.max]]),(0,l.bF)(I,{modelValue:u.deleteForm,"onUpdate:modelValue":t[4]||(t[4]=e=>u.deleteForm=e),persistent:""},{default:(0,l.k6)((()=>[(0,l.bF)(C,{class:"shadow-24",style:{"max-width":"350px",width:"100%"}},{default:(0,l.k6)((()=>[(0,l.bF)(X,{style:{height:"50px"},class:"bg-primary text-white"},{default:(0,l.k6)((()=>[(0,l.eW)((0,n.v_)(e.$t("inventory.view_inventorylist.deleteConfirmation"))+" ",1),(0,l.bF)(y),(0,l.bo)(((0,l.uX)(),(0,l.Wv)(p,{dense:"",flat:"",icon:"sym_r_close"},{default:(0,l.k6)((()=>[(0,l.bF)(v,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,n.v_)(e.$t("index.close")),1)])),_:1})])),_:1})),[[K]])])),_:1}),(0,l.bF)(F,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,n.v_)(u.t("deletetip")),1)])),_:1}),(0,l.bF)(A,{align:"right"},{default:(0,l.k6)((()=>[(0,l.bF)(p,{flat:"",label:u.t("cancel"),onClick:u.resetDelete},null,8,["label","onClick"]),(0,l.bF)(p,{color:"primary",label:u.t("delete"),onClick:u.deleteDataSubmit},null,8,["label","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])}a(2203),a(95),a(6724);var c=a(2261),d=a(1271),v=a(4907),p=a(7144),m=a(555),y=a(3537),f=a(455),g=a(5677);const b={name:"PageInventoryList",components:{EditableCell:g.A},setup(){const{t:e}=(0,y.s9)(),t=(0,v.A)(),a=(0,f.rd)(),o="consignment",n="customer",r="company",i=(0,m.KR)(!1),s=(0,m.KR)([]),u=(0,m.KR)([]),g={},b={},h=(0,m.KR)([]),_=(0,m.KR)(d.A.getItem("userRole")),w=(0,m.KR)(""),k=(0,m.KR)(0),X=(0,m.Kh)({}),F=(0,m.Kh)({}),A=(0,m.KR)(!1),C=(0,m.KR)(!1),I=(0,m.KR)(0),K=(0,m.KR)(1),E=(0,m.KR)(25),x=(0,m.KR)(0),R=(0,l.EW)((()=>Math.ceil(x.value/E.value)||0)),S=(0,m.KR)(0),V=(0,m.KR)({page:1,rowsPerPage:E.value,rowsNumber:0}),W=(0,m.KR)(1),q=(0,m.KR)([]),D=(0,m.KR)([]),j=e=>null!==e&&void 0!==e&&""!==e,O=(0,l.EW)((()=>!0===j(X.customer)&&!0===j(X.company)&&!0===j(X.status))),Q={class:"bg-blue text-white shadow-4",offset:[10,10],contentStyle:"font-size: 12px"},N=e=>(0,l.EW)((()=>(d.A.getItem(e)||[]).map((e=>({label:e.name,value:e.id}))))),$=N(n),L=N(r),P=(e,t)=>(a,l)=>{a&&""!==a.trim()?l((()=>{t.value=e.value.filter((e=>e.label.toLowerCase().includes(a.toLowerCase())))})):l((()=>{t.value=e.value}))},B=P($,q),T=P(L,D),U=(e,t)=>{const a=new Map;for(const t of e||[])t&&void 0!==t.id&&null!==t.id&&a.set(t.id,t);for(const e of t||[])e&&void 0!==e.id&&null!==e.id&&a.set(e.id,e);return Array.from(a.values())},M=e=>{const t=Number(e)||0;x.value=t,V.value.rowsNumber=t},z=(e,t)=>{g[e]=Array.isArray(t)?t:[],u.value=U(u.value,g[e])},G=(e,t)=>{b[e]=Array.isArray(t)?t:[]},Y=e=>{const t=Number(e)||1;return oe.value?b[t]||[]:g[t]||[]},H=e=>Array.isArray(g[e])&&g[e].length>0,J=e=>Array.isArray(b[e])&&b[e].length>0,Z=(e,t=!1)=>{const a=[`page=${e}`];return t&&w.value&&""!==String(w.value).trim()&&a.push(`search=${encodeURIComponent(w.value.trim())}`),`${o}/?${a.reverse().join("&")}`},ee={},te=async(e,t)=>{if(ee[e])return ee[e];const a=(async()=>{try{return await t()}finally{delete ee[e]}})();return ee[e]=a,a},ae=async(e=1,{force:t=!1}={})=>{const a=Number(e)||1;if(!t&&H(a))return s.value=Y(a),V.value.page=a,K.value=a,void(W.value=a);i.value=!0;try{const e=Z(a,!1),t=await te(e,(()=>(0,c.getauth)(e)));console.log("INVENTORYLIST: "),console.log(t),console.log("XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX");const l=Array.isArray(t.results)?t.results:[];z(a,l),M(t.count),S.value=t.count||0,s.value=Y(a),V.value.page=a,K.value=a,W.value=a}catch(e){console.error("fetchPage error:",e),s.value=[]}finally{i.value=!1}},le=async(e=1,{force:t=!1}={})=>{const a=Number(e)||1;if(!t&&J(a))return h.value=b[a],s.value=h.value,V.value.page=a,K.value=a,void(W.value=a);i.value=!0;try{const e=Z(a,!0),t=await te(e,(()=>(0,c.getauth)(e))),l=Array.isArray(t.results)?t.results:[];G(a,l),M(t.count),h.value=Y(a),s.value=h.value,V.value.page=a,K.value=a,W.value=a}catch(e){console.error("fetchFilteredPage error:",e),h.value=[],s.value=[]}finally{i.value=!1}},oe=(0,l.EW)((()=>w.value&&""!==String(w.value).trim())),ne=async()=>{const e=String(w.value||"").trim();if(!e)return re();await le(1,{force:!0})},re=async()=>{w.value="",h.value=[],H(K.value)?(s.value=Y(K.value),M(S.value)):await ae(1,{force:!1})},ie=async()=>{i.value=!0;try{Object.keys(g).forEach((e=>delete g[e])),Object.keys(b).forEach((e=>delete b[e])),u.value=[],h.value=[],K.value=1,W.value=1,V.value.page=1,V.value.rowsNumber=0,x.value=0,Object.keys(ee).forEach((e=>delete ee[e])),await ae(1,{force:!0}),pe()}finally{i.value=!1}},se=async()=>{let e=Number(W.value)||1;e<1?e=1:e>R.value&&(e=R.value||1),K.value=e,W.value=e,V.value.page=e,oe.value?await le(e):await ae(e)},ue=async e=>{W.value=e,K.value=e,V.value.page=e,oe.value?await le(e):await ae(e)},ce=e=>{A.value=!0,k.value=e.id,X.customer=e.customer,X.company=e.company,X.status=e.status,F.customer=e.customer,F.company=e.company,F.status=e.status},de=async()=>{if(!O.value)return void t.notify({message:e("error.data_invalid"),icon:"sym_r_close",color:"negative"});const a=Object.fromEntries(Object.entries(X).filter((([e,t])=>t!==F[e])));if(!Object.keys(a).length)return t.notify({message:e("warning.no_changes"),color:"warning"});let l;try{if(t.loading.show(),l=await(0,c.patchauth)(`${o}/${k.value}/`,a),!l||"200"!==l.code&&200!==l.status)throw new Error;{const a=l.data||null;a&&void 0!==a.id&&(u.value=u.value.map((e=>e.id===a.id?a:e)),Object.keys(g).forEach((e=>{g[e]=g[e].map((e=>e.id===a.id?a:e))})),Object.keys(b).forEach((e=>{b[e]=b[e].map((e=>e.id===a.id?a:e))}))),ve(a),await ie(),t.notify({message:e("successful.update"),color:"green"})}}catch{t.notify({message:l.msg||e("error.update"),icon:"sym_r_close",color:"positive"})}finally{t.loading.hide()}},ve=e=>{const t=d.A.getItem("EditSelectedInventoryItemData"),a=d.A.getItem("SelectedInventoryItemData"),l=$.value.find((t=>t.value===e.customer))?.label||null,o=L.value.find((t=>t.value===e.company))?.label||null;t?.consignment&&(t.consignment.customer=l,t.consignment.company=o,t?.consignment?.id===e.id&&d.A.set("EditSelectedInventoryItemData",t)),a&&(a.customer=l,a.company=o,a?.id===e.id&&d.A.set("SelectedInventoryItemData",a))},pe=()=>{A.value=!1,k.value=0,Object.keys(X).forEach((e=>delete X[e])),Object.keys(F).forEach((e=>delete F[e]))},me=e=>{C.value=!0,I.value=e},ye=async()=>{try{t.loading.show();const a=await(0,c.deleteauth)(`${o}/${I.value}/`);if(!a||"200"!==a.code&&200!==a.status)throw new Error;{fe();const a=I.value;u.value=u.value.filter((e=>e.id!==a)),Object.keys(g).forEach((e=>{g[e]=g[e].filter((e=>e.id!==a))})),Object.keys(b).forEach((e=>{b[e]=b[e].filter((e=>e.id!==a))})),oe.value?await le(K.value,{force:!0}):await ae(K.value,{force:!0}),t.notify({message:e("successful.delete"),color:"green"})}}catch{t.notify({message:e("error.delete"),color:"negative"})}finally{t.loading.hide()}},fe=()=>{C.value=!1,I.value=0},ge=e=>{d.A.set("SelectedInventoryItemData",e),a.push({name:"InventoryItemDetail"})},be=e=>A.value&&e.row.id===k.value?{backgroundColor:"#cbc6d2"}:{},he=[{round:!0,flat:!0,push:!0,color:"green",icon:"sym_r_check",action:de},{round:!0,flat:!0,push:!0,color:"red",icon:"sym_r_close",action:pe}],_e=(0,m.Kh)([{field:"customer",label:e("inventory.view_inventorylist.customer"),rules:[j],truncate:!0,truncateLength:35,options:$.value},{field:"company",label:e("inventory.view_inventorylist.company"),rules:[j],truncate:!0,truncateLength:35,options:L.value}]),we=[{round:!0,flat:!0,push:!0,color:"amber-2",icon:"sym_r_table_eye",tip:e("index.view_detail"),action:ge},{round:!0,flat:!0,push:!0,color:"amber-4",icon:"sym_r_edit",tip:e("edit"),action:ce},{round:!0,flat:!0,push:!0,color:"amber-13",icon:"sym_r_delete",tip:e("delete"),action:e=>me(e.id)}],ke=t=>{const a=[{name:"code",label:e("inventory.view_inventorylist.code"),field:"code",align:"center"},{name:"received_date",label:e("inventory.view_inventorylist.received_date"),field:"received_date",align:"center"},{name:"customer",label:e("inventory.view_inventorylist.customer"),field:"customer",align:"left"},{name:"company",label:e("inventory.view_inventorylist.company"),field:"company",align:"left"},{name:"status",label:e("inventory.view_inventorylist.status"),field:"status",align:"left"},{name:"total_weight",label:e("inventory.view_inventorylist.total_weight")+" (Viss)",field:"total_weight",align:"left"},{name:"total_amount",label:e("inventory.view_inventorylist.total_amount")+" (MMK)",field:"total_amount",align:"left"},{name:"creator",label:e("inventory.view_inventorylist.acceptedBy"),field:"creator",align:"left"}],l=[{name:"create_time",label:e("inventory.view_inventorylist.create_time"),field:"create_time",align:"left",sortable:!0}],o={name:"action",label:e("action"),align:"left"};return[...a.map((e=>({...e,headerStyle:"font-weight: bold; font-size: 13px"}))),..."Admin"===t?l.map((e=>({...e,headerStyle:"font-weight: bold; font-size: 13px"}))):[],{...o,headerStyle:"font-weight: bold; font-size: 13px"}]},Xe=(0,m.Kh)(ke(_.value)),Fe=(0,m.KR)(!1);return(0,l.sV)((()=>{Fe.value||(Fe.value=!0,Promise.all([(0,p.e7)(n),(0,p.e7)(r)]).finally((()=>{ae(1).catch((e=>console.error(e)))})))})),{pathname:o,loading:i,tableList:s,filter:w,pagination:V,editId:k,editFormData:X,editMode:A,deleteForm:C,deleteId:I,current:K,max:R,paginationIpt:W,changePageEnter:se,onFilterApply:ne,onFilterClear:re,reFresh:ie,editData:ce,editDataSubmit:de,editDataCancel:pe,deleteData:me,deleteDataSubmit:ye,resetDelete:fe,columns:Xe,t:e,q:t,customerFilteredOptions:q,companyFilteredOptions:D,customerList:$,companyList:L,viewDetail:ge,filtercustomer:B,filtercompany:T,router:a,validateSelectionValue:j,isEditFormValid:O,tooltip:Q,actionCellStyle:be,editActions:he,editableColumns:_e,rowActions:we,makeColumns:ke,allFetched:u,filterList:h,handlePaginationChange:ue}}};var h=a(2807),_=a(6653),w=a(6031),k=a(6384),X=a(7410),F=a(3676),A=a(9270),C=a(492),I=a(4488),K=a(5262),E=a(4700),x=a(2156),R=a(3316),S=a(8670),V=a(4189),W=a(2669),q=a(8672),D=a(8582),j=a.n(D);const O=(0,h.A)(b,[["render",u],["__scopeId","data-v-749fd976"]]),Q=O;j()(b,"components",{QTable:_.A,QBtnGroup:w.A,QBtn:k.A,QTooltip:X.A,QSpace:F.A,QInput:A.A,QIcon:C.A,QTr:I.A,QTd:K.A,QPagination:E.A,QDialog:x.A,QCard:R.A,QBar:S.A,QCardSection:V.A,QCardActions:W.A}),j()(b,"directives",{ClosePopup:q.A})}}]);