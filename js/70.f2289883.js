"use strict";(globalThis["webpackChunktbls"]=globalThis["webpackChunktbls"]||[]).push([[70],{5070:(e,t,o)=>{o.r(t),o.d(t,{default:()=>Ce});var l=o(1758),n=o(6683),a=o(2901);const i={class:"page-wrap"},s={class:"text-h6 text-primary"},r={class:"row items-center"},u={class:"text-h6"},d={class:"col-12 col-md"},c={class:"field-label"},m={class:"col-12 col-md"},v={class:"field-label"},g={class:"col-12 col-md"},y={class:"field-label"},p={class:"row items-center justify-end q-gutter-sm q-pa-sm"},b={class:"content-grid"},_={class:"rg-table-wrap"},h={class:"styled-table"},f={class:"sticky-head"},w={class:"cell-left"},k={class:"text-center actions-cell"},F={class:"text-subtitle1 text-weight-bold"},q={class:"totals-values"},C={key:0},L={class:"tot-row"},E={class:"tot-label"},N={class:"tot-value"},S={class:"tot-row"},A={class:"tot-label"},x={class:"tot-value"},D={key:0,class:"expanded-summary"},I={class:"tot-row",style:{opacity:"0.85"}},V={class:"tot-label"},R={class:"tot-value"},K={class:"tot-row",style:{opacity:"0.85"}},P={class:"tot-label"},T={class:"tot-value"},W={class:"tot-row"},U={class:"tot-label"},Q={class:"tot-value"},O={class:"tot-row"},$={class:"tot-label"},j={class:"tot-value"},B={class:"text-h6"},X={class:"text-h6"},G={class:"sticky-actions"};function H(e,t,o,H,J,M){const z=(0,l.g2)("q-icon"),Y=(0,l.g2)("q-tooltip"),Z=(0,l.g2)("q-btn"),ee=(0,l.g2)("q-avatar"),te=(0,l.g2)("q-card-section"),oe=(0,l.g2)("q-separator"),le=(0,l.g2)("q-card-actions"),ne=(0,l.g2)("q-card"),ae=(0,l.g2)("q-dialog"),ie=(0,l.g2)("q-item-section"),se=(0,l.g2)("q-item"),re=(0,l.g2)("q-select"),ue=(0,l.g2)("q-date"),de=(0,l.g2)("q-popup-proxy"),ce=(0,l.g2)("q-input"),me=(0,l.gN)("close-popup");return(0,l.uX)(),(0,l.Wv)(n.eB,{appear:"","enter-active-class":"animated fadeIn"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",i,[(0,l.bF)(ne,{class:"card"},{default:(0,l.k6)((()=>[(0,l.bF)(te,{class:"row q-col-gutter-md items-center justify-between"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",s,[(0,l.bF)(z,{name:"sym_r_inventory",class:"title-icon"}),(0,l.eW)(" "+(0,a.v_)(H.t("inventory.inventoryEdit.title"))+" ",1),(0,l.Lk)("span",null," - "+(0,a.v_)(H.consignmentId),1)]),(0,l.Lk)("div",r,[(0,l.bF)(Z,{icon:"sym_r_reset_wrench",onClick:t[0]||(t[0]=e=>H.unwindDialog=!0),label:H.t("inventory.unwind"),class:"q-mr-sm","no-caps":"",color:"primary",dense:"",push:""},{default:(0,l.k6)((()=>[(0,l.bF)(Y,(0,a._B)((0,l.Ng)(H.tooltip)),{default:(0,l.k6)((()=>[(0,l.eW)((0,a.v_)(H.t("inventory.unwindTip")),1)])),_:1},16)])),_:1},8,["label"]),(0,l.bF)(ae,{modelValue:H.unwindDialog,"onUpdate:modelValue":t[2]||(t[2]=e=>H.unwindDialog=e),persistent:""},{default:(0,l.k6)((()=>[(0,l.bF)(ne,{style:{"min-width":"340px","max-width":"92vw"}},{default:(0,l.k6)((()=>[(0,l.bF)(te,{class:"row items-center q-gutter-sm"},{default:(0,l.k6)((()=>[(0,l.bF)(ee,{icon:"sym_r_reset_wrench",color:"primary","text-color":"white"}),(0,l.Lk)("div",u,(0,a.v_)(H.t("inventory.inventoryEdit.confirmUnwind")||"Confirm Unwind"),1)])),_:1}),(0,l.bF)(oe),(0,l.bF)(te,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,a.v_)(H.t("inventory.inventoryEdit.confirmUnwindContent")||"Are you sure you want to reload the original data? Unsaved changes will be lost."),1)])),_:1}),(0,l.bF)(le,{align:"right",class:"q-pa-md"},{default:(0,l.k6)((()=>[(0,l.bo)((0,l.bF)(Z,{flat:"",label:H.t("inventory.inventoryEdit.cancel"),color:"negative",icon:"sym_r_close"},null,8,["label"]),[[me]]),(0,l.bF)(Z,{color:"primary",label:H.t("inventory.inventoryEdit.ok"),icon:"sym_r_check",onClick:t[1]||(t[1]=e=>{H.unwindDialog=!1,H.reFresh()})},null,8,["label"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])])),_:1}),(0,l.bF)(oe),(0,l.bF)(te,{class:"row q-col-gutter-md items-end filter-row"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",d,[(0,l.Lk)("div",c,(0,a.v_)(H.t("inventory.inventoryEdit.customer")),1),(0,l.bF)(re,{dense:"",filled:"",clearable:"",modelValue:H.selectedCustomer,"onUpdate:modelValue":t[3]||(t[3]=e=>H.selectedCustomer=e),options:H.customerFilteredOptions,onFilter:H.onCustomerFilter,"input-debounce":"600","use-input":H.customerUseInput,behavior:"menu","emit-value":"","map-options":"","option-label":e=>e?.label??e,"option-value":e=>e?.value??null,loading:H.loading,disable:H.loading,hint:"Start typing to search",class:"input-field",onPopupHide:H.onCustomerSelected,onPopupShow:H.onCustomerPopupShow,onClear:H.onCustomerCleared},{prepend:(0,l.k6)((()=>[(0,l.bF)(z,{name:"sym_r_people"})])),"no-option":(0,l.k6)((()=>[(0,l.bF)(se,null,{default:(0,l.k6)((()=>[(0,l.bF)(ie,{class:"text-grey"},{default:(0,l.k6)((()=>[(0,l.eW)((0,a.v_)(e.$t("noResults")),1)])),_:1})])),_:1})])),_:1},8,["modelValue","options","onFilter","use-input","option-label","option-value","loading","disable","onPopupHide","onPopupShow","onClear"])]),(0,l.Lk)("div",m,[(0,l.Lk)("div",v,(0,a.v_)(H.t("inventory.inventoryEdit.company")),1),(0,l.bF)(re,{dense:"",filled:"",clearable:"",modelValue:H.selectedCompany,"onUpdate:modelValue":t[4]||(t[4]=e=>H.selectedCompany=e),options:H.companyFilteredOptions,onFilter:H.onCompanyFilter,"input-debounce":"600","use-input":H.companyUseInput,behavior:"menu","emit-value":"","map-options":"","option-label":e=>e?.label??e,"option-value":e=>e?.value??null,loading:H.loading,disable:H.loading,hint:"Start typing to search",class:"input-field",onPopupHide:H.onCompanySelected,onPopupShow:H.onCompanyPopupShow,onClear:H.onCompanyCleared},{prepend:(0,l.k6)((()=>[(0,l.bF)(z,{name:"sym_r_business"})])),"no-option":(0,l.k6)((()=>[(0,l.bF)(se,null,{default:(0,l.k6)((()=>[(0,l.bF)(ie,{class:"text-grey"},{default:(0,l.k6)((()=>[(0,l.eW)((0,a.v_)(e.$t("noResults")),1)])),_:1})])),_:1})])),_:1},8,["modelValue","options","onFilter","use-input","option-label","option-value","loading","disable","onPopupHide","onPopupShow","onClear"])]),(0,l.Lk)("div",g,[(0,l.Lk)("div",y,(0,a.v_)(H.t("inventory.inventoryEdit.receivedDate")),1),(0,l.bF)(ce,{dense:"",filled:"",modelValue:H.date,"onUpdate:modelValue":t[6]||(t[6]=e=>H.date=e),mask:"date",rules:["date"],class:"input-field"},{append:(0,l.k6)((()=>[(0,l.bF)(z,{name:"sym_r_event",color:"primary",class:"cursor-pointer"},{default:(0,l.k6)((()=>[(0,l.bF)(de,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,l.k6)((()=>[(0,l.bF)(ue,{modelValue:H.date,"onUpdate:modelValue":t[5]||(t[5]=e=>H.date=e)},{default:(0,l.k6)((()=>[(0,l.Lk)("div",p,[(0,l.bo)((0,l.bF)(Z,{flat:"",color:"primary",label:"Close"},null,512),[[me]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])])),_:1})])),_:1}),(0,l.Lk)("div",b,[(0,l.bF)(ne,{class:"card table-card"},{default:(0,l.k6)((()=>[(0,l.bF)(te,{class:"p-none"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",_,[(0,l.Lk)("table",h,[(0,l.Lk)("thead",null,[(0,l.Lk)("tr",f,[(0,l.Lk)("th",null,(0,a.v_)(H.t("inventory.inventoryEdit.particular")),1),(0,l.Lk)("th",null,(0,a.v_)(H.t("inventory.inventoryEdit.quantity")),1),(0,l.Lk)("th",null,(0,a.v_)(H.t("inventory.inventoryEdit.rate")),1),(0,l.Lk)("th",null,(0,a.v_)(H.t("inventory.inventoryEdit.totalWeight")),1),(0,l.Lk)("th",null,(0,a.v_)(H.t("inventory.inventoryEdit.totalAmount")),1),(0,l.Lk)("th",null,(0,a.v_)(H.t("inventory.inventoryEdit.delete")),1)])]),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(H.rows,((e,t)=>((0,l.uX)(),(0,l.CE)("tr",{key:e.__rowId,class:(0,a.C4)(["table-row",{"odd-row":t%2===1}])},[(0,l.Lk)("td",w,[(0,l.bF)(re,{dense:"",filled:"",modelValue:e.goods,"onUpdate:modelValue":[t=>e.goods=t,t=>H.handleGoodsSelect(t,e)],options:H.goodsFilteredOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"","use-input":"","input-debounce":"600",onFilter:H.onGoodsFilter,behavior:"menu",class:"select-cell"},{"no-option":(0,l.k6)((()=>[(0,l.bF)(se,null,{default:(0,l.k6)((()=>[(0,l.bF)(ie,{class:"text-grey"},{default:(0,l.k6)((()=>[(0,l.eW)((0,a.v_)(H.t("noResults")),1)])),_:1})])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue","options","onFilter"])]),(0,l.Lk)("td",null,[(0,l.bF)(ce,{dense:"",filled:"",type:"number",modelValue:e.quantity,"onUpdate:modelValue":[t=>e.quantity=t,()=>H.onRowChange(e)],modelModifiers:{number:!0},class:"center-input","input-class":"center-input",maxlength:"6"},null,8,["modelValue","onUpdate:modelValue"])]),(0,l.Lk)("td",null,[(0,l.bF)(ce,{dense:"",filled:"",type:"number","model-value":e.goods.rate||0,readonly:"",class:"right-input"},null,8,["model-value"])]),(0,l.Lk)("td",null,[(0,l.bF)(ce,{dense:"",filled:"",type:"number","model-value":(e.goods.weight||0)*(Number(e.quantity)||0),readonly:"",class:"right-input"},null,8,["model-value"])]),(0,l.Lk)("td",null,[(0,l.bF)(ce,{dense:"",filled:"",type:"number","model-value":(e.goods.rate||0)*(Number(e.quantity)||0),readonly:"",class:"right-input"},null,8,["model-value"])]),(0,l.Lk)("td",k,[(0,l.bF)(Z,{round:"",dense:"",flat:"",color:"primary",icon:"sym_r_delete",onClick:e=>H.openDeleteDialog(t)},{default:(0,l.k6)((()=>[(0,l.bF)(Y,(0,l.v6)({ref_for:!0},H.tooltip),{default:(0,l.k6)((()=>[(0,l.eW)((0,a.v_)(H.t("index.removeRow")),1)])),_:1},16)])),_:2},1032,["onClick"])])],2)))),128))])])])])),_:1})])),_:1}),(0,l.bF)(ne,{class:"totals-card totals-col"},{default:(0,l.k6)((()=>[(0,l.bF)(te,null,{default:(0,l.k6)((()=>[(0,l.Lk)("div",F,(0,a.v_)(H.t("inventory.inventoryEdit.grandSummary")),1),(0,l.bF)(oe),(0,l.Lk)("div",q,[H.isDirty?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",C,[(0,l.Lk)("div",L,[(0,l.Lk)("div",E,(0,a.v_)(H.t("inventory.inventoryEdit.grandTotalWeight"))+": ",1),(0,l.Lk)("div",N,(0,a.v_)(H.formatNumber(H.originalTotals.weight))+" Vs ",1)]),(0,l.Lk)("div",S,[(0,l.Lk)("div",A,(0,a.v_)(H.t("inventory.inventoryEdit.grandTotalAmount"))+": ",1),(0,l.Lk)("div",x,(0,a.v_)(H.formatNumber(H.originalTotals.amount))+" Ks ",1)])])),(0,l.bF)(n.eB,{name:"fade"},{default:(0,l.k6)((()=>[H.isDirty&&H.expandedSummary?((0,l.uX)(),(0,l.CE)("div",D,[(0,l.Lk)("div",I,[(0,l.Lk)("div",V," Original - "+(0,a.v_)(H.t("inventory.inventoryEdit.grandTotalWeight"))+": ",1),(0,l.Lk)("div",R,(0,a.v_)(H.formatNumber(H.originalTotals.weight))+" Vs ",1)]),(0,l.Lk)("div",K,[(0,l.Lk)("div",P," Original - "+(0,a.v_)(H.t("inventory.inventoryEdit.grandTotalAmount"))+": ",1),(0,l.Lk)("div",T,(0,a.v_)(H.formatNumber(H.originalTotals.amount))+" Ks ",1)]),(0,l.bF)(oe,{class:"q-my-sm"}),(0,l.Lk)("div",W,[(0,l.Lk)("div",U," Pending - "+(0,a.v_)(H.t("inventory.inventoryEdit.grandTotalWeight"))+": ",1),(0,l.Lk)("div",Q,(0,a.v_)(H.formatNumber(H.editedTotals.weight))+" Vs ",1)]),(0,l.Lk)("div",O,[(0,l.Lk)("div",$," Pending - "+(0,a.v_)(H.t("inventory.inventoryEdit.grandTotalAmount"))+": ",1),(0,l.Lk)("div",j,(0,a.v_)(H.formatNumber(H.editedTotals.amount))+" Ks ",1)])])):(0,l.Q3)("",!0)])),_:1})])])),_:1})])),_:1})]),(0,l.bF)(ae,{modelValue:H.submitDialog,"onUpdate:modelValue":t[7]||(t[7]=e=>H.submitDialog=e),persistent:""},{default:(0,l.k6)((()=>[(0,l.bF)(ne,{style:{"min-width":"360px","max-width":"92vw"}},{default:(0,l.k6)((()=>[(0,l.bF)(te,{class:"row items-center q-gutter-sm"},{default:(0,l.k6)((()=>[(0,l.bF)(ee,{icon:"sym_r_box_edit",color:"primary","text-color":"white"}),(0,l.Lk)("div",B,(0,a.v_)(H.t("inventory.inventoryEdit.confirmSave")),1)])),_:1}),(0,l.bF)(oe),(0,l.bF)(te,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,a.v_)(H.t("inventory.inventoryEdit.confirmSaveContent")),1)])),_:1}),(0,l.bF)(le,{align:"right",class:"q-pa-md"},{default:(0,l.k6)((()=>[(0,l.bo)((0,l.bF)(Z,{flat:"",label:H.t("inventory.inventoryEdit.cancel"),color:"negative",icon:"sym_r_close"},null,8,["label"]),[[me]]),(0,l.bF)(Z,{color:"primary",label:H.t("inventory.inventoryEdit.ok"),icon:"sym_r_check",onClick:H.submitData},null,8,["label","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,l.bF)(ae,{modelValue:H.deleteDialog,"onUpdate:modelValue":t[9]||(t[9]=e=>H.deleteDialog=e),persistent:""},{default:(0,l.k6)((()=>[(0,l.bF)(ne,{style:{"min-width":"360px","max-width":"92vw"}},{default:(0,l.k6)((()=>[(0,l.bF)(te,{class:"row items-center q-gutter-sm"},{default:(0,l.k6)((()=>[(0,l.bF)(ee,{icon:"sym_r_delete_forever",color:"primary","text-color":"white"}),(0,l.Lk)("div",X,(0,a.v_)(H.t("inventory.inventoryEdit.confirmDelete")),1)])),_:1}),(0,l.bF)(oe),(0,l.bF)(te,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,a.v_)(H.t("inventory.inventoryEdit.confirmDeleteContent")),1)])),_:1}),(0,l.bF)(le,{align:"right",class:"q-pa-md"},{default:(0,l.k6)((()=>[(0,l.bo)((0,l.bF)(Z,{flat:"",label:H.t("inventory.inventoryEdit.cancel"),color:"negative",icon:"sym_r_close",onClick:t[8]||(t[8]=e=>H.deleteIndex=null)},null,8,["label"]),[[me]]),(0,l.bF)(Z,{color:"primary",label:H.t("inventory.inventoryEdit.ok"),icon:"sym_r_check",onClick:H.confirmDelete},null,8,["label","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,l.Lk)("div",G,[(0,l.bF)(Z,{color:"positive",icon:"sym_r_add",label:H.t("inventory.inventoryEdit.addRow"),onClick:H.addRow,"no-caps":""},null,8,["label","onClick"]),(0,l.bF)(Z,{color:"primary",icon:"sym_r_box_edit",label:H.t("inventory.inventoryEdit.saveChanges"),onClick:t[10]||(t[10]=e=>H.submitDialog=!0)},null,8,["label"])])])])),_:1})}o(310),o(5962),o(2203),o(95),o(6724),o(2802),o(7225),o(8743),o(2858),o(2071),o(5520),o(2775),o(6203);var J=o(555),M=o(3537),z=o(4907),Y=o(1271),Z=o(2261),ee=o(7144);let te=0;const oe=()=>({__rowId:`row-${Date.now()}-${te++}`,goods:{label:"",value:null,rate:0,weight:0},quantity:null,id:null}),le={name:"InventoryEditPage",setup(){const{t:e}=(0,M.s9)(),t=(0,z.A)(),o=(0,J.KR)(!1),n=(0,J.KR)(Y.A.getItem("EditSelectedInventoryItemData")||null),a=(0,J.KR)([]),i=(0,J.KR)(null),s=(0,J.KR)(null),r=(0,J.KR)((new Date).toISOString().slice(0,10)),u="consignment",d="receivegoods",c=(0,J.KR)(0),m=(0,J.KR)(0),v=(0,J.KR)(!0),g=(0,J.KR)(!1),y=(0,J.KR)(!1),p=(0,J.KR)(!1),b=(0,J.KR)(null),_={class:"bg-blue text-white shadow-4",offset:[10,10],contentStyle:"font-size: 12px"},h=(0,l.EW)((()=>n.value?.consignment?.code||null)),f=(0,J.KR)([]),w=(0,J.KR)([]),k=(0,J.KR)([]),F=(0,l.EW)((()=>(Y.A.getItem("customer")||[]).map((e=>({label:e.name,value:e.id}))))),q=(0,l.EW)((()=>(Y.A.getItem("company")||[]).map((e=>({label:e.name,value:e.id}))))),C=(0,l.EW)((()=>(Y.A.getItem("goods")||[]).map((e=>({label:e.goods_desc||e.name||"",value:e.id,rate:e.rate??e.goods_rate??0,weight:e.weight??e.goods_weight??0}))))),L=(0,J.KR)(!1),E=(0,J.KR)(!1),N=e=>{if(null===e||void 0===e||""===e)return null;const t=Number(e);return Number.isNaN(t)?null:t},S=e=>(new Intl.NumberFormat).format(Number(e||0)),A=e=>null==e?null:"object"===typeof e?e.value??e.id??null:e,x=(e,t)=>{if(null==e&&null==t)return!0;if(!e||!t)return!1;const o=e&&void 0!==e.value?e.value:e,l=t&&void 0!==t.value?t.value:t;return o===l||JSON.stringify(o)===JSON.stringify(l)},D=(0,J.KR)({amount:Number(n.value?.consignment?.total_amount)||0,weight:Number(n.value?.consignment?.total_weight)||0}),I=(0,J.KR)(!1),V=(0,J.KR)(!1),R=(0,l.EW)((()=>{const e=a.value.reduce(((e,t)=>{const o=Number(t.quantity)||0,l=Number(t?.goods?.rate)||0;return e+l*o}),0),t=a.value.reduce(((e,t)=>{const o=Number(t.quantity)||0,l=Number(t?.goods?.weight)||0;return e+l*o}),0);return{amount:e,weight:t}}));function K(){L.value=!0}function P(){L.value=!1}function T(){L.value=!0,i.value=null}function W(){E.value=!0}function U(){E.value=!1}function Q(){s.value=null,E.value=!0}(0,l.wB)((()=>[R.value.amount,R.value.weight,i.value,s.value,r.value]),(([e,t])=>{const o=e!==(D.value.amount||0)||t!==(D.value.weight||0);I.value=o,V.value=!!o}),{immediate:!0});const O=(e,t)=>(o,l)=>{const n=(o||"").toString().trim().toLowerCase();l((()=>{t.value=n?e.value.filter((e=>(e?.label||"").toString().toLowerCase().includes(n))):e.value}))},$=O(F,f),j=O(q,w),B=O(C,k),X=()=>{f.value=F.value,w.value=q.value,k.value=C.value},G=()=>{try{if(t.loading.show(),!n.value)return t.notify({message:e("error.no_data")||"No Data Selected",icon:"sym_r_close",color:"negative"}),void(a.value=[]);const o=n.value;i.value=o.consignment?.customer??null,s.value=o.consignment?.company??null,r.value=o.consignment?.received_date??r.value,m.value=Number(o.consignment?.total_amount)||0,c.value=Number(o.consignment?.total_weight)||0,D.value={amount:Number(o.consignment?.total_amount)||0,weight:Number(o.consignment?.total_weight)||0},I.value=!1,V.value=!1,a.value=(o.goodsList||[]).map((e=>{const t=e.goods&&"object"===typeof e.goods?{label:e.goods.label??e.goods.name??"",value:e.goods.value??e.goods.id??e.goods,rate:e.goods.rate??e.goods.goods_rate??e.goods?.goods_rate??0,weight:e.goods.weight??e.goods.goods_weight??0}:{label:"",value:e.goods??null,rate:0,weight:0};return{__rowId:`row-${Date.now()}-${te++}`,id:e.id??null,goods:t,quantity:e.quantity??e.qty??null}})),X(),ae()}catch{t.notify({message:e("error.fetch"),icon:"sym_r_close",color:"negative"})}finally{t.loading.hide()}},H=()=>a.value.push(oe()),le=e=>{b.value=e,p.value=!0},ne=()=>{null!==b.value&&b.value>=0&&b.value<a.value.length&&(a.value.splice(b.value,1),ae()),p.value=!1,b.value=null},ae=()=>{m.value=a.value.reduce(((e,t)=>{const o=Number(t.quantity)||0,l=Number(t?.goods?.rate)||0;return e+l*o}),0),c.value=a.value.reduce(((e,t)=>{const o=Number(t.quantity)||0,l=Number(t?.goods?.weight)||0;return e+l*o}),0)},ie=e=>{e.quantity=N(e.quantity),e.goods||(e.goods={label:"",value:null,rate:0,weight:0}),e.goods.rate=Number(e.goods.rate)||0,e.goods.weight=Number(e.goods.weight)||0,ae()};function se(e,t){const o=A(e),l=C.value.find((e=>e.value===o));t.goods=l?{label:l.label,value:l.value,rate:Number(l.rate)||0,weight:Number(l.weight)||0}:{label:"object"===typeof e?e.label??"":"",value:o,rate:0,weight:0},ie(t)}const re=()=>{const e=(n.value?.goodsList||[]).slice(),t=a.value.filter((e=>null!=A(e.goods)&&null!=e.quantity&&""!==e.quantity)),o=new Map;e.forEach((e=>{null!=e.id&&o.set(e.id,e)}));const l={create:[],edit:[],remove:[]},u=new Set;t.forEach((e=>{if(!e.id)return void l.create.push({goods:{value:A(e.goods),label:e.goods?.label,rate:e.goods?.rate||0,weight:e.goods?.weight||0},quantity:e.quantity});u.add(e.id);const t=o.get(e.id)||{},n={},a=(()=>{const e=t.goods;return null==e?null:"object"===typeof e?e.value??e.id??e:e})();A(e.goods)!==a&&(n.goods=e.goods),e.quantity!==(t.quantity??t.qty)&&(n.quantity=e.quantity),Object.keys(n).length&&l.edit.push({id:e.id,data:n})})),e.forEach((e=>{null==e.id||u.has(e.id)||l.remove.push(e.id)}));const d={},c=n.value?.consignment||{};return i.value&&!x(i.value,c.customer)&&(d.customer=i.value),s.value&&!x(s.value,c.company)&&(d.company=s.value),r.value!==c.received_date&&(d.received_date=r.value),Object.keys(d).length&&(l.consignment=d),console.log(l),l},ue=async()=>{try{t.loading.show();const o=re(),l=(!o.create||0===o.create.length)&&(!o.edit||0===o.edit.length)&&(!o.remove||0===o.remove.length)&&!o.consignment;if(l)return void t.notify({message:e("warning.no_changes"),color:"warning"});const a=(n.value?.goodsList||[]).slice();if(o.create&&o.create.length&&await Promise.all(o.create.map((async o=>{const l={consignment:n.value.consignment.id,goods:o.goods.value,quantity:o.quantity},i=await(0,Z.postauth)(`${d}/`,l);"200"===i?.code&&i.data?a.push({id:i.data.id,goods:o.goods,quantity:o.quantity,total_amount:o.quantity*o.goods.rate,total_weight:o.quantity*o.goods.weight}):t.notify({message:e("error.error"),icon:"sym_r_close",color:"negative"})}))),o.remove&&o.remove.length&&await Promise.all(o.remove.map((async o=>{const l=await(0,Z.deleteauth)(`receivegoods/${o}`);if("200"===l?.code){const e=a.findIndex((e=>e.id===o));-1!==e&&a.splice(e,1)}else t.notify({message:e("error.error"),icon:"sym_r_close",color:"negative"})}))),o.edit&&o.edit.length&&await Promise.all(o.edit.map((async o=>{const l={};o.data.goods&&(l.goods=A(o.data.goods)),null!=o.data.quantity&&(l.quantity=o.data.quantity);const n=await(0,Z.patchauth)(`receivegoods/${o.id}/`,l);if("200"===n?.code){const e=a.findIndex((e=>e.id===o.id));if(-1!==e){if(l.goods){const t=C.value.find((e=>e.value===l.goods));a[e].goods=t?{...t}:{label:String(l.goods),value:l.goods}}"quantity"in l&&(a[e].quantity=l.quantity)}}else t.notify({message:e("error.error"),icon:"sym_r_close",color:"negative"})}))),o.consignment){const l={};if(o.consignment.customer&&(l.customer=o.consignment.customer),o.consignment.company&&(l.company=o.consignment.company),o.consignment.received_date&&(l.received_date=o.consignment.received_date),Object.keys(l).length){const o=await(0,Z.patchauth)(`${u}/${n.value.consignment.id}/`,l);if("200"!==o?.code)return void t.notify({message:e("error.error"),icon:"sym_r_close",color:"negative"});l.customer&&(n.value.consignment.customer=F.value.find((e=>e.value===l.customer)).label),l.company&&(n.value.consignment.company=q.value.find((e=>e.value===l.company)).label),l.received_date&&(n.value.consignment.received_date=l.received_date)}}n.value.consignment.total_amount=Number(m.value)||0,n.value.consignment.total_weight=Number(c.value)||0,n.value.goodsList=a,D.value={amount:Number(n.value.consignment.total_amount)||0,weight:Number(n.value.consignment.total_weight)||0},I.value=!1,V.value=!1,Y.A.setItem("SelectedInventoryItemData",n.value.consignment),Y.A.setItem("EditSelectedInventoryItemData",n.value),y.value=!1,de(),t.notify({message:e("success.save"),icon:"sym_r_check",color:"green"})}catch{t.notify({message:e("error.error"),icon:"sym_r_close",color:"negative"})}finally{t.loading.hide()}},de=()=>G(),ce=async()=>{const o=!Y.A.has("customer"),l=!Y.A.has("goods"),n=!Y.A.has("company"),a=[];if(o&&a.push((0,ee.e7)("customer")),l&&a.push((0,ee.e7)("goods")),n&&a.push((0,ee.e7)("company")),a.length){g.value=!0;try{await Promise.all(a)}catch{t.notify({message:e("error.fetch"),icon:"sym_r_close",color:"negative"})}finally{g.value=!1}}X()};return(0,l.sV)((async()=>{await ce(),G()})),{t:e,q:t,rows:a,unwindDialog:o,selectedCustomer:i,selectedCompany:s,originalTotals:D,isDirty:I,expandedSummary:V,editedTotals:R,date:r,grandTotalAmount:m,grandTotalWeight:c,dense:v,loading:g,submitDialog:y,deleteDialog:p,tooltip:_,customerFilteredOptions:f,companyFilteredOptions:w,goodsFilteredOptions:k,onCustomerFilter:$,onCompanyFilter:j,onGoodsFilter:B,addRow:H,openDeleteDialog:le,confirmDelete:ne,handleGoodsSelect:se,onRowChange:ie,submitData:ue,reFresh:de,formatNumber:S,customerUseInput:L,companyUseInput:E,onCustomerPopupShow:K,onCustomerSelected:P,onCustomerCleared:T,onCompanyPopupShow:W,onCompanySelected:U,onCompanyCleared:Q,consignmentId:h,deleteIndex:b}}};var ne=o(2807),ae=o(3316),ie=o(4189),se=o(492),re=o(6384),ue=o(7410),de=o(2156),ce=o(3952),me=o(386),ve=o(2669),ge=o(4940),ye=o(124),pe=o(5173),be=o(9270),_e=o(1356),he=o(8462),fe=o(7156),we=o(8672),ke=o(8582),Fe=o.n(ke);const qe=(0,ne.A)(le,[["render",H],["__scopeId","data-v-deb518e8"]]),Ce=qe;Fe()(le,"components",{QCard:ae.A,QCardSection:ie.A,QIcon:se.A,QBtn:re.A,QTooltip:ue.A,QDialog:de.A,QAvatar:ce.A,QSeparator:me.A,QCardActions:ve.A,QSelect:ge.A,QItem:ye.A,QItemSection:pe.A,QInput:be.A,QPopupProxy:_e.A,QDate:he.A,QField:fe.A}),Fe()(le,"directives",{ClosePopup:we.A})}}]);