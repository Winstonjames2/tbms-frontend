"use strict";(globalThis["webpackChunktbls"]=globalThis["webpackChunktbls"]||[]).push([[0],{2e3:(e,t,a)=>{a.r(t),a.d(t,{default:()=>M});var l=a(1758),s=a(6683),o=a(2901);const i={key:0,class:"q-mt-md"},d={class:"c-main-header"},n={class:"self-center full-width no-outline",tabindex:"0"},r={class:"self-center full-width no-outline",tabindex:"0"},c={class:"self-center full-width no-outline",tabindex:"0"},u={key:0,class:"add-btn"},_={class:"c-main-body custom-scrollbar-color"},p={class:"c-main-footer"},k={class:"self-center full-width no-outline",tabindex:"0"},b={class:"self-center full-width no-outline text-bold",tabindex:"0"},h={class:"row items-center justify-end q-gutter-sm q-pa-sm"},m={class:"self-center full-width no-outline text-bold",tabindex:"0"},v={key:1,class:"empty-state"};function f(e,t,a,f,y,g){const w=(0,l.g2)("q-field"),F=(0,l.g2)("q-item-section"),C=(0,l.g2)("q-item"),x=(0,l.g2)("q-list"),E=(0,l.g2)("q-menu"),A=(0,l.g2)("q-btn"),D=(0,l.g2)("q-separator"),B=(0,l.g2)("q-item-label"),N=(0,l.g2)("q-input"),K=(0,l.g2)("q-icon"),q=(0,l.g2)("q-date"),W=(0,l.g2)("q-popup-proxy"),$=(0,l.g2)("q-card"),L=(0,l.gN)("close-popup");return f.truckDispatchData?((0,l.uX)(),(0,l.CE)("div",i,[(0,l.bF)(s.eB,{appear:"","enter-active-class":"animated fadeIn"},{default:(0,l.k6)((()=>[(0,l.bF)($,{class:"c-main-container custom-scrollbar-color shadow-4"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",d,[(0,l.bF)(w,{label:e.$t("costBreakdown.view_cost.truck"),dense:"","stack-label":"",readonly:"",standout:"",style:{width:"170px"}},{control:(0,l.k6)((()=>[(0,l.Lk)("div",n,(0,o.v_)(f.truckDispatchData.truck||"-"),1)])),_:1},8,["label"]),(0,l.bF)(w,{label:e.$t("costBreakdown.view_cost.truckDispatchCode"),dense:"","stack-label":"",style:{"min-width":"150px"},readonly:"",standout:""},{control:(0,l.k6)((()=>[(0,l.Lk)("div",r,(0,o.v_)(f.truckDispatchData.code||"-"),1)])),_:1},8,["label"]),(0,l.bF)(w,{label:e.$t("costBreakdown.view_cost.truckDriver"),dense:"","stack-label":"",readonly:"",standout:"",class:"turnicate-cell"},{control:(0,l.k6)((()=>[(0,l.Lk)("div",c,(0,o.v_)(f.truckDispatchData.truck_driver||"-"),1)])),_:1},8,["label"]),f.isEdit?((0,l.uX)(),(0,l.CE)("div",u,[(0,l.bF)(A,{label:"Add Cost",icon:"sym_r_add_diamond",color:"primary","no-caps":"","fab-mini":""},{default:(0,l.k6)((()=>[(0,l.bF)(E,{"auto-close":"","transition-show":"jump-down","transition-hide":"jump-up"},{default:(0,l.k6)((()=>[(0,l.bF)(x,{dense:"",style:{"min-width":"180px"}},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(f.availableCostOptions,(e=>(0,l.bo)(((0,l.uX)(),(0,l.Wv)(C,{key:e.value,clickable:"",onClick:t=>f.addNewEditField(e.value)},{default:(0,l.k6)((()=>[(0,l.bF)(F,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(e.label),1)])),_:2},1024)])),_:2},1032,["onClick"])),[[L]]))),128))])),_:1})])),_:1})])),_:1})])):(0,l.Q3)("",!0)]),(0,l.bF)(D,{spaced:""}),(0,l.Lk)("div",_,[(0,l.bF)(x,{class:"cost-list",separator:""},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(f.visibleKeys,(e=>((0,l.uX)(),(0,l.Wv)(C,{key:e,class:"q-py-sm row items-center no-wrap"},{default:(0,l.k6)((()=>[f.isEdit?((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[(0,l.bF)(F,null,{default:(0,l.k6)((()=>[((0,l.uX)(),(0,l.Wv)(N,{key:"edit-"+e,label:f.labelByKey(e),dense:"",outlined:"",highlight:"","hide-bottom-space":"",modelValue:f.editForm[e],"onUpdate:modelValue":t=>f.editForm[e]=t,modelModifiers:{number:!0},style:{width:"170px"}},null,8,["label","modelValue","onUpdate:modelValue"]))])),_:2},1024),f.isCoreCost(e)?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(F,{key:0,style:{position:"absolute",right:"0"},side:""},{default:(0,l.k6)((()=>[(0,l.bF)(A,{icon:"sym_r_close",flat:"",size:"sm",color:"negative",label:"Remove",onClick:t=>f.removeEditField(e),"aria-label":"remove field"},null,8,["onClick"])])),_:2},1024))],64)):((0,l.uX)(),(0,l.CE)(l.FK,{key:0},[(0,l.bF)(F,{class:"cost-label-section"},{default:(0,l.k6)((()=>[(0,l.bF)(B,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(f.labelByKey(e)),1)])),_:2},1024)])),_:2},1024),(0,l.bF)(F,{side:""},{default:(0,l.k6)((()=>[(0,l.bF)(B,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(f.formatNumber(f.costData[e])),1)])),_:2},1024)])),_:2},1024)],64))])),_:2},1024)))),128)),f.hasHiddenCosts?((0,l.uX)(),(0,l.Wv)(A,{key:0,label:f.showAllCosts?e.$t("costBreakdown.view_cost.showLess"):e.$t("costBreakdown.view_cost.showAll"),icon:f.showAllCosts?"sym_r_expand_less":"sym_r_expand_more",flat:"",color:"primary",onClick:t[0]||(t[0]=e=>f.showAllCosts=!f.showAllCosts),class:"q-mt-sm",style:{margin:"0 auto",width:"40%","max-width":"200px"}},null,8,["label","icon"])):(0,l.Q3)("",!0)])),_:1})]),(0,l.bF)(D,{spaced:""}),(0,l.Lk)("div",p,[f.isEdit?((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[(0,l.Lk)("div",null,[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)(["dispatch_start_date","dispatch_end_date"],(t=>(0,l.bF)(N,{key:"edit-date-"+t,modelValue:f.editForm[t],"onUpdate:modelValue":e=>f.editForm[t]=e,outlined:"",mask:"date",dense:"",style:{width:"180px"},label:e.$t("costBreakdown.view_cost."+("dispatch_start_date"===t?"dispatchedDate":"finishedDate"))},{prepend:(0,l.k6)((()=>[(0,l.bF)(K,{name:"sym_r_event",color:"primary",class:"cursor-pointer"},{default:(0,l.k6)((()=>[(0,l.bF)(W,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,l.k6)((()=>[(0,l.bF)(q,{modelValue:f.editForm[t],"onUpdate:modelValue":e=>f.editForm[t]=e},{default:(0,l.k6)((()=>[(0,l.Lk)("div",h,[(0,l.bo)((0,l.bF)(A,{flat:"",color:"primary",label:"Close"},null,512),[[L]])])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["modelValue","onUpdate:modelValue","label"]))),64)),(0,l.bF)(w,{dense:"","stack-label":"",style:{"min-width":"180px"},label:e.$t("costBreakdown.view_cost.totalCost"),class:"text-weight-bold",square:"",disable:"",suffix:e.$t("kyats")},{control:(0,l.k6)((()=>[(0,l.Lk)("div",m,(0,o.v_)(f.formatNumber(f.displayedTotal)),1)])),_:1},8,["label","suffix"])]),(0,l.bF)(D),(0,l.Lk)("div",null,[(0,l.bF)(A,{color:"positive",icon:"sym_r_check",onClick:f.submitEdit,disable:f.loading||!f.hasChanges,push:""},{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(e.$t("confirm")),1)])),_:1},8,["onClick","disable"]),(0,l.bF)(A,{color:"negative",flat:"",icon:"sym_r_close",onClick:f.cancelEdit,disable:f.loading},{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(e.$t("cancel")),1)])),_:1},8,["onClick","disable"])])],64)):((0,l.uX)(),(0,l.CE)(l.FK,{key:0},[(0,l.Lk)("div",null,[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)(["dispatch_start_date","dispatch_end_date"],(t=>(0,l.bF)(w,{key:t,dense:"","stack-label":"",readonly:"",standout:"",style:{width:"180px"},label:e.$t("costBreakdown.view_cost."+("dispatch_start_date"===t?"dispatchedDate":"finishedDate"))},{prepend:(0,l.k6)((()=>[(0,l.bF)(K,{name:"sym_r_event"})])),control:(0,l.k6)((()=>[(0,l.Lk)("div",k,(0,o.v_)(f.costData[t]||"-"),1)])),_:2},1032,["label"]))),64)),(0,l.bF)(w,{dense:"","stack-label":"",style:{"min-width":"200px"},label:e.$t("costBreakdown.view_cost.totalCost"),class:"text-weight-bold",square:"",suffix:e.$t("kyats")},{control:(0,l.k6)((()=>[(0,l.Lk)("div",b,(0,o.v_)(f.formatNumber(f.displayedTotal)),1)])),_:1},8,["label","suffix"])]),(0,l.bF)(D),(0,l.bF)(A,{label:e.$t("edit"),icon:"sym_r_edit",color:"accent",onClick:f.startEdit,disable:f.loading},null,8,["label","onClick","disable"])],64))])])),_:1})])),_:1})])):((0,l.uX)(),(0,l.CE)("div",v,"NO DATA"))}a(310),a(5962),a(95),a(6724),a(2802),a(7225),a(8743),a(2858),a(2071),a(5520),a(2775),a(6203);var y=a(555),g=a(2261),w=a(1271),F=a(4907),C=a(3537);const x=e=>{if(!e)return null;try{return"string"===typeof e?JSON.parse(e):e}catch{return null}},E=["fuel","driver_meal","passing_fee","person_giving"],A=[{key:"fuel",text:"costBreakdown.fuelCost"},{key:"driver_meal",text:"costBreakdown.driverMealExpense"},{key:"driver_fee",text:"costBreakdown.driverFee"},{key:"passing_fee",text:"costBreakdown.passingFee"},{key:"person_giving",text:"costBreakdown.personGivingFee"},{key:"extortion",text:"costBreakdown.extortionFee"},{key:"maintenance",text:"costBreakdown.maintenance"},{key:"tyre",text:"costBreakdown.tyre"},{key:"insurance",text:"costBreakdown.insurance"},{key:"loading",text:"costBreakdown.loading"},{key:"unloading",text:"costBreakdown.unloading"},{key:"parking",text:"costBreakdown.parking"},{key:"other",text:"costBreakdown.other"}],D={name:"PagePackageGroupDetail",setup(){const{t:e}=(0,C.s9)(),t=(0,F.A)(),a="truckcostbreakdown",s=(0,y.KR)(x(w.A.getItem("TruckDispatchCostData"))),o=A.reduce(((e,{key:t})=>({...e,[t]:0})),{});Object.assign(o,{dispatch_end_date:null,dispatch_start_date:null,id:null});const i=(0,y.Kh)(o),d=(0,y.KR)(!1),n=(0,y.KR)(!1),r=(0,y.KR)(!1),c=(0,y.Kh)({}),u=(0,y.KR)(null),_=(0,y.KR)(null),p=A.map((e=>e.key)),k=async(l=!1)=>{const o=s.value.id;if(o){d.value=!0;try{const l=await(0,g.getauth)(`${a}?dispatchId=${o}`);"200"!==l.code&&t.notify({message:e("error.fetch"),color:"negative"});const d=l?.data||{};console.log(d);const n={};(d.expense_items||[]).forEach((e=>{n[e.category]=Number(e.amount||0)})),p.forEach((e=>{i[e]=n[e]||0})),i.dispatch_end_date=d.dispatch_end_date||d.dispatch_end_date||null,i.dispatch_start_date=d.dispatch_start_date||null,i.id=d.id||null,i.truck_dispatch_id=o,w.A.set("TruckDispatchCostData",JSON.stringify({...s.value,totalCost:D.value}))}catch{t.notify({message:e("error.fetch"),color:"negative"})}finally{d.value=!1}}else t.notify({message:e("error.fetch"),color:"negative"})};(0,l.sV)(k);const b=e=>(new Intl.NumberFormat).format(Number(e||0)),h=t=>{const a=A.find((e=>e.key===t));return a?e(a.text):t},m=e=>E.includes(e),v=(0,l.EW)((()=>p.reduce(((e,t)=>e+Number(i[t]||0)),0))),f=(0,l.EW)((()=>p.reduce(((e,t)=>e+Number(c[t]||0)),0))),D=(0,l.EW)((()=>n.value?f.value:v.value)),B=(0,l.EW)((()=>p.filter((e=>Number(i[e])>0)))),N=(0,l.EW)((()=>{if(n.value)return p.filter((e=>m(e)||e in c&&void 0!==c[e]));const e=Array.from(new Set([...E,...B.value]));if(r.value)return p.filter((t=>e.includes(t)));const t=Array.from(new Set([...E.filter((t=>e.includes(t))),...e])).slice(0,4);return t.length?t:p.slice(0,3)})),K=(0,l.EW)((()=>{const e=N.value,t=Array.from(new Set([...E,...B.value]));return t.length>e.length})),q=(0,l.EW)((()=>{const t=Object.keys(c).filter((e=>p.includes(e)));return A.filter((e=>!t.includes(e.key))).map((t=>({label:e(t.text),value:t.key})))})),W=e=>{try{return JSON.parse(JSON.stringify(e))}catch{return{...e||{}}}},$=e=>null==e?"":String(e).replace(/\//g,"-"),L=(e,t,a)=>p.includes(e)?Number(a[e]||0)!==Number(t[e]||0):$(a[e])!==$(t[e]),Q=(0,l.EW)((()=>{if(!u.value)return!1;for(const e of[...p,"dispatch_start_date","dispatch_end_date"])if(L(e,u.value,c))return!0;return!1})),X=()=>{if(!u.value)return{};const e={};for(const t of p){const a=Number(c[t]||0),l=Number(u.value[t]||0);a!==l&&(e[t]=a)}const t=$(c.dispatch_start_date),a=$(u.value.dispatch_start_date);t!==a&&(e.dispatch_start_date=t||null);const l=$(c.dispatch_end_date),s=$(u.value.dispatch_end_date);l!==s&&(e.dispatch_end_date=l||null);const o=u.value.total_cost,i=c.total_cost;return console.log(o),console.log(i),i!==o&&(e.total_cost=i||0),e},I=()=>{Object.keys(c).forEach((e=>delete c[e])),p.forEach((e=>{(m(e)||Number(i[e]||0)>0)&&(c[e]=Number(i[e]||0))})),c.truck_dispatch_id=i.truck_dispatch_id,c.dispatch_end_date=i.dispatch_end_date,c.dispatch_start_date=i.dispatch_start_date,c.total_cost=D.value,u.value=W({...p.reduce(((e,t)=>({...e,[t]:Number(i[t]||0)})),{}),dispatch_start_date:i.dispatch_start_date,dispatch_end_date:i.dispatch_end_date,total_cost:D.value}),n.value=!0},O=()=>{n.value=!1,Object.keys(c).forEach((e=>delete c[e])),_.value=null,u.value=null},V=e=>{e&&(e in c||(c[e]=0),_.value=null)},S=e=>{m(e)||e in c&&delete c[e]},T=async()=>{if(!i.id||!i.truck_dispatch_id)return void t.notify({message:e("error.invalid"),color:"negative"});const l=X();if(!Object.keys(l).length)return t.notify({message:e("warning.no_changes")||"No changes",color:"warning"}),void O();d.value=!0,t.loading.show();try{l.dispatch_end_date&&(l.dispatch_end_date=l.dispatch_end_date.replace(/\//g,"-")),l.dispatch_start_date&&(l.dispatch_start_date=l.dispatch_start_date.replace(/\//g,"-"));const s=await(0,g.patchauth)(`${a}/${i.id}/`,l);console.log(s),"200"!==s.code&&t.notify({message:e("error.update"),color:"negative"}),await k(!0);const o=x(w.A.getItem("TruckDispatchCostData"))||{};o.totalCost=D.value,w.A.set("TruckDispatchCostData",JSON.stringify(o)),t.notify({message:e("successful.update"),color:"positive"}),O()}catch{t.notify({message:e("error.update"),color:"negative"})}finally{t.loading.hide(),d.value=!1}};return{t:e,q:t,truckDispatchData:s,costData:i,loading:d,isEdit:n,editForm:c,newCostKey:_,showAllCosts:r,hasHiddenCosts:K,availableCostOptions:q,isCoreCost:m,startEdit:I,cancelEdit:O,submitEdit:T,getList:k,reFresh:()=>k(!0),formatNumber:b,displayedTotal:D,valueKeys:p,labels:A,labelByKey:h,visibleKeys:N,addNewEditField:V,removeEditField:S,hasChanges:Q}}};var B=a(2807),N=a(3316),K=a(7156),q=a(6384),W=a(4436),$=a(3999),L=a(124),Q=a(5173),X=a(386),I=a(3796),O=a(9270),V=a(492),S=a(1356),T=a(8462),j=a(6760),R=a(8672),U=a(8582),J=a.n(U);const P=(0,B.A)(D,[["render",f],["__scopeId","data-v-1c4fcdbe"]]),M=P;J()(D,"components",{QCard:N.A,QField:K.A,QBtn:q.A,QMenu:W.A,QList:$.A,QItem:L.A,QItemSection:Q.A,QSeparator:X.A,QItemLabel:I.A,QInput:O.A,QIcon:V.A,QPopupProxy:S.A,QDate:T.A,QChip:j.A}),J()(D,"directives",{ClosePopup:R.A})}}]);