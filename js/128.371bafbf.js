"use strict";(globalThis["webpackChunktbls"]=globalThis["webpackChunktbls"]||[]).push([[128],{5747:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ne});var n=a(1758),o=a(6683),i=a(2901);const l={key:0},s={class:"top-header"},d={class:"left-row"},c={class:"row items-center justify-end q-gutter-sm q-pa-sm"},r={class:"right-row"},u={key:0},_={key:1,class:"row items-center justify-around q-gutter-xs"},m={class:"bottom-footer"},p={class:"footer-item",color:"primary"},g={class:"footer-item"},h={class:"footer-item"},v={class:"footer-item"},k={class:"text-h6"},f={class:"q-mt-sm"},b={class:"text-h6"},y={class:"text-h6"},w={class:"q-mt-sm"},q={class:"q-mt-sm"},C={key:1,class:"text-center"};function F(e,t,a,F,N,x){const L=(0,n.g2)("q-tooltip"),A=(0,n.g2)("q-btn"),S=(0,n.g2)("q-btn-group"),W=(0,n.g2)("q-select"),$=(0,n.g2)("q-date"),D=(0,n.g2)("q-popup-proxy"),I=(0,n.g2)("q-icon"),V=(0,n.g2)("q-input"),z=(0,n.g2)("q-chip"),T=(0,n.g2)("q-td"),R=(0,n.g2)("q-tr"),U=(0,n.g2)("q-table"),K=(0,n.g2)("q-card-section"),P=(0,n.g2)("q-card-actions"),Q=(0,n.g2)("q-card"),E=(0,n.g2)("q-dialog"),O=(0,n.g2)("q-space"),M=(0,n.g2)("q-separator"),B=(0,n.g2)("q-checkbox"),G=(0,n.gN)("close-popup");return F.selectedPg?((0,n.uX)(),(0,n.CE)("div",l,[(0,n.bF)(o.eB,{appear:"","enter-active-class":"animated fadeIn"},{default:(0,n.k6)((()=>[(0,n.bF)(U,{class:"my-sticky-header-large-table shadow-24",separator:"cell",rows:F.tableList,"row-key":"consignment_id",loading:F.loading,columns:F.columns,pagination:F.pagination,"onUpdate:pagination":t[6]||(t[6]=e=>F.pagination=e),paginationModifiers:{sync:!0},"no-data-label":"No data","no-results-label":"No data you want",style:{height:"calc(100vh - 150px)","max-height":"calc(100vh - 150px)"},flat:"",bordered:"",dense:""},{top:(0,n.k6)((()=>[(0,n.Lk)("div",s,[(0,n.Lk)("div",d,[(0,n.bF)(S,{push:"",class:"shadow-2",dense:""},{default:(0,n.k6)((()=>[(0,n.bF)(A,{icon:"sym_r_add",color:"green",label:e.$t("dispatch_planning.check_list.new_consignment"),onClick:F.openAddDialog,"no-caps":""},{default:(0,n.k6)((()=>[(0,n.bF)(L,(0,i._B)((0,n.Ng)(F.tooltip)),{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(e.$t("dispatch_planning.check_list.new_consignment_tip")),1)])),_:1},16)])),_:1},8,["label","onClick"]),(0,n.bF)(A,{icon:"sym_r_refresh",label:e.$t("refresh"),"no-caps":"",onClick:F.reFresh},{default:(0,n.k6)((()=>[(0,n.bF)(L,(0,i._B)((0,n.Ng)(F.tooltip)),{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(e.$t("refreshtip")),1)])),_:1},16)])),_:1},8,["label","onClick"])])),_:1}),(0,n.bF)(W,{outlined:"",modelValue:F.selectedPg.dispatch.truck,"onUpdate:modelValue":t[0]||(t[0]=e=>F.selectedPg.dispatch.truck=e),"input-debounce":"200","use-input":"",dense:"","map-options":"","emit-value":"",label:e.$t("dispatch_planning.check_list.truck"),"bg-color":"rgb(245,245,245)",options:F.truckFilteredOptions,onFilter:F.filterTruck,behavior:"menu",style:{width:"180px"},"option-label":"label","option-value":"value"},null,8,["modelValue","label","options","onFilter"]),(0,n.bF)(W,{outlined:"",modelValue:F.selectedPg.dispatch.truck_driver,"onUpdate:modelValue":t[1]||(t[1]=e=>F.selectedPg.dispatch.truck_driver=e),"input-debounce":"100","use-input":F.truckDriverUseInput,dense:"",label:`${e.$t("dispatch_planning.check_list.truck_driver")} (${e.$t("optional")})`,"bg-color":"rgb(245,245,245)",options:F.truckDriverFilteredOptions,clearable:"",onFilter:F.filterTruckDriver,onPopupHide:F.onTruckDriverSelected,onPopupShow:F.onTruckDriverPopupShow,onClear:F.onTruckDriverCleared,behavior:"menu",style:{"max-width":"180px","min-width":"160px"},class:"truncate-cell","option-label":"full_name","option-value":"id","map-options":"","emit-value":""},null,8,["modelValue","use-input","label","options","onFilter","onPopupHide","onPopupShow","onClear"]),(0,n.bF)(V,{dense:"",mask:"date",modelValue:F.selectedPg.dispatch.dispatch_date,"onUpdate:modelValue":t[3]||(t[3]=e=>F.selectedPg.dispatch.dispatch_date=e),outlined:"",style:{width:"160px"}},{append:(0,n.k6)((()=>[(0,n.bF)(I,{name:"sym_r_event",color:"primary",class:"cursor-pointer"},{default:(0,n.k6)((()=>[(0,n.bF)(D,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,n.k6)((()=>[(0,n.bF)($,{modelValue:F.selectedPg.dispatch.dispatch_date,"onUpdate:modelValue":t[2]||(t[2]=e=>F.selectedPg.dispatch.dispatch_date=e)},{default:(0,n.k6)((()=>[(0,n.Lk)("div",c,[(0,n.bo)((0,n.bF)(A,{flat:"",color:"primary",label:"Close"},null,512),[[G]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])]),(0,n.Lk)("div",r,[F.dispatchList.length?((0,n.uX)(),(0,n.Wv)(z,{key:0,dense:"",label:`${F.dispatchList.length} Locked`,flat:"","no-caps":"",style:{color:"#ff3a3a"}},null,8,["label"])):(0,n.Q3)("",!0),(0,n.bF)(A,{dense:"",label:F.tableCollapse?e.$t("expand"):e.$t("collapse"),icon:F.tableCollapse?"sym_r_expand":"sym_r_compress",color:F.tableCollapse?"green":"blue","no-caps":"",push:"",onClick:F.collapseSmallTable},null,8,["label","icon","color","onClick"]),(0,n.bF)(A,{dense:"",push:"",color:F.isAllLock?"blue":"grey",label:F.isAllLock?e.$t("unlockall"):e.$t("lockall"),icon:F.isAllLock?"sym_r_lock":"sym_r_lock_open",onClick:t[4]||(t[4]=e=>F.isAllLock?F.unLockAll():F.lockAll())},null,8,["color","label","icon"])])])])),body:(0,n.k6)((t=>[(0,n.bF)(R,{props:t},{default:(0,n.k6)((()=>[(0,n.bF)(T,{key:"consignmentCode",props:t,class:"input-row"},{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(t.row.consignment_code),1)])),_:2},1032,["props"]),(0,n.bF)(T,{key:"received_date",props:t,class:"input-row"},{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(t.row.received_date),1)])),_:2},1032,["props"]),(0,n.bF)(T,{key:"customer",props:t,class:"input-row truncate-cell"},{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(t.row.customer),1)])),_:2},1032,["props"]),(0,n.bF)(T,{key:"company",props:t,class:"input-row truncate-cell"},{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(t.row.company),1)])),_:2},1032,["props"]),(0,n.bF)(T,{key:"total_weight",props:t,class:"input-row"},{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(F.formatWeight(t.row.total_weight)),1)])),_:2},1032,["props"]),(0,n.bF)(T,{key:"total_amount",props:t,class:"input-row"},{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(F.formatCurrency(t.row.total_amount)),1)])),_:2},1032,["props"]),(0,n.bF)(T,{key:"action",props:t,style:{width:"120px"}},{default:(0,n.k6)((()=>[(0,n.bF)(A,{round:"",dense:"",color:t.row.isLock?"blue":"grey",icon:t.row.isLock?"sym_r_lock":"sym_r_lock_open",onClick:e=>t.row.isLock?F.onUnLock(t.row):F.onLock(t.row),title:t.row.isLock?"Unlock":"Lock"},null,8,["color","icon","onClick","title"]),t.row.isLock?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(A,{key:0,dense:"",push:"",color:"primary",icon:"sym_r_disabled_by_default",style:{"margin-left":"8px"},onClick:e=>F.removeSelection(t.row.consignment_id)},{default:(0,n.k6)((()=>[(0,n.bF)(L,(0,i._B)((0,n.Ng)(F.tooltip)),{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(e.$t("dispatch_planning.check_list.remove_selection")),1)])),_:1},16)])),_:2},1032,["onClick"]))])),_:2},1032,["props"])])),_:2},1032,["props"]),F.tableCollapse?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(R,{key:0},{default:(0,n.k6)((()=>[(0,n.bF)(T,{colspan:F.columns.length},{default:(0,n.k6)((()=>[(0,n.bF)(U,{class:"my-sticky-header-small-table",rows:t.row.items||[],"row-key":"receive_goods_id",columns:F.goodsColumns,separator:"cell","hide-bottom":"",bordered:"","rows-per-page-options":[0]},{body:(0,n.k6)((a=>[(0,n.bF)(R,{props:a},{default:(0,n.k6)((()=>[(0,n.bF)(T,{key:"goods_code",props:a,class:"input-row"},{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(a.row.goods_code),1)])),_:2},1032,["props"]),(0,n.bF)(T,{key:"goods_name",props:a,class:"input-row truncate-cell"},{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(a.row.goods_name),1)])),_:2},1032,["props"]),(0,n.bF)(T,{key:"goods_rate",props:a,class:"input-row"},{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(F.formatCurrency(a.row.goods_rate)),1)])),_:2},1032,["props"]),(0,n.bF)(T,{key:"goods_weight",props:a,class:"input-row"},{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(F.formatWeight(a.row.goods_weight)),1)])),_:2},1032,["props"]),(0,n.bF)(T,{key:"total_weight",props:a,class:"input-row"},{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(F.formatWeight(a.row.total_weight)),1)])),_:2},1032,["props"]),(0,n.bF)(T,{key:"total_amount",props:a,class:"input-row"},{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(F.formatCurrency(a.row.total_amount)),1)])),_:2},1032,["props"]),(0,n.bF)(T,{key:"quantity",props:a,class:"input-row"},{default:(0,n.k6)((()=>[t.row.isLock?((0,n.uX)(),(0,n.CE)("div",u,(0,i.v_)(a.row.quantity),1)):((0,n.uX)(),(0,n.CE)("div",_,[(0,n.bF)(V,{dense:"",type:"number",modelValue:a.row.quantity,"onUpdate:modelValue":[e=>a.row.quantity=e,()=>F.updateRow(a.row,t.row)],modelModifiers:{number:!0},min:1,max:a.row.remaining_quantity+a.row.quantity_loaded,hint:`Min: 1, Max: ${Number(a.row.remaining_quantity+a.row.quantity_loaded)}`,style:{width:"90px"}},null,8,["modelValue","onUpdate:modelValue","max","hint"]),(0,n.bF)(A,{dense:"",flat:"",round:"",icon:"sym_r_close_small",color:"primary",size:"md",onClick:e=>F.deleteRow(a.row.consignment_handler_id,t.row.consignment_id,a.row.consignment_handler_id?null:a.row.receive_goods_id)},{default:(0,n.k6)((()=>[(0,n.bF)(L,(0,i._B)((0,n.Ng)(F.tooltip)),{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(e.$t("dispatch_planning.check_list.goods_options")),1)])),_:1},16)])),_:2},1032,["onClick"])]))])),_:2},1032,["props"])])),_:2},1032,["props"])])),_:2},1032,["rows","columns"])])),_:2},1032,["colspan"])])),_:2},1024))])),bottom:(0,n.k6)((()=>[(0,n.Lk)("div",m,[(0,n.Lk)("div",p,[(0,n.eW)((0,i.v_)(e.$t("dispatch_planning.check_list.dispatch_code"))+": ",1),(0,n.Lk)("span",null,(0,i.v_)(F.selectedPg.dispatch.code),1)]),(0,n.Lk)("div",g,[(0,n.eW)((0,i.v_)(e.$t("dispatch_planning.check_list.totalItems"))+": ",1),(0,n.Lk)("span",null,(0,i.v_)(F.countConsignment),1)]),(0,n.Lk)("div",h,[(0,n.eW)((0,i.v_)(e.$t("dispatch_planning.check_list.grandTotalWeight"))+": ",1),(0,n.Lk)("span",null,(0,i.v_)(F.formatWeight(F.grandTotal.weight)),1)]),(0,n.Lk)("div",v,[(0,n.eW)((0,i.v_)(e.$t("dispatch_planning.check_list.grandTotalAmount"))+": ",1),(0,n.Lk)("span",null,(0,i.v_)(F.formatCurrency(F.grandTotal.amount)),1)]),(0,n.Lk)("div",null,[(0,n.bF)(A,{label:e.$t("dispatching.submit"),icon:"sym_r_send",style:{"background-color":"#21ba45",color:"white"},onClick:t[5]||(t[5]=e=>F.confirmDlg=!0),disable:!F.canSubmit||F.loading,unelevated:""},null,8,["label","disable"])])])])),_:1},8,["rows","loading","columns","pagination"])])),_:1}),(0,n.bF)(E,{modelValue:F.removeDlg,"onUpdate:modelValue":t[8]||(t[8]=e=>F.removeDlg=e)},{default:(0,n.k6)((()=>[(0,n.bF)(Q,{style:{"min-width":"400px"}},{default:(0,n.k6)((()=>[(0,n.bF)(K,null,{default:(0,n.k6)((()=>[(0,n.Lk)("div",k,(0,i.v_)(e.$t("confirmRemove")),1),(0,n.Lk)("div",f,[(0,n.eW)((0,i.v_)(e.$t("removeConfirmationTip"))+" ",1),(0,n.Lk)("strong",null,(0,i.v_)(F.removeTarget?.consignment_code||"this consignment"),1),(0,n.eW)(" "+(0,i.v_)(e.$t("fromList")),1)])])),_:1}),(0,n.bF)(P,{align:"right"},{default:(0,n.k6)((()=>[(0,n.bo)((0,n.bF)(A,{flat:"",label:e.$t("cancel"),onClick:t[7]||(t[7]=e=>F.removeDlg=!1)},null,8,["label"]),[[G]]),(0,n.bF)(A,{color:"primary",label:e.$t("remove"),onClick:F.confirmRemove},null,8,["label","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,n.bF)(E,{modelValue:F.addDialog,"onUpdate:modelValue":t[12]||(t[12]=e=>F.addDialog=e),maximized:""},{default:(0,n.k6)((()=>[(0,n.bF)(Q,{style:{"min-width":"60vw","min-height":"60vh"}},{default:(0,n.k6)((()=>[(0,n.bF)(K,{class:"row items-center"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",b,(0,i.v_)(e.$t("truckdispatch.truck_dispatch_edit.add_new_consignment")),1),(0,n.bF)(O),(0,n.bF)(V,{outlined:"",rounded:"",dense:"",debounce:"300",color:"primary",modelValue:F.unloadedFilter,"onUpdate:modelValue":t[10]||(t[10]=e=>F.unloadedFilter=e),placeholder:e.$t("search")},{append:(0,n.k6)((()=>[(0,n.bF)(I,{name:"sym_r_search",onClick:t[9]||(t[9]=t=>e.getSearchList())})])),_:1},8,["modelValue","placeholder"]),(0,n.bF)(O),(0,n.bo)((0,n.bF)(A,{icon:"sym_r_close",color:"primary",dense:"",onClick:F.closeAddDialog},null,8,["onClick"]),[[G]])])),_:1}),(0,n.bF)(M),(0,n.bF)(K,{class:"q-pa-sm",style:{height:"calc(100% - 140px)",overflow:"auto"}},{default:(0,n.k6)((()=>[(0,n.bF)(U,{rows:F.unloadedList,columns:F.unloadedColumns,"row-key":"id",selection:"multiple",selected:F.selectedUnloaded,"onUpdate:selected":t[11]||(t[11]=e=>F.selectedUnloaded=e),"hide-bottom":"",dense:"",separator:"cell",filter:F.unloadedFilter,"rows-per-page-options":[0]},{body:(0,n.k6)((e=>[(0,n.bF)(R,{props:e},{default:(0,n.k6)((()=>[(0,n.bF)(T,null,{default:(0,n.k6)((()=>[(0,n.bF)(B,{modelValue:e.selected,"onUpdate:modelValue":t=>e.selected=t,dense:""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024),(0,n.bF)(T,{key:"code",props:e},{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(e.row.code),1)])),_:2},1032,["props"]),(0,n.bF)(T,{key:"received_date",props:e},{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(e.row.received_date),1)])),_:2},1032,["props"]),(0,n.bF)(T,{key:"customer",props:e},{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(e.row.customer),1)])),_:2},1032,["props"]),(0,n.bF)(T,{key:"company",props:e},{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(e.row.company),1)])),_:2},1032,["props"]),(0,n.bF)(T,{key:"total_weight",props:e},{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(F.formatWeight(e.row.total_weight)),1)])),_:2},1032,["props"]),(0,n.bF)(T,{key:"total_amount",props:e},{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(F.formatCurrency(e.row.total_amount)),1)])),_:2},1032,["props"])])),_:2},1032,["props"])])),_:1},8,["rows","columns","selected","filter"])])),_:1}),(0,n.bF)(P,{align:"right"},{default:(0,n.k6)((()=>[(0,n.bo)((0,n.bF)(A,{flat:"",label:"Cancel",color:"primary",onClick:F.closeAddDialog},null,8,["onClick"]),[[G]]),(0,n.bF)(A,{unelevated:"",color:"primary",label:e.$t("truckdispatch.truck_dispatch_edit.add_selected"),onClick:F.addSelectedConsignments},{default:(0,n.k6)((()=>[(0,n.bF)(L,(0,i._B)((0,n.Ng)(F.tooltip)),{default:(0,n.k6)((()=>[(0,n.eW)((0,i.v_)(e.$t("truckdispatch.truck_dispatch_edit.add_selected_tip")),1)])),_:1},16)])),_:1},8,["label","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,n.bF)(E,{modelValue:F.confirmDlg,"onUpdate:modelValue":t[14]||(t[14]=e=>F.confirmDlg=e)},{default:(0,n.k6)((()=>[(0,n.bF)(Q,{style:{"min-width":"420px"}},{default:(0,n.k6)((()=>[(0,n.bF)(K,null,{default:(0,n.k6)((()=>[(0,n.Lk)("div",y,(0,i.v_)(e.$t("dispatch_planning.check_list.confirm_dispatch")),1),(0,n.Lk)("div",w,(0,i.v_)(e.$t("dispatch_planning.check_list.confirm_message")),1),(0,n.Lk)("ul",q,[(0,n.Lk)("li",null,[(0,n.eW)((0,i.v_)(e.$t("dispatch_planning.check_list.package_locked"))+": ",1),(0,n.Lk)("strong",null,(0,i.v_)(F.dispatchList.length),1)]),(0,n.Lk)("li",null,[(0,n.eW)((0,i.v_)(e.$t("dispatch_planning.check_list.grandTotalAmount"))+": ",1),(0,n.Lk)("strong",null,(0,i.v_)(F.formatCurrency(F.grandTotal.amount)),1)]),(0,n.Lk)("li",null,[(0,n.eW)((0,i.v_)(e.$t("dispatch_planning.check_list.grandTotalWeight"))+": ",1),(0,n.Lk)("strong",null,(0,i.v_)(F.formatWeight(F.grandTotal.weight)),1)])])])),_:1}),(0,n.bF)(P,{align:"right"},{default:(0,n.k6)((()=>[(0,n.bo)((0,n.bF)(A,{flat:"",label:"Cancel",onClick:t[13]||(t[13]=e=>F.confirmDlg=!1)},null,512),[[G]]),(0,n.bF)(A,{unelevated:"",color:"primary",label:"Confirm",onClick:F.handleSubmit},null,8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])):((0,n.uX)(),(0,n.CE)("div",C,(0,i.v_)(e.$("noDataUltimateTip")),1))}a(310),a(317),a(5962),a(2203),a(95),a(6724),a(2802),a(9240),a(7225),a(8743),a(2858),a(2071),a(5520),a(2775),a(6203);var N=a(555),x=a(4907),L=a(1271),A=a(3537),S=a(2261),W=a(7144);const $={name:"PageDispatchingEdit",setup(){const e=(0,x.A)(),{t}=(0,A.s9)(),a=(0,N.KR)(L.A.getItem("EditDispatchDetail")||null),o=(0,N.KR)(null),i=(0,N.KR)([]),l=(0,N.KR)(0),s=(0,N.Kh)({amount:0,weight:0});let d=[];const c=(0,N.KR)([]),r=(0,N.KR)([]),u=(0,N.KR)(!1),_=(0,N.KR)([]),m=(0,N.KR)(!1),p=(0,N.KR)(!1),g=(0,N.KR)(!1),h=(0,N.Kh)({page:1,rowsPerPage:30}),v=(0,N.KR)(!1),k=(0,N.KR)(null),f=(0,n.EW)((()=>{const e=k.value;return null!==e&&e>=0&&e<i.value.length?i.value[e]:null})),b=(0,N.KR)(!1),y=(0,N.KR)([]),w=(0,N.KR)([]),q=(0,N.KR)(""),C=(0,N.Kh)([{name:"code",label:t("dispatch_planning.check_list.code"),field:"code",align:"center"},{name:"received_date",label:t("dispatch_planning.check_list.received_date"),field:"received_date",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"customer",label:t("dispatch_planning.check_list.customer"),field:"customer",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"company",label:t("dispatch_planning.check_list.company"),field:"company",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"total_weight",label:t("dispatch_planning.check_list.total_weight"),field:"total_weight",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"total_amount",label:t("dispatch_planning.check_list.total_amount"),field:"total_amount",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"}]),F={class:"bg-blue text-white shadow-4",offset:[10,10],contentStyle:"font-size: 12px"},$=(0,N.Kh)([{name:"consignmentCode",label:t("dispatch_planning.check_list.code"),field:"consignmentCode",align:"center",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999",sortable:!0},{name:"received_date",label:t("dispatch_planning.check_list.received_date"),field:"received_date",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"customer",label:t("dispatch_planning.check_list.customer"),field:"customer",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"company",label:t("dispatch_planning.check_list.company"),field:"company",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"total_weight",label:t("dispatch_planning.check_list.total_weight"),field:"total_weight",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"total_amount",label:t("dispatch_planning.check_list.total_amount"),field:"total_amount",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"action",label:t("action"),align:"center",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"}]),D=(0,N.Kh)([{name:"goods_code",label:t("dispatch_planning.check_list.goods_code"),field:"goods_code",align:"center",headerStyle:"font-weight: bold; font-size: 13px"},{name:"goods_name",label:t("dispatch_planning.check_list.goods_name"),field:"goods_name",align:"left",headerStyle:"font-weight: bold; font-size: 13px"},{name:"goods_rate",label:t("dispatch_planning.check_list.goods_rate")+" (Ks)",field:"goods_rate",align:"left",headerStyle:"font-weight: bold; font-size: 13px"},{name:"goods_weight",label:t("dispatch_planning.check_list.goods_weight")+" (Viss)",field:"goods_weight",align:"left",headerStyle:"font-weight: bold; font-size: 13px"},{name:"total_weight",label:t("dispatch_planning.check_list.total_weight")+" (Viss)",field:"w_total",align:"left",headerStyle:"font-weight: bold; font-size: 13px"},{name:"total_amount",label:t("dispatch_planning.check_list.total_amount")+" (Ks)",field:"total",align:"left",headerStyle:"font-weight: bold; font-size: 13px"},{name:"quantity",label:t("dispatch_planning.check_list.quantity"),field:"quantity",align:"center",headerStyle:"font-weight: bold; font-size: 13px"}]),I=new Intl.NumberFormat("en-US",{maximumFractionDigits:2}),V=e=>I.format(Number(e||0))+" "+t("ks"),z=e=>I.format(Number(e||0))+" "+t("vs");function T(){if(!a.value)return i.value=[],o.value=null,void B();const e=JSON.parse(JSON.stringify(a.value));i.value=(e.packageGroupList||[]).map((e=>{const t=(e.items||[]).map((e=>({...e,quantity:Number(e.quantity??e.quantity_loaded??0),quantity_loaded:Number(e.quantity_loaded??0),remaining_quantity:Number(e.remaining_quantity??0),total_amount:Number(e.total_amount??0),total_weight:Number(e.total_weight??0)})));return{...e,items:t,isLock:!!e.isLock}})),_.value=(i.value||[]).filter((e=>e.isLock)),B(),j&&j(),o.value={dispatch:{...a.value.dispatch,grand_total_amount:s.amount,grand_total_weight:s.weight},packageGroupMap:(a.value.packageGroupList||[]).reduce(((e,t)=>(e[t.consignment_id]={id:t.consignment_id,dispatch_summary_id:t.consignment_dispatch_summary_id??null,items:(t.items||[]).reduce(((e,t)=>{const a=t.receive_goods_id;return e[a]={id:a,quantity_loaded:Number(t.quantity_loaded??t.quantity??0)},e}),{})},e)),{})},console.log("ORG: ",o.value)}async function R(){await(0,W.e7)("truck");const e=L.A.getItem("truck");d=e.map((e=>({label:e.truck_number,value:e.id}))),c.value=d,await(0,W.e7)("truckdriver"),r.value=L.A.getItem("truckdriver")}(0,n.sV)((async()=>{await R(),T()}));const U=a=>{const n=i.value.findIndex((e=>e.consignment_id===a||e.id===a));-1!==n?(k.value=n,v.value=!0):e.notify({message:t("dispatch_planning.not_found")||"Item not found",color:"negative"})},K=()=>{const a=k.value;if(null===a||"undefined"===typeof a||a<0)return v.value=!1,void(k.value=null);if(a>=i.value.length)return e.notify({message:t("dispatch_planning.invalid_index")||"Invalid remove index",color:"negative"}),v.value=!1,void(k.value=null);try{const n=i.value[a];if(!n)return e.notify({message:t("dispatch_planning.invalid_index")||"Invalid remove index",color:"negative"}),v.value=!1,void(k.value=null);const o=_.value.findIndex((e=>e.consignment_id===n.consignment_id));-1!==o&&_.value.splice(o,1),i.value.splice(a,1),B(),J(),e.notify({message:t("successful.remove")||"Removed",color:"positive",icon:"sym_r_check"})}catch(a){e.notify({message:t("error.remove")||"Error removing item",color:"negative"})}finally{v.value=!1,k.value=null}},P=async()=>{b.value=!0,await E()},Q=()=>{b.value=!1,w.value=[],y.value=[],q.value=""},E=async()=>{u.value=!0;try{const e=await(0,S.getauth)("consignment/unloaded/");y.value=e?.data??[],console.log(e)}catch(a){e.notify({message:t("error.fetch")||"Failed to fetch",color:"negative"})}finally{u.value=!1}},O=async()=>{if(w.value&&0!==w.value.length){u.value=!0;try{let a=0;const n=[],o=[],l=[];console.log(w.value);for(const e of w.value){const t=e.id,s=(e.receive_goods_items||[]).map((e=>({receive_goods_id:Number(e.receive_goods_id??e.receivegoods_id??e.id??0),goods_code:e.goods_code??"",goods_name:e.goods_name??e.goods_label??"",goods_rate:Number(e.goods_rate??e.rate??0),goods_weight:Number(e.goods_weight??e.weight??0),remaining_quantity:Number(e.remaining_quantity??e.quantity??0),quantity_loaded:0,quantity:Number(e.remaining_quantity??e.quantity??0),total_amount:Number(e.total_amount??(e.remaining_quantity??0)*(e.goods_rate??0)),total_weight:Number(e.total_weight??(e.remaining_quantity??0)*(e.goods_weight??0)),consignment_dispatch_summary_id:e.consignment_dispatch_summary_id??null})));if(!s.length){n.push({consignment_id:t,reason:"no_receive_goods"});continue}const d=i.value.findIndex((e=>Number(e.consignment_id)===Number(t)||Number(e.id)===Number(t)));if(-1===d){const n={consignment_id:t,consignment_code:e.code??e.consignment_code??"",customer:e.customer??"",company:e.company??"",received_date:e.received_date??e.receivedDate??null,total_amount:s.reduce(((e,t)=>e+Number(t.total_amount||0)),0),total_weight:s.reduce(((e,t)=>e+Number(t.total_weight||0)),0),items:s,isLock:!1};i.value.push(n),a+=s.length,l.push({consignment_id:t,added:s.length});continue}const c=i.value[d],r=new Set((c.items||[]).map((e=>Number(e.receive_goods_id)))),u=s.filter((e=>e.receive_goods_id&&!r.has(Number(e.receive_goods_id))));u.length?(c.items=(c.items||[]).concat(u),c.total_amount=(c.items||[]).reduce(((e,t)=>e+Number(t.total_amount||0)),0),c.total_weight=(c.items||[]).reduce(((e,t)=>e+Number(t.total_weight||0)),0),a+=u.length,o.push({consignment_id:t,added:u.length})):n.push({consignment_id:t,reason:"all_items_already_present"})}"function"===typeof B&&B(),H(),Q();const s=[];return l.length&&s.push(`${l.length} consignment(s) added`),o.length&&s.push(`${o.length} consignment(s) partially updated`),s.length||s.push(t("truckdispatch.truck_dispatch_edit.added")||"Added"),n.length&&e.notify({message:`${n.length} consignment(s) skipped`,color:"info"}),e.notify({message:s.join(" — "),color:"positive"}),{addedCount:a,newlyAdded:l,partiallyAdded:o,skipped:n}}catch(a){return console.error(a),e.notify({message:t("error.error")||"Error",color:"negative"}),{error:String(a)}}finally{u.value=!1}}else e.notify({message:t("truckdispatch.truck_dispatch_edit.select_one")||"Select at least one",color:"warning"})},M=(a,n)=>{a.quantity=Number.isFinite(a.quantity)?Number(a.quantity):0,a.quantity<0&&(a.quantity=0);const o=Number(a.remaining_quantity+a.quantity_loaded);if(a.quantity>o&&(a.quantity=o,e.notify({message:`${a.goods_name}: cannot exceed ${o}.`,color:"negative",icon:"sym_r_error"})),a.quantity<1&&(a.quantity=1,e.notify({message:`${a.goods_name}: cannot lower than 1.`,color:"negative",icon:"sym_r_error"})),a.total_amount=Number(a.goods_rate||0)*Number(a.quantity||0),a.total_weight=Number(a.goods_weight||0)*Number(a.quantity||0),n.total_amount=(n.items||[]).reduce(((e,t)=>e+(Number(t.total_amount)||0)),0),n.total_weight=(n.items||[]).reduce(((e,t)=>e+(Number(t.total_weight)||0)),0),n.isLock){const a=(n.items||[]).every((e=>Number.isFinite(e.quantity)&&e.quantity>=0&&e.quantity<=e.remaining_quantity+e.quantity_loaded));if(!a){n.isLock=!1;const a=_.value.findIndex((e=>e.consignment_id===n.consignment_id));-1!==a&&_.value.splice(a,1),e.notify({message:t("dispatching.invalid_quantities")||"Invalid quantities — package unlocked.",color:"negative"})}}B()},B=()=>{s.amount=i.value.reduce(((e,t)=>e+(Number(t.total_amount)||0)),0),s.weight=i.value.reduce(((e,t)=>e+(Number(t.total_weight)||0)),0),l.value=i.value.length},G=a=>{(a.items||[]).forEach((e=>{e.quantity=Number.isFinite(e.quantity)?Number(e.quantity):0}));const n=a.items.some((e=>e.quantity<0||e.quantity>e.remaining_quantity+e.quantity_loaded));if(n)return void e.notify({message:t("dispatching.invalid_quantities")||"Cannot lock: invalid quantities",color:"negative"});const o=a.items.some((e=>Number(e.quantity||0)>0));o?(a.isLock=!0,_.value.some((e=>e.consignment_id===a.consignment_id||e.id===a.id))||_.value.push(a),J(),B(),e.notify({message:t("dispatching.locked")||`Locked package ${a.id}`,color:"positive"})):e.notify({message:t("dispatching.no_quantity_tip")||"Set quantity > 0 for at least one item before locking.",color:"negative"})},X=a=>{a.isLock=!1;const n=_.value.findIndex((e=>e.consignment_id===a.consignment_id));-1!==n&&_.value.splice(n,1),J(),B(),e.notify({message:t("dispatching.unlocked")||`Unlocked package ${a.id}`,color:"info"})},j=()=>{for(const a of i.value){const n=(a.items||[]).every((e=>(e.quantity=Number.isFinite(e.quantity)?Number(e.quantity):0,e.quantity>=0&&e.quantity<=e.remaining_quantity+e.quantity_loaded)));if(!n)return void e.notify({message:t("dispatching.invalid_quantities")||"Cannot lock: invalid quantities present.",color:"negative"});const o=(a.items||[]).some((e=>Number(e.quantity||0)>0));if(!o)return void e.notify({message:t("dispatching.lockall_require_positive")||`Cannot lock all: package ${a.id} has no positive item quantity.`,color:"negative"})}i.value.forEach((e=>{e.isLock=!0,_.value.some((t=>t.consignment_id===e.consignment_id))||_.value.push(e)})),J(),B()},H=()=>{i.value.forEach((e=>e.isLock=!1)),_.value=[],J(),B(),e.notify({message:"All unlocked",color:"info"})},J=()=>{m.value=i.value.length>0&&i.value.every((e=>!!e.isLock))};function Y(){const e=[],t=[],n=[],l=o.value?.packageGroupMap||{},d=new Set;for(const a of i.value){const n=a.consignment_id??a.id;d.add(String(n));const o=l[n];if(!o){const e=(a.items||[]).filter((e=>Number(e.quantity||0)>0)).map((e=>({receive_goods:e.receive_goods_id,quantity_loaded:Number(e.quantity||0),total_amount:Number(e.total_amount||0),total_weight:Number(e.total_weight||0)})));e.length&&t.push({consignment_id:n,addItems:e});continue}const i=o.items||{},s=[];for(const t of a.items||[]){const a=t.receive_goods_id,n=Number(t.quantity||0),o=i[a];if(o){const i=Number(o.quantity_loaded||0);n!==i&&e.push({receive_goods_id:a,consignment_handler_id:t.consignment_handler_id||o.consignment_handler_id||null,quantity_loaded:n,total_amount:Number(t.total_amount||0),total_weight:Number(t.total_weight||0)})}else n>0&&s.push({receive_goods:a,quantity_loaded:n,total_amount:Number(t.total_amount||0),total_weight:Number(t.total_weight||0)})}s.length&&t.push({consignment_id:n,addItems:s})}for(const e of Object.keys(l||{}))if(!d.has(String(e))){const t=l[e];t&&t.dispatch_summary_id&&n.push(Number(t.dispatch_summary_id))}const c={},r=o.value?.dispatch||{},u=a.value?.dispatch||{};(u.dispatch_date||"")!==(r.dispatch_date||"")&&(c.dispatch_date=u.dispatch_date),(u.truck||"")!==(r.truck||"")&&(c.truck=u.truck),(u.truck_driver||"")!==(r.truck_driver||"")&&(c.truck_driver=u.truck_driver),Number(s.amount||0)===Number(r.grand_total_amount||0)&&Number(s.weight||0)===Number(r.grand_total_weight||0)||(c.total_amount=s.amount,c.total_weight=s.weight);const _=e.length>0||t.length>0||n.length>0||Object.keys(c).length>0||ee.value.length>0;return{changedItems:e,addedConsignmentItems:t,removedConsignmentIds:n,dispatchChanges:c,hasAnyChange:_}}const Z=()=>{const a=Y();if(!a.hasAnyChange)return void e.notify({message:t("warning.no_changes")||"No changes to save",color:"warning"});const n={};a.changedItems&&a.changedItems.length&&(n.changedItems=a.changedItems),a.addedConsignmentItems&&a.addedConsignmentItems.length&&(n.addedConsignmentItems=a.addedConsignmentItems),a.removedConsignmentIds&&a.removedConsignmentIds.length&&(n.removedConsignmentIds=a.removedConsignmentIds),a.dispatchChanges&&Object.keys(a.dispatchChanges).length&&(n.dispatchChanges=a.dispatchChanges,a.dispatchChanges.total_amount&&(n.dispatchChanges.total_amount=a.dispatchChanges.total_amount),a.dispatchChanges.total_weight&&(n.dispatchChanges.total_weight=a.dispatchChanges.total_weight)),ee.value.length&&(n.removedHandlerIds=ee.value),console.log("payload: ",n),te(n)},ee=(0,N.KR)([]),te=async n=>{const o=a.value?.dispatch?.id;if(o){u.value=!0,e.loading.show();try{p.value=!1;const a=await(0,S.patchauth)(`truckdispatch/update-dispatch/${o}/`,n);if("200"!==a.code)return void e.notify({message:a.message||t("error.update")||"Update failed",color:"negative"});const i=a.data.created_handlers||null;e.notify({message:t("successful.update")||"Updated",color:"positive",icon:"sym_r_check"}),ee.value=[],_e(i)}finally{e.loading.hide(),u.value=!1}}else e.notify({message:t("dispatch_planning.no_dispatch_id")||"No dispatch id for update",color:"negative"})},ae=()=>{a.value=L.A.getItem("EditDispatchDetail")||null,T()},ne=()=>{g.value=!g.value},oe=(0,N.KR)(!1);function ie(){oe.value=!0}function le(){oe.value=!1}function se(){oe.value=!0,a.value.dispatch.truck_driver.value=null}const de=(e,t)=>{t(""!==e?()=>{c.value=d.filter((t=>t.label.toLowerCase().indexOf(e.toLowerCase())>-1))}:()=>c.value=d)},ce=(e,t)=>{t(""!==e?()=>{c.value=d.filter((t=>t.label.toLowerCase().indexOf(e.toLowerCase())>-1))}:()=>c.value=d)},re=(0,n.EW)((()=>!!(a.value&&a.value.dispatch&&a.value.dispatch.truck)&&_.value.length>0&&m.value)),ue=(0,n.EW)((()=>re.value));function _e(e=[]){Array.isArray(e)||(e=[]);const t=t=>e.find((e=>e&&(e.receive_goods_id===t||e.receive_goods===t||e.receive_goods_id===t||e.receive_goods===t)));for(const e of i.value||[]){e.delivery_status||(e.delivery_status="delivery.status.pending"),e.payment_status||(e.payment_status="payment.status.unpaid");for(const a of e.items||[]){const e=Number(a.quantity_loaded??0),n=Number(a.quantity??a.quantity_loaded??0),o=Number(a.remaining_quantity??0);let i=o+e-n;if(Number.isFinite(i)||(i=0),a.remaining_quantity=Math.max(0,Math.round(i)),a.quantity_loaded=Number.isFinite(n)?n:0,!a.consignment_handler_id){const e=t(a.receive_goods_id??a.receivegoods_id??a.id);e&&(a.consignment_handler_id=e.consignment_handler_id??e.consignment_handler??e.id??a.consignment_handler_id)}}}o.value={dispatch:{...a.value?.dispatch||{},grand_total_amount:s.amount,grand_total_weight:s.weight},packageGroupMap:(i.value||[]).reduce(((e,t)=>{const a=t.consignment_id??t.id;return e[a]={id:a,dispatch_summary_id:t.consignment_dispatch_summary_id??null,items:(t.items||[]).reduce(((e,t)=>{const a=t.receive_goods_id??t.receivegoods_id??t.id;return e[a]={id:a,quantity_loaded:Number(t.quantity_loaded??t.quantity??0),dispatch_summary_id:t.consignment_dispatch_summary_id??null},e}),{})},e}),{})},"function"===typeof B&&B(),"function"===typeof J&&J(),a.value={dispatch:a.value?.dispatch||null,packageGroupList:i.value},L.A.set("EditDispatchDetail",a.value);const n={...a.value?.dispatch||{}};if("number"===typeof n.truck){const e=d.find((e=>e.value===n.truck));e&&(n.truck=e.label)}if("number"===typeof n.truck_driver){const e=r.value.find((e=>e.id===n.truck_driver));e&&(n.truck_driver=e.full_name)}L.A.set("SelectedTruckDispatch",n||null),L.A.set("TruckDispatchDetailData",i.value||null)}const me=(a,n,o)=>{if((!a||o)&&!n)return void e.notify({message:t("dispatch_planning.not_found")||"Item not found",color:"negative"});ee.value.push(a);const l=i.value.findIndex((e=>e.consignment_id===n));if(-1===l)return;const s=i.value[l],d=s.items.findIndex((e=>e.consignment_handler_id===a));-1!==d&&(s.items.splice(d,1),s.total_amount=(s.items||[]).reduce(((e,t)=>e+Number(t.total_amount||0)),0),s.total_weight=(s.items||[]).reduce(((e,t)=>e+Number(t.total_weight||0)),0),s.items.length||i.value.splice(l,1),s.items.length||_.value.splice(l,1),B(),J())};return{t,q:e,deleteRow:me,tooltip:F,goodsColumns:D,tableList:i,loading:u,columns:$,pagination:h,removeSelection:U,removeDlg:v,confirmRemove:K,removeTarget:f,countConsignment:l,grandTotal:s,dispatchList:_,isAllLock:m,confirmDlg:p,handleSubmit:Z,addDialog:b,openAddDialog:P,closeAddDialog:Q,unloadedColumns:C,selectedUnloaded:w,addSelectedConsignments:O,unloadedFilter:q,truckFilteredOptions:c,filterTruckDriver:de,fetchTruck:R,updateRow:M,reFresh:ae,collapseSmallTable:ne,onLock:G,onUnLock:X,lockAll:j,unLockAll:H,formatCurrency:V,formatWeight:z,selectedPg:a,filterTruck:ce,canSubmit:ue,tableCollapse:g,unloadedList:y,applyServerPatchLocally:_e,truckDriverUseInput:oe,onTruckDriverPopupShow:ie,onTruckDriverSelected:le,onTruckDriverCleared:se,truckDriverFilteredOptions:r}}};var D=a(2807),I=a(6653),V=a(6031),z=a(6384),T=a(7410),R=a(4940),U=a(9270),K=a(492),P=a(1356),Q=a(8462),E=a(6760),O=a(4488),M=a(5262),B=a(2156),G=a(3316),X=a(4189),j=a(2669),H=a(3676),J=a(386),Y=a(460),Z=a(8672),ee=a(8582),te=a.n(ee);const ae=(0,D.A)($,[["render",F],["__scopeId","data-v-7680af0c"]]),ne=ae;te()($,"components",{QTable:I.A,QBtnGroup:V.A,QBtn:z.A,QTooltip:T.A,QSelect:R.A,QInput:U.A,QIcon:K.A,QPopupProxy:P.A,QDate:Q.A,QChip:E.A,QTr:O.A,QTd:M.A,QDialog:B.A,QCard:G.A,QCardSection:X.A,QCardActions:j.A,QSpace:H.A,QSeparator:J.A,QCheckbox:Y.A}),te()($,"directives",{ClosePopup:Z.A})}}]);