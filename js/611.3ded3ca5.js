"use strict";(globalThis["webpackChunktbls"]=globalThis["webpackChunktbls"]||[]).push([[611],{5650:(e,t,a)=>{a.r(t),a.d(t,{default:()=>L});var l=a(1758),o=a(6683),i=a(2901);const s={key:0},d={class:"top-header"},r={class:"left-row"},n={class:"small-value"},c={class:"right-row"},u={class:"bottom-footer"},p={class:"footer-item"},h={class:"footer-item"},f={key:1,class:"empty-state"};function _(e,t,a,_,m,b){const g=(0,l.g2)("q-tooltip"),k=(0,l.g2)("q-btn"),y=(0,l.g2)("q-btn-group"),v=(0,l.g2)("q-td"),w=(0,l.g2)("EditableCell"),F=(0,l.g2)("q-tr"),x=(0,l.g2)("q-table");return _.dispatchID?((0,l.uX)(),(0,l.CE)("div",s,[(0,l.bF)(o.eB,{appear:"","enter-active-class":"animated fadeIn"},{default:(0,l.k6)((()=>[(0,l.bF)(x,{class:"my-sticky-header-large-table shadow-24",separator:"cell",rows:_.tableList,"row-key":"id",loading:_.loading,columns:_.columns,"no-data-label":"No data","no-results-label":"No data you want",style:{height:"calc(100vh - 150px)","max-height":"calc(100vh - 150px)"},flat:"",bordered:"",dense:"","rows-per-page-options":[0]},{top:(0,l.k6)((()=>[(0,l.Lk)("div",d,[(0,l.Lk)("div",r,[(0,l.bF)(y,{push:""},{default:(0,l.k6)((()=>[(0,l.bF)(k,{label:e.$t("refresh"),icon:"sym_r_refresh",onClick:_.reFresh},{default:(0,l.k6)((()=>[(0,l.bF)(g,(0,i._B)((0,l.Ng)(_.tooltip)),{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.$t("refreshtip")),1)])),_:1},16)])),_:1},8,["label","onClick"])])),_:1}),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(_.headerItems,(e=>((0,l.uX)(),(0,l.CE)("div",{key:e.label,class:"header-item"},[(0,l.eW)((0,i.v_)(e.label)+": ",1),(0,l.Lk)("span",n,(0,i.v_)(e.value),1)])))),128))]),(0,l.Lk)("div",c,[(0,l.bF)(k,{dense:"",label:_.tableCollapse?e.$t("expand"):e.$t("collapse"),icon:_.tableCollapse?"sym_r_expand":"sym_r_compress",color:_.tableCollapse?"green":"blue","no-caps":"",push:"",onClick:_.toggleCollapse},null,8,["label","icon","color","onClick"]),(0,l.bF)(k,{dense:"",push:"",color:"primary",onClick:_.MoreEdit,icon:"sym_r_edit_square",label:e.$t("truckdispatch.dispatch_detail.edit")},{default:(0,l.k6)((()=>[(0,l.bF)(g,(0,i._B)((0,l.Ng)(_.tooltip)),{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.$t("truckdispatch.dispatch_detail.edit")),1)])),_:1},16)])),_:1},8,["onClick","label"])])])])),body:(0,l.k6)((e=>[(0,l.bF)(F,{props:e},{default:(0,l.k6)((()=>[(0,l.bF)(v,{key:"code",props:e,class:"input-row"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.row.consignment_code),1)])),_:2},1032,["props"]),(0,l.bF)(v,{key:"received_date",props:e,class:"input-row"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(_.formatDate(e.row.received_date)),1)])),_:2},1032,["props"]),(0,l.bF)(v,{key:"customer",class:"header-item-background input-row turnicate-cell",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(_.truncate(e.row.customer,25)),1)])),_:2},1032,["props"]),(0,l.bF)(v,{key:"company",props:e,class:"input-row turnicate-cell"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.row.company),1)])),_:2},1032,["props"]),(0,l.bF)(v,{key:"total_weight",props:e,class:"input-row"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(_.formatNumber(e.row.total_weight)+" "+_.t("vs")),1)])),_:2},1032,["props"]),(0,l.bF)(v,{key:"total_amount",class:"header-item-background input-row",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(_.formatNumber(e.row.total_amount)+" "+_.t("ks")),1)])),_:2},1032,["props"]),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(_.editableColumns,(t=>((0,l.uX)(),(0,l.Wv)(w,{key:t.field,row:e.row,field:t.field,label:t.label,rules:t.rules,"edit-id":_.editId,"model-value":e.row.id===_.editId?_.editFormData[t.field]:e.row[t.field],translate:t.translate||!1,options:t.options||[],"options-label":t.optionsLabel||"label","options-value":t.optionsValue||"value","onUpdate:modelValue":a=>{e.row.id===_.editId&&(_.editFormData[t.field]=a)},props:e},null,8,["row","field","label","rules","edit-id","model-value","translate","options","options-label","options-value","onUpdate:modelValue","props"])))),128)),(0,l.bF)(v,{key:"action",props:e,style:(0,i.Tr)([{width:"100px"},_.actionCellStyle(e)])},{default:(0,l.k6)((()=>[e.row.id!==_.editId?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:0},(0,l.pI)(_.rowActions,(t=>((0,l.uX)(),(0,l.Wv)(k,(0,l.v6)({key:t.icon,ref_for:!0},t,{onClick:a=>t.action(e.row)}),{default:(0,l.k6)((()=>[(0,l.bF)(g,(0,l.v6)({ref_for:!0},_.tooltip),{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(t.tip),1)])),_:2},1040)])),_:2},1040,["onClick"])))),128)):((0,l.uX)(!0),(0,l.CE)(l.FK,{key:1},(0,l.pI)(_.editActions,(e=>((0,l.uX)(),(0,l.Wv)(k,(0,l.v6)({key:e.icon,ref_for:!0},e,{onClick:e.action}),null,16,["onClick"])))),128))])),_:2},1032,["props","style"])])),_:2},1032,["props"]),_.tableCollapse?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(F,{key:0},{default:(0,l.k6)((()=>[(0,l.bF)(v,{colspan:_.columns.length},{default:(0,l.k6)((()=>[(0,l.bF)(o.eB,{appear:"","enter-active-class":"animated fadeIn"},{default:(0,l.k6)((()=>[(0,l.bF)(x,{separator:"cell",rows:e.row.items||[],"row-key":"itemId",columns:_.goodsColumns,"no-data-label":"No Data",dense:"","hide-bottom":"",class:"my-sticky-header-small-table"},{body:(0,l.k6)((e=>[(0,l.bF)(F,{props:e},{default:(0,l.k6)((()=>[(0,l.bF)(v,{key:"goods_code",class:"input-row-small",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.row.goods_code),1)])),_:2},1032,["props"]),(0,l.bF)(v,{key:"goods_label",class:"input-row-small",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.row.goods_name),1)])),_:2},1032,["props"]),(0,l.bF)(v,{key:"quantity",class:"input-row-small",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.row.quantity_loaded),1)])),_:2},1032,["props"]),(0,l.bF)(v,{key:"rate",class:"input-row-small",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(_.formatNumber(e.row.goods_rate))+" Ks ",1)])),_:2},1032,["props"]),(0,l.bF)(v,{key:"weight",class:"input-row-small",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(_.formatNumber(e.row.goods_weight))+" V ",1)])),_:2},1032,["props"]),(0,l.bF)(v,{key:"total_weight",class:"input-row-small",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(_.formatNumber(e.row.total_weight)+" "+_.t("vs")),1)])),_:2},1032,["props"]),(0,l.bF)(v,{key:"total_amount",class:"input-row-small",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(_.formatNumber(e.row.total_amount)+" "+_.t("ks")),1)])),_:2},1032,["props"])])),_:2},1032,["props"])])),_:2},1032,["rows","columns"])])),_:2},1024)])),_:2},1032,["colspan"])])),_:2},1024))])),bottom:(0,l.k6)((()=>[(0,l.Lk)("div",u,[(0,l.Lk)("div",p,[(0,l.eW)((0,i.v_)(e.$t("truckdispatch.dispatch_detail.grand_total_weight"))+": ",1),(0,l.Lk)("span",null,(0,i.v_)(_.formatNumber(_.grandTotalWeight))+" V",1)]),(0,l.Lk)("div",h,[(0,l.eW)((0,i.v_)(e.$t("truckdispatch.dispatch_detail.grand_total_amount"))+": ",1),(0,l.Lk)("span",null,(0,i.v_)(_.formatNumber(_.grandTotalAmount))+" Ks",1)])])])),_:1},8,["rows","loading","columns"])])),_:1})])):((0,l.uX)(),(0,l.CE)("div",f,"NO DATA"))}a(310),a(5962),a(95),a(6724),a(2802);var m=a(2261),b=a(1271),g=a(4907),k=a(555),y=a(3537),v=a(455),w=a(5971);const F={name:"PageTruckDispatchDetail",components:{EditableCell:w.A},setup(){const{t:e}=(0,y.s9)(),t=(0,g.A)(),a=(0,v.rd)(),o=(0,k.KR)(!1),i=(0,k.KR)([]),s=(0,k.KR)(b.A.getItem("TruckDispatchDetailData")||null),d=b.A.getItem("SelectedTruckDispatch")||null,r=(0,k.KR)(null);r.value=x(d);const n=(0,k.KR)(r.value?.id||null),c={class:"bg-blue text-white shadow-4",offset:[10,10],contentStyle:"font-size: 12px"},u=e=>{const t=Number(e);return isFinite(t)?(new Intl.NumberFormat).format(t):"0"},p=e=>{if(!e)return"";const t=new Date(e);return isNaN(t)?String(e).replace(/-/g,"/").substring(0,10):new Intl.DateTimeFormat("en-GB").format(t)},h=(e,t=10)=>"string"===typeof e&&e.length>t?e.slice(0,t)+"â€¦":e||"",f=(0,k.KR)(!1),_=(0,k.Kh)([{name:"code",label:e("truckdispatch.dispatch_detail.consignment_code"),field:"code",align:"center",style:"min-width: 120px; max-width: 180px; ",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"received_date",label:e("truckdispatch.dispatch_detail.received_date"),field:"received_date",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"customer",label:e("truckdispatch.dispatch_detail.customer"),field:"customer",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"company",label:e("truckdispatch.dispatch_detail.company"),field:"company",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"total_weight",label:e("truckdispatch.dispatch_detail.total_weight"),field:"total_weight",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"total_amount",label:e("truckdispatch.dispatch_detail.total_amount"),field:"total_amount",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"delivery_status",label:e("truckdispatch.dispatch_detail.status"),field:"delivery_status",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"payment_type",label:e("truckdispatch.dispatch_detail.payment_type"),field:"payment_type",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"payment_status",label:e("truckdispatch.dispatch_detail.payment_status"),field:"payment_status",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"action",label:e("action"),align:"center",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"}]),w=(0,k.Kh)([{name:"goods_code",label:e("truckdispatch.dispatch_detail.goods_code"),field:"goods_code",align:"center",headerStyle:"font-weight: bold; font-size: 12px"},{name:"goods_label",label:e("truckdispatch.dispatch_detail.goods_name"),field:"goods_label",align:"left",headerStyle:"font-weight: bold; font-size: 12px"},{name:"quantity",label:e("truckdispatch.dispatch_detail.quantity_loaded"),field:"quantity",align:"center",headerStyle:"font-weight: bold; font-size: 12px"},{name:"rate",label:e("truckdispatch.dispatch_detail.goods_rate"),field:"rate",align:"left",headerStyle:"font-weight: bold; font-size: 12px"},{name:"weight",label:e("truckdispatch.dispatch_detail.goods_weight"),field:"weight",align:"left",headerStyle:"font-weight: bold; font-size: 12px"},{name:"total_weight",label:e("truckdispatch.dispatch_detail.total_weight"),field:"total_weight",align:"left",headerStyle:"font-weight: bold; font-size: 12px"},{name:"total_amount",label:e("truckdispatch.dispatch_detail.total_amount"),field:"total_amount",align:"left",headerStyle:"font-weight: bold; font-size: 12px"}]),F=["delivery.status.pending","delivery.status.partial","delivery.status.delivered"],D=F.map((t=>({label:e(t),value:t}))),S=["payment.type.cash","payment.type.kpay","payment.type.bank_transfer","payment.type.other"],C=S.map((t=>({label:e(t),value:t}))),E=["payment.status.unpaid","payment.status.paid"],N=E.map((t=>({label:e(t),value:t}))),W=(a=e("error.error"))=>t.notify({message:a,icon:"sym_r_close",color:"negative"}),z=async t=>{if(!s.value||t){o.value=!0;try{const t=await(0,m.getauth)(`truckdispatch/detail/?dispatchId=${n.value}`);"200"!==t.code&&W(e("error.fetch")),i.value=t.data||[],b.A.set("TruckDispatchDetailData",t.data)}catch(e){W(e?.toString())}finally{o.value=!1}}else i.value=s.value},A=async(e=!1)=>{if(n.value){o.value=!0;try{await z(e)}catch{W()}finally{o.value=!1}}else i.value=[]},I=()=>A(!0),T=()=>f.value=!f.value,K=()=>{b.A.set("EditDispatchDetail",{dispatch:r.value,packageGroupList:i.value}),a.push({name:"TruckDispatchEdit"}).catch((()=>{}))},L=e=>{b.A.set("EditSelectedTruckDispatchData",{dispatch:r.value,packageGroupList:[e]}),a.push({name:"DispatchEdit"}).catch((()=>{}))},O=(0,l.EW)((()=>i.value.reduce(((e,t)=>e+Number(t.total_weight||0)),0))),q=(0,l.EW)((()=>i.value.reduce(((e,t)=>e+Number(t.total_amount||0)),0))),X=(0,l.EW)((()=>[{label:e("truckdispatch.dispatch_detail.dispatch_code"),value:r.value?.code||""},{label:e("truckdispatch.dispatch_detail.truck"),value:r.value?.truck||""},{label:e("truckdispatch.dispatch_detail.dispatched_date"),value:r.value?.dispatch_date||""},{label:e("truckdispatch.dispatch_detail.truck_driver"),value:r.value?.truck_driver||""}])),$=(0,k.KR)(!1),V=(0,k.KR)(null),J=(0,k.Kh)({}),Q=(0,k.Kh)({}),R="consignmenthandler",j=t=>{if(null===t||void 0===t)return!0;const a=N.map((e=>e.value));return a.includes(t)||e("error.invalidSelection")},B=t=>{if(null===t||void 0===t)return!0;const a=D.map((e=>e.value));return a.includes(t)||e("error.invalidSelection")},G=t=>{if(null===t||void 0===t)return!0;const a=C.map((e=>e.value));return a.includes(t)||e("error.invalidSelection")},M=(0,l.EW)((()=>!0===j(J.payment_status)&&!0===B(J.delivery_status)&&!0===G(J.payment_type))),U=e=>{$.value=!0,V.value=e.id,te.forEach((t=>{Q[t.field]=JSON.parse(JSON.stringify(e[t.field]??null)),J[t.field]=JSON.parse(JSON.stringify(e[t.field]??null))}))},H=async()=>{if(!M.value)return void t.notify({message:e("error.data_invalid"),icon:"sym_r_close",color:"negative"});const a=Object.fromEntries(Object.entries(J).filter((([e,t])=>t!==Q[e])));if(Object.keys(a).length)try{t.loading.show();const l=await(0,m.patchauth)(`${R}/payment-update/${V.value}/`,a);if(!l||"200"!==l.code&&200!==l.status&&!l.success)throw new Error("update failed");{const a=i.value.findIndex((e=>e.id===V.value));if(-1!==a){const e=i.value[a];te.forEach((t=>{e[t.field]=JSON.parse(JSON.stringify(J[t.field]??null))}))}b.A.set("TruckDispatchDetailData",i.value),Object.keys(J).forEach((e=>delete J[e])),Object.keys(Q).forEach((e=>delete Q[e])),$.value=!1,V.value=null,t.notify({message:e("successful.update"),color:"green"})}}catch(a){t.notify({message:e("error.update"),color:"negative"})}finally{t.loading.hide()}else t.notify({message:e("warning.no_changes"),color:"warning"})},P=()=>{if(null!==V.value){const e=i.value.findIndex((e=>e.id===V.value));if(-1!==e){const t=i.value[e];te.forEach((e=>{t[e.field]=JSON.parse(JSON.stringify(Q[e.field]??null))})),b.A.set("TruckDispatchDetailData",i.value)}}Object.keys(J).forEach((e=>delete J[e])),Object.keys(Q).forEach((e=>delete Q[e])),$.value=!1,V.value=null,t.notify({message:e("cancel"),icon:"sym_r_close",color:"info"})},Y=e=>$.value&&e.row.id===V.value?{backgroundColor:"#cbc6d2"}:{},Z=[{round:!0,flat:!0,push:!0,color:"amber-4",icon:"sym_r_edit",tip:e("edit"),action:U}],ee=[{round:!0,flat:!0,push:!0,color:"green",icon:"sym_r_check",action:H},{round:!0,flat:!0,push:!0,color:"red",icon:"sym_r_close",action:P}],te=(0,k.Kh)([{field:"delivery_status",label:e("truckdispatch.dispatch_detail.delivery_status"),rules:[B],translate:!0,options:D,optionsLabel:"label",optionsValue:"value"},{field:"payment_type",label:e("truckdispatch.dispatch_detail.payment_type"),rules:[G],translate:!0,options:C,optionsLabel:"label",optionsValue:"value"},{field:"payment_status",label:e("truckdispatch.dispatch_detail.payment_status"),rules:[j],translate:!0,options:N,optionsLabel:"label",optionsValue:"value"}]);return(0,l.sV)(A),{t:e,tooltip:c,truncate:h,formatNumber:u,formatDate:p,loading:o,tableList:i,truckDispatchData:r,dispatchID:n,columns:_,goodsColumns:w,reFresh:I,tableCollapse:f,toggleCollapse:T,MoreEdit:K,MoreEditSingle:L,grandTotalWeight:O,grandTotalAmount:q,headerItems:X,editableColumns:te,editMode:$,editId:V,editFormData:J,originalFormData:Q,pathname:R,editData:U,editDataSubmit:H,editDataCancel:P,isEditFormValid:M,actionCellStyle:Y,rowActions:Z,editActions:ee}}};function x(e){if(!e)return null;try{const t="string"===typeof e?JSON.parse(e):e;return{id:t.id||t.dispatchId||null,truck:t.truck||(t.truck?.label?t.truck.label:"")||"",truck_driver:t.truck_driver||(t.truck?.label?t.truck.label:"")||"",dispatch_date:t.dispatch_date||t.date||"",code:t.code||t.dispatch_code||""}}catch{return null}}var D=a(2807),S=a(6653),C=a(6031),E=a(6384),N=a(7410),W=a(4488),z=a(5262),A=a(8416),I=a(8582),T=a.n(I);const K=(0,D.A)(F,[["render",_],["__scopeId","data-v-f7b1ccec"]]),L=K;T()(F,"components",{QTable:S.A,QBtnGroup:C.A,QBtn:E.A,QTooltip:N.A,QTr:W.A,QTd:z.A,QHeader:A.A})}}]);