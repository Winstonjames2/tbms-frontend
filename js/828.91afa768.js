"use strict";(globalThis["webpackChunktbls"]=globalThis["webpackChunktbls"]||[]).push([[828],{5828:(e,a,l)=>{l.r(a),l.d(a,{default:()=>P});var t=l(1758),o=l(2901),i=l(6683);const s={class:"row items-center q-gutter-x-sm"},r={class:"text-subtitle2"},n={class:"float-right q-ma-sm row items-center"},d={class:"text-caption q-mr-sm"},u={class:"text-caption q-mr-sm"},m={class:"row justify-end q-mt-md"},c={class:"row justify-end q-mt-md"};function g(e,a,l,g,p,b){const v=(0,t.g2)("q-icon"),f=(0,t.g2)("q-card-section"),_=(0,t.g2)("q-separator"),h=(0,t.g2)("q-input"),w=(0,t.g2)("q-tooltip"),k=(0,t.g2)("q-btn"),y=(0,t.g2)("q-td"),F=(0,t.g2)("q-table"),q=(0,t.g2)("q-select"),U=(0,t.g2)("q-form"),V=(0,t.g2)("q-card"),C=(0,t.g2)("q-dialog"),A=(0,t.g2)("q-card-actions");return(0,t.uX)(),(0,t.Wv)(V,{class:"glass-card user-management-card custom-scrollbar-color"},{default:(0,t.k6)((()=>[(0,t.bF)(f,{class:"card-header"},{default:(0,t.k6)((()=>[(0,t.bF)(v,{name:"sym_r_people",class:"header-icon"}),a[12]||(a[12]=(0,t.Lk)("div",{class:"text-h6"},"User Management",-1))])),_:1}),(0,t.bF)(_,{dark:""}),(0,t.bF)(f,{class:"row"},{default:(0,t.k6)((()=>[(0,t.bF)(h,{dense:"",outlined:"",clearable:"",debounce:"100",modelValue:g.searchQuery,"onUpdate:modelValue":a[0]||(a[0]=e=>g.searchQuery=e),placeholder:"Search by name or email",style:{width:"80%","max-width":"400px"}},{prepend:(0,t.k6)((()=>[(0,t.bF)(v,{name:"sym_r_search"})])),_:1},8,["modelValue"]),(0,t.bF)(k,{dense:"",class:"q-px-sm q-mx-sm",color:"primary",icon:"sym_r_person_add",onClick:g.openAddDialog},{default:(0,t.k6)((()=>[(0,t.bF)(w,(0,o._B)((0,t.Ng)(g.tooltip)),{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(e.$t("dashboard.user_management.add_user")),1)])),_:1},16)])),_:1},8,["onClick"])])),_:1}),(0,t.bF)(f,{class:"table-wrapper custom-scrollbar-color"},{default:(0,t.k6)((()=>[(0,t.bF)(F,{flat:"","hide-bottom":"","row-key":"id",class:"scrollable-table",style:{"background-color":"transparent"},columns:g.columns,rows:g.paginatedUsers,pagination:g.pagination},{"body-cell-email":(0,t.k6)((e=>[(0,t.bF)(y,{align:"left"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",s,[(0,t.Lk)("div",r,(0,o.v_)(g.isRevealed(e.row.id)?e.row.email:g.maskEmail(e.row.email)),1),(0,t.bF)(k,{dense:"",flat:"",round:"",size:"sm",icon:g.isRevealed(e.row.id)?"sym_r_visibility_off":"sym_r_visibility",onClick:(0,i.D$)((a=>g.toggleReveal(e.row.id)),["stop"]),title:g.isRevealed(e.row.id)?"Hide email":"Reveal email"},null,8,["icon","onClick","title"])])])),_:2},1024)])),"body-cell-actions":(0,t.k6)((e=>[(0,t.bF)(y,{align:"center"},{default:(0,t.k6)((()=>[(0,t.bF)(k,{flat:"",dense:"",round:"",color:"primary",icon:"sym_r_edit",onClick:a=>g.openEditDialog(e.row),title:"Edit user"},null,8,["onClick"])])),_:2},1024)])),_:1},8,["columns","rows","pagination"]),(0,t.Lk)("div",n,[(0,t.Lk)("div",d," Page "+(0,o.v_)(g.pagination.page)+" / "+(0,o.v_)(g.totalPages),1),(0,t.Lk)("div",u,"Total "+(0,o.v_)(l.totalCount),1),(0,t.bF)(k,{dense:"",color:"primary",rounded:"",icon:"sym_r_keyboard_arrow_left",class:"q-mr-sm",disable:!g.hasPrevPage||g.loadingPage,onClick:g.goPrev},{default:(0,t.k6)((()=>[(0,t.bF)(w,(0,o._B)((0,t.Ng)(g.tooltip)),{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(e.$t("dashboard.user_management.previous_page")),1)])),_:1},16)])),_:1},8,["disable","onClick"]),(0,t.bF)(k,{dense:"",color:"primary",rounded:"",icon:"sym_r_keyboard_arrow_right",class:"q-ml-sm",disable:!g.hasNextPage||g.loadingPage,onClick:g.goNext},{default:(0,t.k6)((()=>[(0,t.bF)(w,(0,o._B)((0,t.Ng)(g.tooltip)),{default:(0,t.k6)((()=>[(0,t.eW)((0,o.v_)(e.$t("dashboard.user_management.next_page")),1)])),_:1},16)])),_:1},8,["disable","onClick"])])])),_:1}),(0,t.bF)(C,{modelValue:g.showAddDialog,"onUpdate:modelValue":a[5]||(a[5]=e=>g.showAddDialog=e),persistent:""},{default:(0,t.k6)((()=>[(0,t.bF)(V,{style:{"min-width":"420px","max-width":"90vw"}},{default:(0,t.k6)((()=>[(0,t.bF)(f,{class:"bg-primary text-white"},{default:(0,t.k6)((()=>a[13]||(a[13]=[(0,t.Lk)("div",{class:"text-h6"},"User Registration Form",-1)]))),_:1}),(0,t.bF)(f,{class:"form-wrapper"},{default:(0,t.k6)((()=>[(0,t.bF)(U,{ref:"addFormRef",onSubmit:(0,i.D$)(g.handleAddUser,["prevent"])},{default:(0,t.k6)((()=>[(0,t.bF)(h,{modelValue:g.newUser.first_name,"onUpdate:modelValue":a[1]||(a[1]=e=>g.newUser.first_name=e),label:"Display Name",outlined:"",dense:"",autofocus:"",rules:[g.rules.required,g.rules.minName],"lazy-rules":""},null,8,["modelValue","rules"]),(0,t.bF)(h,{modelValue:g.newUser.email,"onUpdate:modelValue":a[2]||(a[2]=e=>g.newUser.email=e),label:"Email",outlined:"",dense:"",rules:[g.rules.required,g.rules.email],"lazy-rules":""},null,8,["modelValue","rules"]),(0,t.bF)(q,{modelValue:g.newUser.role,"onUpdate:modelValue":a[3]||(a[3]=e=>g.newUser.role=e),label:"Role",outlined:"",dense:"",options:g.roleOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",rules:[g.rules.required],"lazy-rules":""},null,8,["modelValue","options","rules"]),(0,t.bF)(h,{modelValue:g.newUser.password,"onUpdate:modelValue":a[4]||(a[4]=e=>g.newUser.password=e),type:"password",label:"Password",outlined:"",dense:"",autocomplete:"new-password",rules:[g.rules.required,g.rules.password],"lazy-rules":"",hint:e.$t("auth.password_hint")},null,8,["modelValue","rules","hint"]),(0,t.Lk)("div",m,[(0,t.bF)(k,{flat:"",label:"Cancel",onClick:g.closeAddDialog},null,8,["onClick"]),(0,t.bF)(k,{loading:g.addLoading,disable:g.addLoading,label:"Add",class:"bg-primary text-white q-ml-sm",onClick:g.submitAddForm},null,8,["loading","disable","onClick"])])])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.bF)(C,{modelValue:g.showEditDialog,"onUpdate:modelValue":a[9]||(a[9]=e=>g.showEditDialog=e),persistent:""},{default:(0,t.k6)((()=>[(0,t.bF)(V,{style:{"min-width":"420px","max-width":"90vw"}},{default:(0,t.k6)((()=>[(0,t.bF)(f,{class:"bg-primary text-white"},{default:(0,t.k6)((()=>a[14]||(a[14]=[(0,t.Lk)("div",{class:"text-h6"},"Edit User",-1)]))),_:1}),(0,t.bF)(f,{class:"form-wrapper"},{default:(0,t.k6)((()=>[(0,t.bF)(U,{ref:"editFormRef",onSubmit:(0,i.D$)(g.handleEditUser,["prevent"])},{default:(0,t.k6)((()=>[(0,t.bF)(h,{modelValue:g.editUser.first_name,"onUpdate:modelValue":a[6]||(a[6]=e=>g.editUser.first_name=e),label:"Display Name",outlined:"",dense:"",rules:[g.rules.required,g.rules.minName]},null,8,["modelValue","rules"]),(0,t.bF)(h,{modelValue:g.editUser.email,"onUpdate:modelValue":a[7]||(a[7]=e=>g.editUser.email=e),label:"Email",outlined:"",dense:"",rules:[g.rules.required,g.rules.email]},null,8,["modelValue","rules"]),(0,t.bF)(q,{modelValue:g.editUser.role,"onUpdate:modelValue":a[8]||(a[8]=e=>g.editUser.role=e),label:"Role",outlined:"",dense:"",options:g.roleOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",rules:[g.rules.required]},null,8,["modelValue","options","rules"]),(0,t.Lk)("div",c,[(0,t.bF)(k,{flat:"",label:"Cancel",onClick:g.closeEditDialog},null,8,["onClick"]),(0,t.bF)(k,{loading:g.editLoading,disable:g.editLoading,label:"Save",class:"bg-primary text-white q-ml-sm",onClick:g.submitEditForm},null,8,["loading","disable","onClick"])])])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.bF)(C,{modelValue:g.showNoChangesDialog,"onUpdate:modelValue":a[11]||(a[11]=e=>g.showNoChangesDialog=e)},{default:(0,t.k6)((()=>[(0,t.bF)(V,{style:{"min-width":"300px"}},{default:(0,t.k6)((()=>[(0,t.bF)(f,null,{default:(0,t.k6)((()=>a[15]||(a[15]=[(0,t.Lk)("div",{class:"text-h6"},"No changes detected",-1),(0,t.Lk)("div",{class:"text-body2 q-mt-sm"}," You didn't change any fields. Nothing to save. ",-1)]))),_:1}),(0,t.bF)(A,{align:"right"},{default:(0,t.k6)((()=>[(0,t.bF)(k,{flat:"",label:"OK",color:"primary",onClick:a[10]||(a[10]=e=>g.showNoChangesDialog=!1)})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}l(310),l(5962),l(7225),l(8743),l(2858),l(2071),l(5520),l(2775),l(6203);var p=l(555),b=l(4907),v=l(2261),f=l(3537);const _={name:"UserManagement",props:{users:{type:Array,required:!0},totalCount:{type:Number,required:!0}},emits:["reload-user"],setup(e,{emit:a}){const l=(0,b.A)(),{t:o}=(0,f.s9)(),i=(0,p.KR)(""),s=(0,p.KR)(!1),r=(0,p.KR)(!1),n=(0,p.KR)(!1),d=(0,p.KR)(null),u=(0,p.KR)(null),m=(0,p.KR)(!1),c=(0,p.KR)(!1),g=(0,p.KR)(!1),_=25,h=(0,p.KR)({page:1,rowsPerPage:_}),w=(0,p.KR)(new Set),k=(0,p.KR)({first_name:"",email:"",password:"",role:null}),y=(0,p.KR)({}),F=(0,p.KR)(null),q=[{label:"Staff",value:"staff"},{label:"User",value:"user"}],U={required:e=>null!==e&&void 0!==e&&String(e).trim().length>0||o("auth.required"),minName:e=>!e||String(e).trim().length>=4||o("auth.min4"),email:e=>{if(!e)return o("auth.email_required");const a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return a.test(e)||o("auth.invalid_email_rule")},password:e=>{if(!e)return o("auth.password_required");const a=/^(?=.*[A-Za-z])(?=.*\d).{8,}$/;return a.test(e)||o("auth.password_rule")}},V=(0,t.EW)((()=>{const a=(i.value||"").toLowerCase().trim();return a?(e.users||[]).filter((e=>String(e.first_name||"").toLowerCase().includes(a)||String(e.email||"").toLowerCase().includes(a))):e.users||[]})),C=(0,t.EW)((()=>{const e=(h.value.page-1)*h.value.rowsPerPage;return V.value.slice(e,e+h.value.rowsPerPage)})),A=(0,t.EW)((()=>{const a=Number(e.totalCount||0);return Math.max(1,Math.ceil(a/_))})),x={class:"bg-blue text-white shadow-4",offset:[10,10],contentStyle:"font-size: 12px"},S=(0,t.EW)((()=>h.value.page<A.value)),R=(0,t.EW)((()=>h.value.page>1));function D(e){if(!e)return"";const a=String(e).split("@");if(2!==a.length)return"***";const[l,t]=a;if(!l)return`***@${t}`;const o=l.charAt(0);return`${o}***@${t}`}function E(e){return w.value.has(e)}function L(e){w.value.has(e)?w.value.delete(e):w.value.add(e),w.value=new Set(w.value)}function N(){k.value={first_name:"",email:"",password:"",role:null},d.value&&d.value.resetValidation&&d.value.resetValidation()}function P(){S.value&&h.value.page++}function Q(){R.value&&h.value.page--}function K(){N(),s.value=!0,(0,t.dY)((()=>d.value&&d.value.resetValidation&&d.value.resetValidation()))}function $(){s.value=!1}function W(e){y.value={id:e.id,first_name:e.first_name??"",email:e.email??"",role:e.role??null},F.value={...y.value},r.value=!0,(0,t.dY)((()=>u.value&&u.value.resetValidation&&u.value.resetValidation()))}function z(){r.value=!1}function B(){return!!F.value&&(String(F.value.first_name||"").trim()===String(y.value.first_name||"").trim()&&String(F.value.email||"").trim()===String(y.value.email||"").trim()&&String(F.value.role||"")===String(y.value.role||""))}async function T(){const e=!d.value||await d.value.validate();e?I():l.notify({message:o("warning.fix_validation"),color:"negative"})}async function I(){m.value=!0;try{const e={first_name:String(k.value.first_name||"").trim(),email:String(k.value.email||"").trim(),password:k.value.password,role:k.value.role},t=await(0,v.postauth)("/dashboard/userlist/",e);if("200"!==t.code)return l.notify({message:o("dashboard.user_management.failed_user_add"),color:"negative"}),void(m.value=!1);const i=t&&t.data&&t.data.data||t&&t.data||t;a("reload-user",i),l.notify({message:o("dashboard.user_management.success_user_add"),color:"positive"}),$(),N()}catch(e){l.notify({message:o("dashboard.user_management.failed_user_add"),color:"negative"})}finally{m.value=!1}}async function M(){const e=!u.value||await u.value.validate();e?B()?l.notify({message:o("warning.no_changes"),color:"warning"}):O():l.notify({message:o("warning.fix_validation"),color:"warning"})}async function O(){c.value=!0;try{const e=y.value,t={first_name:String(e.first_name||"").trim(),email:String(e.email||"").trim(),role:e.role},i=await(0,v.patchauth)(`/dashboard/userlist/${e.id}/`,t);if("200"!==i.code)return l.notify({message:o("dashboard.user_management.failed_user_update"),color:"negative"}),void(c.value=!1);a("reload-user",{id:e.id,...t}),l.notify({color:"positive",message:o("dashboard.user_management.success_user_update")}),z()}catch(e){l.notify({message:o("dashboard.user_management.failed_user_update"),color:"negative"})}finally{c.value=!1}}(0,t.wB)(i,(()=>{h.value.page=1}));const Y=[{name:"id",label:"ID",field:"id",align:"left",sortable:!0},{name:"first_name",label:"Display Name",field:"first_name",align:"left",sortable:!0},{name:"email",label:"Email",align:"left",field:"email"},{name:"role",label:"Role",field:e=>e.role?String(e.role).charAt(0).toUpperCase()+String(e.role).slice(1):"",align:"left",sortable:!0},{name:"actions",label:"Actions",align:"center"}];return(0,t.wB)((()=>e.totalCount),(()=>{h.value.page>A.value&&(h.value.page=A.value)})),{searchQuery:i,showAddDialog:s,showEditDialog:r,showNoChangesDialog:n,addFormRef:d,editFormRef:u,addLoading:m,editLoading:c,loadingPage:g,newUser:k,editUser:y,roleOptions:q,columns:Y,pagination:h,paginatedUsers:C,totalPages:A,hasNextPage:S,hasPrevPage:R,rules:U,maskEmail:D,isRevealed:E,toggleReveal:L,openAddDialog:K,closeAddDialog:$,openEditDialog:W,closeEditDialog:z,submitAddForm:T,submitEditForm:M,goNext:P,goPrev:Q,handleAddUser:I,handleEditUser:O,tooltip:x}}};var h=l(2807),w=l(3316),k=l(4189),y=l(492),F=l(386),q=l(9270),U=l(6384),V=l(7410),C=l(6653),A=l(5262),x=l(2156),S=l(9200),R=l(4940),D=l(2669),E=l(8582),L=l.n(E);const N=(0,h.A)(_,[["render",g],["__scopeId","data-v-13219908"]]),P=N;L()(_,"components",{QCard:w.A,QCardSection:k.A,QIcon:y.A,QSeparator:F.A,QInput:q.A,QBtn:U.A,QTooltip:V.A,QTable:C.A,QTd:A.A,QDialog:x.A,QForm:S.A,QSelect:R.A,QCardActions:D.A})}}]);