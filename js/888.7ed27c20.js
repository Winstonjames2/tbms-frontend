"use strict";(globalThis["webpackChunktbls"]=globalThis["webpackChunktbls"]||[]).push([[888],{888:(e,o,t)=>{t.r(o),t.d(o,{default:()=>ue});var a=t(1758),l=t(6683),n=t(2901);const s={class:"page-wrap custom-scrollbar-color"},i={class:"col-12 row"},r={class:"text-h5 text-primary"},d={class:"col-12 col-md-4"},u={class:"field-label"},c={class:"col-12 col-md-4"},p={class:"field-label"},m={class:"col-12 col-md-4"},v={class:"field-label"},g={class:"row items-center justify-end q-gutter-sm q-pa-sm"},b={class:"q-mt-md"},_={class:"col-12 col-md-6"},y={class:"text-body2"},f={class:"text-grey-8"},w={class:"col-12 col-md-6"},k={class:"text-body1 text-grey-7"},h={class:"text-h6 text-primary text-weight-bold"},F={class:"text-body2 text-grey-7"},C={class:"text-subtitle2 text-weight-medium"},q={class:"sticky-actions q-pa-sm"},x={class:"text-h6"};function V(e,o,t,V,A,R){const S=(0,a.g2)("q-btn"),L=(0,a.g2)("q-icon"),P=(0,a.g2)("q-item-section"),Q=(0,a.g2)("q-item"),$=(0,a.g2)("q-select"),I=(0,a.g2)("q-date"),U=(0,a.g2)("q-popup-proxy"),K=(0,a.g2)("q-input"),N=(0,a.g2)("q-card-section"),D=(0,a.g2)("q-card"),W=(0,a.g2)("q-th"),T=(0,a.g2)("q-tr"),G=(0,a.g2)("q-td"),O=(0,a.g2)("q-tooltip"),E=(0,a.g2)("q-table"),M=(0,a.g2)("q-separator"),B=(0,a.g2)("q-banner"),H=(0,a.g2)("q-avatar"),j=(0,a.g2)("q-card-actions"),z=(0,a.g2)("q-dialog"),X=(0,a.g2)("q-page"),J=(0,a.gN)("close-popup");return(0,a.uX)(),(0,a.Wv)(X,{class:"page-container"},{default:(0,a.k6)((()=>[(0,a.bF)(l.eB,{appear:"","enter-active-class":"animated fadeIn"},{default:(0,a.k6)((()=>[(0,a.Lk)("div",s,[(0,a.bF)(D,{class:"card header-card"},{default:(0,a.k6)((()=>[(0,a.bF)(N,{class:"row q-col-gutter-md items-end"},{default:(0,a.k6)((()=>[(0,a.Lk)("div",i,[(0,a.Lk)("div",r,(0,n.v_)(e.$t("receivegoods.title")),1),(0,a.bF)(S,{onClick:o[0]||(o[0]=e=>V.goToPrintPage())},{default:(0,a.k6)((()=>o[6]||(o[6]=[(0,a.eW)("Print Page")]))),_:1})]),(0,a.Lk)("div",d,[(0,a.Lk)("div",u,(0,n.v_)(e.$t("receivegoods.view_receivegoods.customer")),1),(0,a.bF)($,{dense:"",filled:"",clearable:"",modelValue:V.selectedCustomer,"onUpdate:modelValue":o[1]||(o[1]=e=>V.selectedCustomer=e),options:V.customerFilteredOptions,onFilter:V.onCustomerFilter,"input-debounce":"0","use-input":V.customerUseInput,behavior:"menu","emit-value":"","map-options":"","option-label":e=>e?.label??"","option-value":e=>e?.value??null,loading:V.loading,disable:V.loading,error:V.customerError,"error-message":e.$t("error.input.enterValue"),hint:"Start typing to search",class:"input-field",onPopupHide:V.onCustomerSelected,onPopupShow:V.onCustomerPopupShow,onClear:V.onCustomerCleared},{prepend:(0,a.k6)((()=>[(0,a.bF)(L,{name:"sym_r_people"})])),"no-option":(0,a.k6)((()=>[(0,a.bF)(Q,null,{default:(0,a.k6)((()=>[(0,a.bF)(P,{class:"text-grey"},{default:(0,a.k6)((()=>[(0,a.eW)((0,n.v_)(e.$t("noResults")),1)])),_:1})])),_:1})])),_:1},8,["modelValue","options","onFilter","use-input","option-label","option-value","loading","disable","error","error-message","onPopupHide","onPopupShow","onClear"])]),(0,a.Lk)("div",c,[(0,a.Lk)("div",p,(0,n.v_)(e.$t("receivegoods.view_receivegoods.company")),1),(0,a.bF)($,{dense:"",filled:"",clearable:"",modelValue:V.selectedCompany,"onUpdate:modelValue":o[2]||(o[2]=e=>V.selectedCompany=e),options:V.companyFilteredOptions,onFilter:V.onCompanyFilter,"input-debounce":"0","use-input":V.companyUseInput,behavior:"menu","emit-value":"","map-options":"","option-label":e=>e?.label??"","option-value":e=>e?.value??null,loading:V.loading,disable:V.loading,error:V.customerError,"error-message":e.$t("error.input.enterValue"),hint:"Start typing to search",class:"input-field",maxlength:"50",onPopupHide:V.onCompanySelected,onPopupShow:V.onCompanyPopupShow,onClear:V.onCompanyCleared},{prepend:(0,a.k6)((()=>[(0,a.bF)(L,{name:"sym_r_business"})])),"no-option":(0,a.k6)((()=>[(0,a.bF)(Q,null,{default:(0,a.k6)((()=>[(0,a.bF)(P,{class:"text-grey"},{default:(0,a.k6)((()=>[(0,a.eW)((0,n.v_)(e.$t("noResults")),1)])),_:1})])),_:1})])),_:1},8,["modelValue","options","onFilter","use-input","option-label","option-value","loading","disable","error","error-message","onPopupHide","onPopupShow","onClear"])]),(0,a.Lk)("div",m,[(0,a.Lk)("div",v,(0,n.v_)(e.$t("receivegoods.date")),1),(0,a.bF)(K,{dense:"",filled:"",modelValue:V.date,"onUpdate:modelValue":o[4]||(o[4]=e=>V.date=e),mask:"date",rules:["date"],class:"input-field"},{append:(0,a.k6)((()=>[(0,a.bF)(L,{name:"sym_r_event",color:"primary",class:"cursor-pointer"},{default:(0,a.k6)((()=>[(0,a.bF)(U,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.k6)((()=>[(0,a.bF)(I,{modelValue:V.date,"onUpdate:modelValue":o[3]||(o[3]=e=>V.date=e)},{default:(0,a.k6)((()=>[(0,a.Lk)("div",g,[(0,a.bo)((0,a.bF)(S,{flat:"",color:"primary",label:"Close"},null,512),[[J]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])])),_:1})])),_:1}),(0,a.bF)(D,{class:"card"},{default:(0,a.k6)((()=>[(0,a.bF)(N,null,{default:(0,a.k6)((()=>[(0,a.bF)(E,{rows:V.rows,columns:V.columns,"row-key":"__rowId",flat:"",dense:"","hide-bottom":"",separator:"cell",class:"rg-table","rows-per-page-options":[0]},{header:(0,a.k6)((e=>[(0,a.bF)(T,{props:e},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.cols,(o=>((0,a.uX)(),(0,a.Wv)(W,{key:o.name,props:e,style:{"font-size":"1rem","font-weight":"bold"},class:"text-h5"},{default:(0,a.k6)((()=>[(0,a.eW)((0,n.v_)(o.label),1)])),_:2},1032,["props"])))),128))])),_:2},1032,["props"])])),body:(0,a.k6)((o=>[(0,a.bF)(T,{props:o,class:"row-hover"},{default:(0,a.k6)((()=>[(0,a.bF)(G,{key:"goods",props:o},{default:(0,a.k6)((()=>[(0,a.bF)($,{dense:"",filled:"",modelValue:o.row.name,"onUpdate:modelValue":[e=>o.row.name=e,e=>V.onGoodsModelUpdate(e,o.row)],options:V.goodsFilteredOptions,onFilter:(e,t)=>V.onGoodsFilter(e,t,o.row),"use-input":"","input-debounce":"0",behavior:"menu","option-label":e=>e?.label??"","option-value":e=>e??null,onInputValue:()=>V.onGoodsSelected(o.row),onClear:()=>V.onGoodsCleared(o.row),clearable:""},{"no-option":(0,a.k6)((()=>[(0,a.bF)(Q,null,{default:(0,a.k6)((()=>[(0,a.bF)(P,{class:"text-grey"},{default:(0,a.k6)((()=>[(0,a.eW)((0,n.v_)(e.$t("noResults")),1)])),_:1})])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue","options","onFilter","option-label","option-value","onInputValue","onClear"])])),_:2},1032,["props"]),(0,a.bF)(G,{key:"quantity",props:o},{default:(0,a.k6)((()=>[(0,a.bF)(K,{dense:"",filled:"",modelValue:o.row.quantity,"onUpdate:modelValue":[e=>o.row.quantity=e,e=>V.onQuantityChange(e,o.row)],modelModifiers:{number:!0},type:"number",min:"0","input-class":"text-left",m:""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["props"]),(0,a.bF)(G,{key:"goods_rate",props:o},{default:(0,a.k6)((()=>[(0,a.bF)(K,{dense:"",filled:"",modelValue:o.row.goods_rate,"onUpdate:modelValue":e=>o.row.goods_rate=e,modelModifiers:{number:!0},type:"number",readonly:"","input-class":"text-right"},{prepend:(0,a.k6)((()=>[(0,a.bF)(L,{name:"sym_r_payments"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["props"]),(0,a.bF)(G,{key:"goods_total",props:o},{default:(0,a.k6)((()=>[(0,a.bF)(K,{dense:"",filled:"",modelValue:o.row.goods_total,"onUpdate:modelValue":e=>o.row.goods_total=e,modelModifiers:{number:!0},type:"number",readonly:"","input-class":"text-right"},{prepend:(0,a.k6)((()=>[(0,a.bF)(L,{name:"sym_r_calculate"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["props"]),(0,a.bF)(G,{key:"actions",props:o,class:"text-center"},{default:(0,a.k6)((()=>[(0,a.bF)(S,{round:"",dense:"",flat:"",color:"negative",icon:"sym_r_delete",onClick:e=>V.deleteRow(o.rowIndex)},{default:(0,a.k6)((()=>[(0,a.bF)(O,(0,n._B)((0,a.Ng)(V.tooltip)),{default:(0,a.k6)((()=>[(0,a.eW)((0,n.v_)(e.$t("index.removeRow")),1)])),_:1},16)])),_:2},1032,["onClick"])])),_:2},1032,["props"])])),_:2},1032,["props"])])),_:1},8,["rows","columns"]),(0,a.Lk)("div",b,[(0,a.bF)(S,{outline:"",rounded:"",color:"positive",icon:"sym_r_add",label:e.$t("receivegoods.view_receivegoods.addRow"),class:"text-capitalize",onClick:V.addRow},null,8,["label","onClick"])])])),_:1}),(0,a.bF)(M,{spaced:""}),(0,a.bF)(N,{class:"row q-col-gutter-md items-stretch"},{default:(0,a.k6)((()=>[(0,a.Lk)("div",_,[(0,a.bF)(B,{rounded:""},{default:(0,a.k6)((()=>[(0,a.Lk)("div",y,[(0,a.eW)((0,n.v_)(e.$t("tips")||"Tips")+": ",1),(0,a.Lk)("span",f,(0,n.v_)(e.$t("receivegoods.view_receivegoods.tipMessage")),1)])])),_:1})]),(0,a.Lk)("div",w,[(0,a.bF)(D,{flat:"",bordered:"",class:"totals-card"},{default:(0,a.k6)((()=>[(0,a.bF)(N,{class:"row items-center justify-between"},{default:(0,a.k6)((()=>[(0,a.Lk)("div",k,(0,n.v_)(e.$t("receivegoods.view_receivegoods.grandTotalAmount")),1),(0,a.Lk)("div",h,(0,n.v_)(V.formatNumber(V.supertotal)),1)])),_:1}),(0,a.bF)(M),(0,a.bF)(N,{class:"row items-center justify-between"},{default:(0,a.k6)((()=>[(0,a.Lk)("div",F,(0,n.v_)(e.$t("receivegoods.view_receivegoods.grandTotalWeight")),1),(0,a.Lk)("div",C,(0,n.v_)(V.formatNumber(V.totalWeight)),1)])),_:1})])),_:1})])])),_:1})])),_:1}),(0,a.Lk)("div",q,[(0,a.bF)(S,{color:"primary",unelevated:"",icon:"sym_r_save",label:e.$t("receivegoods.view_receivegoods.save"),class:"action-btn",onClick:V.tryOpenSubmitDialog,disable:!V.canSubmit||V.loading},null,8,["label","onClick","disable"])]),(0,a.bF)(z,{modelValue:V.submitDialog,"onUpdate:modelValue":o[5]||(o[5]=e=>V.submitDialog=e),persistent:""},{default:(0,a.k6)((()=>[(0,a.bF)(D,{style:{"min-width":"360px","max-width":"92vw"}},{default:(0,a.k6)((()=>[(0,a.bF)(N,{class:"row items-center q-gutter-sm"},{default:(0,a.k6)((()=>[(0,a.bF)(H,{icon:"sym_r_check",color:"primary","text-color":"white"}),(0,a.Lk)("div",x,(0,n.v_)(e.$t("receivegoods.view_receivegoods.confirmSave")),1)])),_:1}),(0,a.bF)(M),(0,a.bF)(N,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,n.v_)(e.$t("receivegoods.view_receivegoods.confirmSaveContent")),1)])),_:1}),(0,a.bF)(j,{align:"right",class:"q-pa-md"},{default:(0,a.k6)((()=>[(0,a.bo)((0,a.bF)(S,{flat:"",label:e.$t("receivegoods.view_receivegoods.cancel"),color:"negative",icon:"sym_r_close"},null,8,["label"]),[[J]]),(0,a.bF)(S,{color:"primary",label:e.$t("receivegoods.view_receivegoods.ok"),icon:"sym_r_check",onClick:V.submitData},null,8,["label","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])])),_:1})])),_:1})}t(310),t(5962),t(2203),t(6724),t(2802);var A=t(555),R=t(3537),S=t(4907),L=t(1271),P=t(2261),Q=t(7144),$=t(455);let I=0;const U=()=>({__rowId:`row-${Date.now()}-${I++}`,name:null,quantity:null,goods_rate:0,goods_weight:0,goods_total:0}),K={name:"ReceiveGoodsPage",setup(){const{t:e}=(0,R.s9)(),o=(0,S.A)(),t=(0,$.rd)(),l=(0,A.KR)(!1),n=(0,A.KR)(!1),s=(0,A.KR)((new Date).toISOString().split("T")[0].replace(/-/g,"/")),i=(0,A.KR)(null),r=(0,A.KR)(null),d=(0,A.KR)([]),u=(0,A.KR)([]),c=(0,A.KR)([]),p=(0,A.KR)([]),m=(0,A.KR)([]),v=(0,A.KR)([]),g=(0,A.KR)(!0),b=(0,A.KR)(!0),_=(0,A.KR)([U(),U(),U(),U()]),y=(0,A.KR)(0),f=(0,A.KR)(0),w=[{name:"goods",label:e("receivegoods.view_receivegoods.particular"),field:"name",align:"left"},{name:"quantity",label:e("receivegoods.view_receivegoods.quantity"),field:"quantity",align:"left",style:"max-width: 150px; min-width: 140px;"},{name:"goods_rate",label:e("receivegoods.view_receivegoods.rate"),field:"goods_rate",align:"right",style:"max-width: 150px; min-width: 140px;"},{name:"goods_total",label:e("receivegoods.view_receivegoods.total"),field:"goods_total",align:"right",style:"max-width: 150px; min-width: 140px;"},{name:"actions",label:e("receivegoods.view_receivegoods.delete"),field:"__actions",align:"center"}],k=(e,o)=>(t,a)=>{const l=(t||"").toString().toLowerCase();a((()=>{o.value=l?e.value.filter((e=>e.label.toLowerCase().includes(l))):e.value}))},h=k(d,p),F=k(u,m),C=k(c,v);function q(e,o){g.value=!0,h(e,o)}function x(e,o){b.value=!0,F(e,o)}function V(e,o,t){C(e,o)}const I=()=>{y.value=_.value.reduce(((e,o)=>e+(Number(o.goods_total)||0)),0),f.value=_.value.reduce(((e,o)=>{const t=Number(o.name?.goods_weight)||0,a=Number(o.quantity);return e+t*a}),0)};function K(e){if(null===e||void 0===e||""===e)return null;const o=Number(e);return Number.isNaN(o)?null:o}const N=e=>{e.goods_rate=e?.name?Math.floor(Number(e.name.goods_rate)||0):0;const o=K(e.quantity);e.quantity=null===o?null:o,e.goods_total=(Number(e.goods_rate)||0)*(o||0),I()},D=async()=>{const e=d.value.find((e=>e.value===i.value))?.label,o=u.value.find((e=>e.value===r.value))?.label,a=Y.value.map((e=>{const o=c.value.find((o=>o.value===e.name.value));return{goods_id:e.name.value,goods_name:o?.label,quantity:e.quantity,goods_rate:o?.goods_rate||0,goods_total:(o?.goods_rate||0)*(e.quantity||0)}})),l={ConsignmentData:{received_date:s.value.replace(/\//g,"-"),customer:i.value,customer_name:e,company:r.value,company_name:o,total_amount:y.value,total_weight:f.value},receiveGoodsData:a},n=encodeURIComponent(JSON.stringify(l));await t.push({path:"/receive-goods/print",query:{payload:n}})};function W(e,o){o.name=e,N(o)}function T(e){N(e)}function G(e){e.name=null,N(e)}function O(e,o){o.quantity=K(e),N(o)}function E(){g.value=!0}function M(){g.value=!1}function B(){g.value=!0,i.value=null}function H(){b.value=!0}function j(){b.value=!1}function z(){r.value=null,b.value=!0}const X=()=>{console.log(_.value),_.value.push(U())},J=e=>{_.value.splice(e,1),I()},Y=(0,a.EW)((()=>_.value.filter((e=>e.name&&Number(e.quantity)>0)))),Z=(0,a.EW)((()=>!!i.value&&Y.value.length>0)),ee=(0,A.KR)(!1),oe=(0,a.EW)((()=>!i.value&&ee.value)),te=()=>{ee.value=!0,Z.value?n.value=!0:o.notify({type:"warning",message:e("error.fillRequired")})},ae=async()=>{try{l.value=!0;const e={ConsignmentData:{received_date:s.value.replace(/\//g,"-"),customer:i.value,company:r.value,total_amount:y.value,total_weight:f.value},receiveGoodsData:Y.value.map((e=>({goods:e.name.value,quantity:e.quantity})))},t=await(0,P.postauth)("consignment/",e);if("200"!==t.code)return void o.notify({color:"negative",icon:"sym_r_close",message:"Failed Registering Data!"});o.notify({color:"positive",icon:"sym_r_check",message:"Successfully Created"})}catch(e){le(),o.notify({color:"negative",icon:"sym_r_close",message:"Failed Registering Data! "+e})}finally{l.value=!1,n.value=!1}},le=()=>{_.value=[U(),U(),U(),U()],i.value=null,r.value=null,y.value=0,f.value=0,ee.value=!1,g.value=!0,b.value=!0},ne=async()=>{L.A.has("customer")||await(0,Q.e7)("customer"),L.A.has("company")||await(0,Q.e7)("company"),L.A.has("goods")||await(0,Q.e7)("goods"),d.value=(L.A.getItem("customer")||[]).map((e=>({label:e.name,value:e.id}))),u.value=(L.A.getItem("company")||[]).map((e=>({label:e.name,value:e.id}))),c.value=(L.A.getItem("goods")||[]).map((e=>({label:e.name,value:e.id,goods_rate:e.goods_rate,goods_weight:e.goods_weight}))),p.value=d.value,m.value=u.value,v.value=c.value};(0,a.sV)(ne);const se=e=>(new Intl.NumberFormat).format(Number(e||0)),ie={class:"bg-blue text-white shadow-4",offset:[10,10],contentStyle:"font-size: 12px"};return{t:e,tooltip:ie,loading:l,submitDialog:n,date:s,selectedCustomer:i,selectedCompany:r,customerFilteredOptions:p,companyFilteredOptions:m,goodsFilteredOptions:v,customerUseInput:g,companyUseInput:b,rows:_,columns:w,addRow:X,deleteRow:J,onRowChange:N,onCustomerFilter:q,onCompanyFilter:x,onGoodsFilter:V,onGoodsSelected:T,onGoodsCleared:G,onGoodsModelUpdate:W,onQuantityChange:O,onCustomerSelected:M,onCustomerCleared:B,onCustomerPopupShow:E,onCompanySelected:j,onCompanyCleared:z,onCompanyPopupShow:H,supertotal:y,totalWeight:f,canSubmit:Z,tryOpenSubmitDialog:te,submitData:ae,formatNumber:se,customerError:oe,goToPrintPage:D}}};var N=t(2807),D=t(7716),W=t(3316),T=t(4189),G=t(6384),O=t(4940),E=t(492),M=t(124),B=t(5173),H=t(9270),j=t(1356),z=t(8462),X=t(6653),J=t(4488),Y=t(7722),Z=t(5262),ee=t(7410),oe=t(386),te=t(6868),ae=t(2156),le=t(3952),ne=t(2669),se=t(8672),ie=t(8582),re=t.n(ie);const de=(0,N.A)(K,[["render",V]]),ue=de;re()(K,"components",{QPage:D.A,QCard:W.A,QCardSection:T.A,QBtn:G.A,QSelect:O.A,QIcon:E.A,QItem:M.A,QItemSection:B.A,QInput:H.A,QPopupProxy:j.A,QDate:z.A,QTable:X.A,QTr:J.A,QTh:Y.A,QTd:Z.A,QTooltip:ee.A,QSeparator:oe.A,QBanner:te.A,QDialog:ae.A,QAvatar:le.A,QCardActions:ne.A}),re()(K,"directives",{ClosePopup:se.A})}}]);