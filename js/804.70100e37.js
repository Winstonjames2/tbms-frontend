"use strict";(globalThis["webpackChunktbls"]=globalThis["webpackChunktbls"]||[]).push([[804],{3804:(e,t,a)=>{a.r(t),a.d(t,{default:()=>S});var o=a(1758),s=a(2901);const n={class:"q-mt-sm dashboard-container"},r={class:"left-column"},c={class:"text-h6"},l={class:"q-gutter-x-sm q-ml-auto"},i={class:"text-h6"},d={class:"q-gutter-x-sm q-ml-auto"},u={class:"row justify-between q-ma-sm full-width",style:{gap:"12px"}},_={class:"text-h6 q-mb-xs"},g={class:"row justify-end q-pa-sm",style:{width:"100%",gap:"15px"}},m={class:"right-column"};function p(e,t,a,p,b,h){const f=(0,o.g2)("q-icon"),k=(0,o.g2)("q-tooltip"),y=(0,o.g2)("q-btn"),v=(0,o.g2)("q-card-section"),w=(0,o.g2)("q-separator"),x=(0,o.g2)("q-item-section"),A=(0,o.g2)("q-badge"),F=(0,o.g2)("q-item"),q=(0,o.g2)("q-list"),C=(0,o.g2)("q-card"),P=(0,o.g2)("q-table"),D=(0,o.g2)("q-td"),T=(0,o.g2)("q-dialog"),L=(0,o.g2)("UserManagement"),Q=(0,o.gN)("close-popup");return(0,o.uX)(),(0,o.CE)("div",n,[(0,o.Lk)("div",r,[(0,o.bF)(C,{class:"glass-card custom-scrollbar-color"},{default:(0,o.k6)((()=>[(0,o.bF)(v,{class:"card-header q-pa-sm"},{default:(0,o.k6)((()=>[(0,o.bF)(f,{name:"sym_r_local_shipping",class:"header-icon"}),(0,o.Lk)("div",c,(0,s.v_)(e.$t("dashboard.recent_truck_dispatch")),1),(0,o.Lk)("div",l,[(0,o.bF)(y,{flat:"",icon:"sym_r_arrow_outward",class:"text-primary q-pa-xs q-ma-none",size:"md",onClick:p.openTruckDispatchPage},{default:(0,o.k6)((()=>[(0,o.bF)(k,(0,s._B)((0,o.Ng)(p.tooltip)),{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(e.$t("dashboard.redirect_to_dispatch_page")),1)])),_:1},16)])),_:1},8,["onClick"])])])),_:1}),(0,o.bF)(w,{dark:""}),(0,o.bF)(v,{class:"scrollable-list"},{default:(0,o.k6)((()=>[(0,o.bF)(q,{separator:""},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(p.transports,(t=>((0,o.uX)(),(0,o.Wv)(F,{key:t.id},{default:(0,o.k6)((()=>[(0,o.bF)(x,{class:"list-item"},{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(t.code),1)])),_:2},1024),(0,o.bF)(x,{class:"list-item"},{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(t.dispatch_date),1)])),_:2},1024),(0,o.bF)(x,{class:"list-item"},{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(t.truck),1)])),_:2},1024),(0,o.bF)(x,null,{default:(0,o.k6)((()=>[(0,o.bF)(A,{color:p.getStatusColor(t.dispatch_status)},{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(e.$t(t.dispatch_status)),1)])),_:2},1032,["color"])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1}),(0,o.bF)(C,{class:"glass-card custom-scrollbar-color"},{default:(0,o.k6)((()=>[(0,o.bF)(v,{class:"card-header q-pa-sm"},{default:(0,o.k6)((()=>[(0,o.bF)(f,{name:"sym_r_history",class:"header-icon"}),(0,o.Lk)("div",i,(0,s.v_)(e.$t("dashboard.recent_actions")),1),(0,o.Lk)("div",d,[(0,o.bF)(y,{flat:"",icon:"sym_r_open_in_full",class:"text-primary q-pa-xs q-ma-none",size:"sm",onClick:t[0]||(t[0]=e=>p.expandActionDialog=!0)},{default:(0,o.k6)((()=>[(0,o.bF)(k,(0,s._B)((0,o.Ng)(p.tooltip)),{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(e.$t("index.expand_more")),1)])),_:1},16)])),_:1})])])),_:1}),(0,o.bF)(w),(0,o.bF)(v,{class:"recent-actions-table"},{default:(0,o.k6)((()=>[(0,o.bF)(P,{flat:"",dense:"",rows:p.recentActions,columns:p.columns,"row-key":"id","hide-bottom":"",pagination:{rowsPerPage:25},class:"custom-scrollbar-color",style:{"background-color":"transparent",overflow:"hidden"}},null,8,["rows","columns"])])),_:1})])),_:1}),(0,o.bF)(T,{modelValue:p.expandActionDialog,"onUpdate:modelValue":t[3]||(t[3]=e=>p.expandActionDialog=e),persistent:""},{default:(0,o.k6)((()=>[(0,o.bF)(C,{style:{width:"90vw",height:"90vh"},class:"q-pa-sm custom-scrollbar-color"},{default:(0,o.k6)((()=>[(0,o.bF)(v,{class:"q-pa-none",style:{height:"100%",display:"flex","flex-direction":"column"}},{default:(0,o.k6)((()=>[(0,o.bF)(P,{flat:"",bordered:"false",rows:p.recentActions,columns:p.dialogColumns,"row-key":"id",pagination:{rowsPerPage:25},"hide-bottom":"",dense:"",style:{flex:"1 1 auto","min-height":"0",overflow:"auto"}},{top:(0,o.k6)((()=>[(0,o.Lk)("div",u,[(0,o.Lk)("div",_,(0,s.v_)(e.$t("dashboard.recent_action.all_recent_actions")),1),(0,o.bo)(((0,o.uX)(),(0,o.Wv)(y,{flat:"",dense:"",round:"",icon:"sym_r_close","aria-label":"Close",color:"primary"},{default:(0,o.k6)((()=>[(0,o.bF)(k,(0,s._B)((0,o.Ng)(p.tooltip)),{default:(0,o.k6)((()=>[(0,o.eW)((0,s.v_)(e.$t("index.close")),1)])),_:1},16)])),_:1})),[[Q]])])])),"body-cell-detail":(0,o.k6)((e=>[(0,o.bF)(D,{align:"center"},{default:(0,o.k6)((()=>[(0,o.bF)(y,{flat:"",dense:"",round:"",color:"primary",icon:"sym_r_arrow_outward",onClick:t=>p.redirectToItem(e.row)},null,8,["onClick"])])),_:2},1024)])),_:1},8,["rows","columns"]),(0,o.Lk)("div",g,[(0,o.bF)(y,{dense:"",flat:"",round:"",disable:!p.actionPreviousPage,color:p.actionPreviousPage?"primary":"grey-5",icon:"sym_r_chevron_left",onClick:t[1]||(t[1]=e=>p.getActionData(p.actionPreviousPage)),"aria-label":"Previous"},null,8,["disable","color"]),(0,o.bF)(y,{dense:"",flat:"",round:"",disable:!p.actionNextPage,icon:"sym_r_chevron_right",color:p.actionNextPage?"primary":"grey-5",onClick:t[2]||(t[2]=e=>p.getActionData(p.actionNextPage)),"aria-label":"Next"},null,8,["disable","color"])])])),_:1})])),_:1})])),_:1},8,["modelValue"])]),(0,o.Lk)("div",m,[(0,o.bF)(L,{users:p.staffUsers,"total-count":p.userCount,onReloadUser:p.getUserData},null,8,["users","total-count","onReloadUser"])])])}var b=a(1271),h=a(4907),f=a(2261),k=a(555),y=a(3537),v=a(455);const w={name:"ViewDashboard",components:{UserManagement:(0,o.$V)((()=>Promise.all([a.e(121),a.e(317)]).then(a.bind(a,8317))))},setup(){const e=(0,v.rd)(),t=(0,k.KR)([]),a=(0,k.KR)(0),s=(0,k.KR)([]),n=(0,k.KR)(null),r=(0,k.KR)(null),c=(0,k.KR)([]),l=(0,k.KR)(!1),{t:i}=(0,y.s9)(),d=(0,h.A)(),u={class:"bg-blue text-white shadow-4",offset:[10,10],contentStyle:"font-size: 12px"},_=e=>{const t={"truckdispatch.status_in_transit":"orange","truckdispatch.status_completed":"green","truckdispatch.status_cancelled":"red","truckdispatch.status_pending":"red"};return t[e]||"grey-8"},g=[{name:"action_time",label:i("dashboard.recent_action.time"),field:"action_time",align:"center",sortable:!0,format:(e,t)=>L(e??t.action_time)},{name:"content_type",label:i("dashboard.recent_action.content_type"),field:"content_type",align:"left",sortable:!0,format:(e,t)=>P(e??t.content_type)},{name:"object_code",label:i("dashboard.recent_action.object_code"),field:"object_code",align:"left",sortable:!0,format:(e,t)=>e||t.object_id},{name:"action_type",label:i("dashboard.recent_action.action_type"),field:"action_type",align:"left",sortable:!0,format:(e,t)=>T(e??t.action_type)},{name:"creator",label:i("dashboard.recent_action.user"),field:"creator",align:"right"}],m=[...g,{name:"detail",label:i("dashboard.recent_action.go_to_detail"),field:"detail",align:"center"}],p=t=>{const a=t.content_type.charAt(0).toUpperCase()+t.content_type.slice(1)+"List",o=t.content_type.charAt(0).toUpperCase()+t.content_type.slice(1);e.push({name:a,params:{id:t.object_id}}),b.A.set("pending_link_change",o)},w=()=>{e.push({name:"TruckDispatchList"}),b.A.set("pending_link_change","TruckDispatch")},x=async(t=null)=>{const a=await(0,f.getauth)(t||"dashboard/actions?page=1");if(a.code)return d.notify({message:i("error.fetch"),color:"negative"}),void e.push({name:"web_index"});s.value=a.results||[],n.value=a.next,r.value=a.previous,t&&d.notify({message:i("successful.fetch"),color:"positive"}),console.log(a)},A=async()=>{const t=await(0,f.getauth)("truckdispatch?page=1");if(await x(),await F(),t.code)return d.notify({message:i("error.fetch"),color:"negative"}),void e.push({name:"web_index"});d.notify({message:i("successful.fetch"),color:"positive"}),c.value=t.results||[],console.log(t)},F=async()=>{const e=await(0,f.getauth)("dashboard/userlist");t.value=e.results||[],a.value=e.count||t.value.length},q=()=>{},C={userprofile:i("dashboard.recent_action.model.userprofile"),truckdispatch:i("dashboard.recent_action.model.truckdispatch"),truck:i("dashboard.recent_action.model.truck"),customer:i("dashboard.recent_action.model.customer"),company:i("dashboard.recent_action.model.company"),goods:i("dashboard.recent_action.model.goods"),goodstype:i("dashboard.recent_action.model.goodstype"),receivegoods:i("dashboard.recent_action.model.receivegoods"),consignment:i("dashboard.recent_action.model.consignment")};function P(e){try{return C[e]||e}catch(t){return e||i("error.unknown")}}const D={CREATE:i("dashboard.recent_action.create"),UPDATE:i("dashboard.recent_action.update"),DELETE:i("dashboard.recent_action.delete"),Create:i("dashboard.recent_action.create"),Update:i("dashboard.recent_action.update"),Delete:i("dashboard.recent_action.delete")};function T(e){try{return D[e]||e}catch(t){return e||i("error.unknown")}}function L(e){if(!e)return"";const t=new Date(e);if(isNaN(t))return"";const a={day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"};return t.toLocaleString(void 0,a)}return(0,o.sV)((()=>{q(),A()})),{staffUsers:t,normalizeDateTime:L,userCount:a,getStatusColor:_,recentActions:s,transports:c,expandActionDialog:l,redirectToItem:p,openTruckDispatchPage:w,columns:g,dialogColumns:m,tooltip:u,getUserData:F,actionPreviousPage:r,actionNextPage:n,getActionData:x}}};var x=a(2807),A=a(3316),F=a(4189),q=a(492),C=a(6384),P=a(7410),D=a(386),T=a(3999),L=a(124),Q=a(5173),U=a(3954),N=a(6653),R=a(2156),W=a(5262),E=a(8672),K=a(8582),$=a.n(K);const j=(0,x.A)(w,[["render",p]]),S=j;$()(w,"components",{QCard:A.A,QCardSection:F.A,QIcon:q.A,QBtn:C.A,QTooltip:P.A,QSeparator:D.A,QList:T.A,QItem:L.A,QItemSection:Q.A,QBadge:U.A,QTable:N.A,QDialog:R.A,QTd:W.A}),$()(w,"directives",{ClosePopup:E.A})}}]);