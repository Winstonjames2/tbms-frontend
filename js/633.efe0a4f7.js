"use strict";(globalThis["webpackChunktbls"]=globalThis["webpackChunktbls"]||[]).push([[633],{1633:(e,a,l)=>{l.r(a),l.d(a,{default:()=>Q});var t=l(1758),i=l(2901),o=l(6683);const s={class:"row items-center"},r={class:"row items-center q-gutter-x-sm"},n={class:"text-subtitle2"},d={class:"float-right q-ma-sm row items-center"},u={class:"text-caption q-mr-sm"},m={class:"text-caption q-mr-sm"},c={class:"row justify-end q-mt-md"},g={class:"row justify-end q-mt-md"};function p(e,a,l,p,b,v){const f=(0,t.g2)("q-icon"),_=(0,t.g2)("q-card-section"),h=(0,t.g2)("q-separator"),w=(0,t.g2)("q-input"),k=(0,t.g2)("q-tooltip"),y=(0,t.g2)("q-btn"),F=(0,t.g2)("q-td"),q=(0,t.g2)("q-table"),U=(0,t.g2)("q-select"),V=(0,t.g2)("q-form"),C=(0,t.g2)("q-card"),x=(0,t.g2)("q-dialog"),A=(0,t.g2)("q-card-actions");return(0,t.uX)(),(0,t.Wv)(C,{class:"glass-card user-management-card custom-scrollbar-color"},{default:(0,t.k6)((()=>[(0,t.bF)(_,{class:"card-header row items-center justify-between"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",s,[(0,t.bF)(f,{name:"sym_r_people",class:"header-icon q-mr-sm"}),a[12]||(a[12]=(0,t.Lk)("div",{class:"text-h6"},"User Management",-1))]),a[13]||(a[13]=(0,t.Lk)("div",{class:"text-caption text-grey-7"}," Manage users: add, edit, view accounts for the system. ",-1))])),_:1}),(0,t.bF)(h,{dark:""}),(0,t.bF)(_,{class:"row"},{default:(0,t.k6)((()=>[(0,t.bF)(w,{dense:"",outlined:"",clearable:"",debounce:"100",modelValue:p.searchQuery,"onUpdate:modelValue":a[0]||(a[0]=e=>p.searchQuery=e),placeholder:"Search by name or email",style:{width:"80%","max-width":"400px"}},{prepend:(0,t.k6)((()=>[(0,t.bF)(f,{name:"sym_r_search"})])),_:1},8,["modelValue"]),(0,t.bF)(y,{dense:"",class:"q-px-sm q-mx-sm",color:"primary",icon:"sym_r_person_add",onClick:p.openAddDialog},{default:(0,t.k6)((()=>[(0,t.bF)(k,(0,i._B)((0,t.Ng)(p.tooltip)),{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(e.$t("dashboard.user_management.add_user")),1)])),_:1},16)])),_:1},8,["onClick"])])),_:1}),(0,t.bF)(_,{class:"table-wrapper custom-scrollbar-color"},{default:(0,t.k6)((()=>[(0,t.bF)(q,{flat:"","hide-bottom":"","row-key":"id",class:"scrollable-table",style:{"background-color":"transparent"},columns:p.columns,rows:p.paginatedUsers,pagination:p.pagination},{"body-cell-email":(0,t.k6)((e=>[(0,t.bF)(F,{align:"left"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",r,[(0,t.Lk)("div",n,(0,i.v_)(p.isRevealed(e.row.id)?e.row.email:p.maskEmail(e.row.email)),1),(0,t.bF)(y,{dense:"",flat:"",round:"",size:"sm",icon:p.isRevealed(e.row.id)?"sym_r_visibility_off":"sym_r_visibility",onClick:(0,o.D$)((a=>p.toggleReveal(e.row.id)),["stop"]),title:p.isRevealed(e.row.id)?"Hide email":"Reveal email"},null,8,["icon","onClick","title"])])])),_:2},1024)])),"body-cell-actions":(0,t.k6)((e=>[(0,t.bF)(F,{align:"center"},{default:(0,t.k6)((()=>[(0,t.bF)(y,{flat:"",dense:"",round:"",color:"primary",icon:"sym_r_edit",onClick:a=>p.openEditDialog(e.row),title:"Edit user"},null,8,["onClick"])])),_:2},1024)])),_:1},8,["columns","rows","pagination"]),(0,t.Lk)("div",d,[(0,t.Lk)("div",u," Page "+(0,i.v_)(p.pagination.page)+" / "+(0,i.v_)(p.totalPages),1),(0,t.Lk)("div",m,"Total "+(0,i.v_)(l.totalCount),1),(0,t.bF)(y,{dense:"",color:"primary",rounded:"",icon:"sym_r_keyboard_arrow_left",class:"q-mr-sm",disable:!p.hasPrevPage||p.loadingPage,onClick:p.goPrev},{default:(0,t.k6)((()=>[(0,t.bF)(k,(0,i._B)((0,t.Ng)(p.tooltip)),{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(e.$t("dashboard.user_management.previous_page")),1)])),_:1},16)])),_:1},8,["disable","onClick"]),(0,t.bF)(y,{dense:"",color:"primary",rounded:"",icon:"sym_r_keyboard_arrow_right",class:"q-ml-sm",disable:!p.hasNextPage||p.loadingPage,onClick:p.goNext},{default:(0,t.k6)((()=>[(0,t.bF)(k,(0,i._B)((0,t.Ng)(p.tooltip)),{default:(0,t.k6)((()=>[(0,t.eW)((0,i.v_)(e.$t("dashboard.user_management.next_page")),1)])),_:1},16)])),_:1},8,["disable","onClick"])])])),_:1}),(0,t.bF)(x,{modelValue:p.showAddDialog,"onUpdate:modelValue":a[5]||(a[5]=e=>p.showAddDialog=e),persistent:""},{default:(0,t.k6)((()=>[(0,t.bF)(C,{style:{"min-width":"420px","max-width":"90vw"}},{default:(0,t.k6)((()=>[(0,t.bF)(_,{class:"bg-primary text-white"},{default:(0,t.k6)((()=>a[14]||(a[14]=[(0,t.Lk)("div",{class:"text-h6"},"User Registration Form",-1)]))),_:1}),(0,t.bF)(_,{class:"form-wrapper"},{default:(0,t.k6)((()=>[(0,t.bF)(V,{ref:"addFormRef",onSubmit:(0,o.D$)(p.handleAddUser,["prevent"])},{default:(0,t.k6)((()=>[(0,t.bF)(w,{modelValue:p.newUser.first_name,"onUpdate:modelValue":a[1]||(a[1]=e=>p.newUser.first_name=e),label:"Display Name",outlined:"",dense:"",autofocus:"",rules:[p.rules.required,p.rules.minName],"lazy-rules":""},null,8,["modelValue","rules"]),(0,t.bF)(w,{modelValue:p.newUser.email,"onUpdate:modelValue":a[2]||(a[2]=e=>p.newUser.email=e),label:"Email",outlined:"",dense:"",rules:[p.rules.required,p.rules.email],"lazy-rules":""},null,8,["modelValue","rules"]),(0,t.bF)(U,{modelValue:p.newUser.role,"onUpdate:modelValue":a[3]||(a[3]=e=>p.newUser.role=e),label:"Role",outlined:"",dense:"",options:p.roleOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",rules:[p.rules.required],"lazy-rules":""},null,8,["modelValue","options","rules"]),(0,t.bF)(w,{modelValue:p.newUser.password,"onUpdate:modelValue":a[4]||(a[4]=e=>p.newUser.password=e),type:"password",label:"Password",outlined:"",dense:"",autocomplete:"new-password",rules:[p.rules.required,p.rules.password],"lazy-rules":"",hint:e.$t("auth.password_hint")},null,8,["modelValue","rules","hint"]),(0,t.Lk)("div",c,[(0,t.bF)(y,{flat:"",label:"Cancel",onClick:p.closeAddDialog},null,8,["onClick"]),(0,t.bF)(y,{loading:p.addLoading,disable:p.addLoading,label:"Add",class:"bg-primary text-white q-ml-sm",onClick:p.submitAddForm},null,8,["loading","disable","onClick"])])])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.bF)(x,{modelValue:p.showEditDialog,"onUpdate:modelValue":a[9]||(a[9]=e=>p.showEditDialog=e),persistent:""},{default:(0,t.k6)((()=>[(0,t.bF)(C,{style:{"min-width":"420px","max-width":"90vw"}},{default:(0,t.k6)((()=>[(0,t.bF)(_,{class:"bg-primary text-white"},{default:(0,t.k6)((()=>a[15]||(a[15]=[(0,t.Lk)("div",{class:"text-h6"},"Edit User",-1)]))),_:1}),(0,t.bF)(_,{class:"form-wrapper"},{default:(0,t.k6)((()=>[(0,t.bF)(V,{ref:"editFormRef",onSubmit:(0,o.D$)(p.handleEditUser,["prevent"])},{default:(0,t.k6)((()=>[(0,t.bF)(w,{modelValue:p.editUser.first_name,"onUpdate:modelValue":a[6]||(a[6]=e=>p.editUser.first_name=e),label:"Display Name",outlined:"",dense:"",rules:[p.rules.required,p.rules.minName]},null,8,["modelValue","rules"]),(0,t.bF)(w,{modelValue:p.editUser.email,"onUpdate:modelValue":a[7]||(a[7]=e=>p.editUser.email=e),label:"Email",outlined:"",dense:"",rules:[p.rules.required,p.rules.email]},null,8,["modelValue","rules"]),(0,t.bF)(U,{modelValue:p.editUser.role,"onUpdate:modelValue":a[8]||(a[8]=e=>p.editUser.role=e),label:"Role",outlined:"",dense:"",options:p.roleOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",rules:[p.rules.required]},null,8,["modelValue","options","rules"]),(0,t.Lk)("div",g,[(0,t.bF)(y,{flat:"",label:"Cancel",onClick:p.closeEditDialog},null,8,["onClick"]),(0,t.bF)(y,{loading:p.editLoading,disable:p.editLoading,label:"Save",class:"bg-primary text-white q-ml-sm",onClick:p.submitEditForm},null,8,["loading","disable","onClick"])])])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.bF)(x,{modelValue:p.showNoChangesDialog,"onUpdate:modelValue":a[11]||(a[11]=e=>p.showNoChangesDialog=e)},{default:(0,t.k6)((()=>[(0,t.bF)(C,{style:{"min-width":"300px"}},{default:(0,t.k6)((()=>[(0,t.bF)(_,null,{default:(0,t.k6)((()=>a[16]||(a[16]=[(0,t.Lk)("div",{class:"text-h6"},"No changes detected",-1),(0,t.Lk)("div",{class:"text-body2 q-mt-sm"}," You didn't change any fields. Nothing to save. ",-1)]))),_:1}),(0,t.bF)(A,{align:"right"},{default:(0,t.k6)((()=>[(0,t.bF)(y,{flat:"",label:"OK",color:"primary",onClick:a[10]||(a[10]=e=>p.showNoChangesDialog=!1)})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}l(310),l(5962),l(7225),l(8743),l(2858),l(2071),l(5520),l(2775),l(6203);var b=l(555),v=l(4907),f=l(2261),_=l(3537);const h={name:"UserManagement",props:{users:{type:Array,required:!0},totalCount:{type:Number,required:!0}},emits:["reload-user"],setup(e,{emit:a}){const l=(0,v.A)(),{t:i}=(0,_.s9)(),o=(0,b.KR)(""),s=(0,b.KR)(!1),r=(0,b.KR)(!1),n=(0,b.KR)(!1),d=(0,b.KR)(null),u=(0,b.KR)(null),m=(0,b.KR)(!1),c=(0,b.KR)(!1),g=(0,b.KR)(!1),p=25,h=(0,b.KR)({page:1,rowsPerPage:p}),w=(0,b.KR)(new Set),k=(0,b.KR)({first_name:"",email:"",password:"",role:null}),y=(0,b.KR)({}),F=(0,b.KR)(null),q=[{label:"Staff",value:"staff"},{label:"User",value:"user"}],U={required:e=>null!==e&&void 0!==e&&String(e).trim().length>0||i("auth.required"),minName:e=>!e||String(e).trim().length>=4||i("auth.min4"),email:e=>{if(!e)return i("auth.email_required");const a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return a.test(e)||i("auth.invalid_email_rule")},password:e=>{if(!e)return i("auth.password_required");const a=/^(?=.*[A-Za-z])(?=.*\d).{8,}$/;return a.test(e)||i("auth.password_rule")}},V=(0,t.EW)((()=>{const a=(o.value||"").toLowerCase().trim();return a?(e.users||[]).filter((e=>String(e.first_name||"").toLowerCase().includes(a)||String(e.email||"").toLowerCase().includes(a))):e.users||[]})),C=(0,t.EW)((()=>{const e=(h.value.page-1)*h.value.rowsPerPage;return V.value.slice(e,e+h.value.rowsPerPage)})),x=(0,t.EW)((()=>{const a=Number(e.totalCount||0);return Math.max(1,Math.ceil(a/p))})),A={class:"bg-blue text-white shadow-4",offset:[10,10],contentStyle:"font-size: 12px"},S=(0,t.EW)((()=>h.value.page<x.value)),R=(0,t.EW)((()=>h.value.page>1));function D(e){if(!e)return"";const a=String(e).split("@");if(2!==a.length)return"***";const[l,t]=a;if(!l)return`***@${t}`;const i=l.charAt(0);return`${i}***@${t}`}function E(e){return w.value.has(e)}function L(e){w.value.has(e)?w.value.delete(e):w.value.add(e),w.value=new Set(w.value)}function N(){k.value={first_name:"",email:"",password:"",role:null},d.value&&d.value.resetValidation&&d.value.resetValidation()}function P(){S.value&&h.value.page++}function Q(){R.value&&h.value.page--}function K(){N(),s.value=!0,(0,t.dY)((()=>d.value&&d.value.resetValidation&&d.value.resetValidation()))}function $(){s.value=!1}function W(e){y.value={id:e.id,first_name:e.first_name??"",email:e.email??"",role:e.role??null},F.value={...y.value},r.value=!0,(0,t.dY)((()=>u.value&&u.value.resetValidation&&u.value.resetValidation()))}function z(){r.value=!1}function B(){return!!F.value&&(String(F.value.first_name||"").trim()===String(y.value.first_name||"").trim()&&String(F.value.email||"").trim()===String(y.value.email||"").trim()&&String(F.value.role||"")===String(y.value.role||""))}async function T(){const e=!d.value||await d.value.validate();e?M():l.notify({message:i("warning.fix_validation"),color:"negative"})}async function M(){m.value=!0;try{const e={first_name:String(k.value.first_name||"").trim(),email:String(k.value.email||"").trim(),password:k.value.password,role:k.value.role},t=await(0,f.postauth)("/dashboard/userlist/",e);if("200"!==t.code)return l.notify({message:i("dashboard.user_management.failed_user_add"),color:"negative"}),void(m.value=!1);const o=t&&t.data&&t.data.data||t&&t.data||t;a("reload-user",o),l.notify({message:i("dashboard.user_management.success_user_add"),color:"positive"}),$(),N()}catch(e){l.notify({message:i("dashboard.user_management.failed_user_add"),color:"negative"})}finally{m.value=!1}}async function I(){const e=!u.value||await u.value.validate();e?B()?l.notify({message:i("warning.no_changes"),color:"warning"}):O():l.notify({message:i("warning.fix_validation"),color:"warning"})}async function O(){c.value=!0;try{const e=y.value,t={first_name:String(e.first_name||"").trim(),email:String(e.email||"").trim(),role:e.role},o=await(0,f.patchauth)(`/dashboard/userlist/${e.id}/`,t);if("200"!==o.code)return l.notify({message:i("dashboard.user_management.failed_user_update"),color:"negative"}),void(c.value=!1);a("reload-user",{id:e.id,...t}),l.notify({color:"positive",message:i("dashboard.user_management.success_user_update")}),z()}catch(e){l.notify({message:i("dashboard.user_management.failed_user_update"),color:"negative"})}finally{c.value=!1}}(0,t.wB)(o,(()=>{h.value.page=1}));const j=[{name:"id",label:"ID",field:"id",align:"left",sortable:!0},{name:"first_name",label:"Display Name",field:"first_name",align:"left",sortable:!0},{name:"email",label:"Email",align:"left",field:"email"},{name:"role",label:"Role",field:e=>e.role?String(e.role).charAt(0).toUpperCase()+String(e.role).slice(1):"",align:"left",sortable:!0},{name:"actions",label:"Actions",align:"center"}];return(0,t.wB)((()=>e.totalCount),(()=>{h.value.page>x.value&&(h.value.page=x.value)})),{searchQuery:o,showAddDialog:s,showEditDialog:r,showNoChangesDialog:n,addFormRef:d,editFormRef:u,addLoading:m,editLoading:c,loadingPage:g,newUser:k,editUser:y,roleOptions:q,columns:j,pagination:h,paginatedUsers:C,totalPages:x,hasNextPage:S,hasPrevPage:R,rules:U,maskEmail:D,isRevealed:E,toggleReveal:L,openAddDialog:K,closeAddDialog:$,openEditDialog:W,closeEditDialog:z,submitAddForm:T,submitEditForm:I,goNext:P,goPrev:Q,handleAddUser:M,handleEditUser:O,tooltip:A}}};var w=l(2807),k=l(3316),y=l(4189),F=l(492),q=l(386),U=l(9270),V=l(6384),C=l(7410),x=l(6653),A=l(5262),S=l(2156),R=l(9200),D=l(4940),E=l(2669),L=l(8582),N=l.n(L);const P=(0,w.A)(h,[["render",p],["__scopeId","data-v-69314f12"]]),Q=P;N()(h,"components",{QCard:k.A,QCardSection:y.A,QIcon:F.A,QSeparator:q.A,QInput:U.A,QBtn:V.A,QTooltip:C.A,QTable:x.A,QTd:A.A,QDialog:S.A,QForm:R.A,QSelect:D.A,QCardActions:E.A})}}]);