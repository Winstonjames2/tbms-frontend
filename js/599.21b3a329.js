"use strict";(globalThis["webpackChunktbls"]=globalThis["webpackChunktbls"]||[]).push([[599],{6758:(e,t,a)=>{a.r(t),a.d(t,{default:()=>q});a(310),a(5962);var l=a(1758),r=a(6683),o=a(2901);const i={class:"q-mt-md"},n={class:"q-pa-sm flex flex-center"},c={class:"q-pa-sm flex flex-center"};function u(e,t,a,u,s,d){const p=(0,l.g2)("q-tooltip"),v=(0,l.g2)("q-btn"),h=(0,l.g2)("q-btn-group"),k=(0,l.g2)("q-space"),m=(0,l.g2)("q-icon"),_=(0,l.g2)("q-input"),f=(0,l.g2)("q-td"),b=(0,l.g2)("EditableCell"),g=(0,l.g2)("q-tr"),y=(0,l.g2)("q-table"),w=(0,l.g2)("q-pagination");return(0,l.uX)(),(0,l.CE)("div",i,[(0,l.bF)(r.eB,{appear:"","enter-active-class":"animated fadeIn"},{default:(0,l.k6)((()=>[(0,l.bF)(y,{separator:"cell",class:"my-sticky-header-column-table shadow-24",rows:u.tableList,"row-key":"id",loading:u.loading,filter:u.filter,columns:u.columns,"hide-bottom":"",pagination:u.pagination,"onUpdate:pagination":t[1]||(t[1]=e=>u.pagination=e),paginationModifiers:{sync:!0},"no-data-label":"No data","no-results-label":"No data you want",style:{height:"calc(100vh - 190px)"},flat:"",bordered:""},{top:(0,l.k6)((()=>[(0,l.bF)(h,{push:""},{default:(0,l.k6)((()=>[(0,l.bF)(v,{label:e.$t("refresh"),icon:"sym_r_refresh",onClick:u.reFresh},{default:(0,l.k6)((()=>[(0,l.bF)(p,(0,o._B)((0,l.Ng)(u.tooltip)),{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(e.$t("refreshtip")),1)])),_:1},16)])),_:1},8,["label","onClick"])])),_:1}),(0,l.bF)(k),(0,l.bF)(_,{outlined:"",rounded:"",dense:"",debounce:"600",color:"primary",modelValue:u.filter,"onUpdate:modelValue":t[0]||(t[0]=e=>u.filter=e),placeholder:e.$t("search"),onKeyup:(0,r.jR)(u.onFilterApply,["enter"]),onBlur:u.onFilterApply,onClear:u.onFilterClear,clearable:""},{append:(0,l.k6)((()=>[(0,l.bF)(m,{name:"sym_r_search",class:"search-icon-hover",onClick:u.onFilterApply},null,8,["onClick"])])),_:1},8,["modelValue","placeholder","onKeyup","onBlur","onClear"])])),body:(0,l.k6)((e=>[(0,l.bF)(g,{props:e},{default:(0,l.k6)((()=>[(0,l.bF)(f,{key:"code",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(e.row.code),1)])),_:2},1032,["props"]),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(u.editableColumns,(t=>((0,l.uX)(),(0,l.Wv)(b,{key:t.field,row:e.row,field:t.field,label:t.label,rules:t.rules,mask:t.mask,"edit-id":u.editId,"model-value":e.row.id===u.editId?u.editFormData[t.field]:e.row[t.field],translate:t.translate||!1,dateField:t.dateField||!1,options:t.options||[],"options-label":t.optionsLabel||"label","options-value":t.optionsValue||"value","onUpdate:modelValue":e=>u.editFormData[t.field]=e,props:e},null,8,["row","field","label","rules","mask","edit-id","model-value","translate","dateField","options","options-label","options-value","onUpdate:modelValue","props"])))),128)),(0,l.bF)(f,{key:"total_amount",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(e.row.total_amount),1)])),_:2},1032,["props"]),(0,l.bF)(f,{key:"total_weight",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(e.row.total_weight),1)])),_:2},1032,["props"]),(0,l.bF)(f,{key:"total_cost",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(e.row.total_cost),1)])),_:2},1032,["props"]),(0,l.bF)(f,{key:"creator",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(e.row.creator),1)])),_:2},1032,["props"]),(0,l.bF)(f,{key:"create_time",props:e},{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(e.row.create_time),1)])),_:2},1032,["props"]),(0,l.bF)(f,{key:"action",props:e,style:(0,o.Tr)([{width:"100px"},u.actionCellStyle(e)])},{default:(0,l.k6)((()=>[e.row.id!==u.editId?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:0},(0,l.pI)(u.rowActions,(t=>((0,l.uX)(),(0,l.Wv)(v,(0,l.v6)({key:t.icon,ref_for:!0},t,{onClick:a=>t.action(e.row)}),{default:(0,l.k6)((()=>[(0,l.bF)(p,(0,l.v6)({ref_for:!0},u.tooltip),{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(t.tip),1)])),_:2},1040)])),_:2},1040,["onClick"])))),128)):((0,l.uX)(!0),(0,l.CE)(l.FK,{key:1},(0,l.pI)(u.editActions,(e=>((0,l.uX)(),(0,l.Wv)(v,(0,l.v6)({key:e.icon,ref_for:!0},e,{onClick:e.action}),null,16,["onClick"])))),128))])),_:2},1032,["props","style"])])),_:2},1032,["props"])])),_:1},8,["rows","loading","filter","columns","pagination"])])),_:1}),(0,l.bo)((0,l.Lk)("div",n,[(0,l.bF)(w,{modelValue:u.current,"onUpdate:modelValue":[t[2]||(t[2]=e=>u.current=e),t[3]||(t[3]=e=>u.paginationIpt=e)],max:u.max,"max-pages":10,"boundary-links":"",color:"red-8",onVnodeUpdated:u.changePageEnter},null,8,["modelValue","max","onVnodeUpdated"]),(0,l.bF)(_,{modelValue:u.paginationIpt,"onUpdate:modelValue":t[4]||(t[4]=e=>u.paginationIpt=e),modelModifiers:{number:!0},outlined:"",round:"",dense:"",color:"red-8",onBlur:u.changePageEnter,onKeyup:(0,r.jR)(u.changePageEnter,["enter"]),style:{width:"50px"},class:"center"},null,8,["modelValue","onBlur","onKeyup"])],512),[[r.aG,u.max]]),(0,l.bo)((0,l.Lk)("div",c,[(0,l.bF)(v,{flat:"",push:"",color:"darkText",label:e.$t("no_data")},null,8,["label"])],512),[[r.aG,!u.max]])])}a(95),a(6724),a(9240);var s=a(2261),d=a(1271),p=a(4907),v=a(7144),h=a(555),k=a(3537),m=a(455),_=a(5971);const f={name:"PageInventoryList",components:{EditableCell:_.A},setup(){const{t:e}=(0,k.s9)(),t=(0,p.A)(),a=(0,m.rd)(),r="truckdispatch",o="truck",i="truckdriver",n=(0,h.KR)(!1),c=(0,h.KR)([]),u=(0,h.KR)([]),_={},f={},b=(0,h.KR)([]),g=(0,h.KR)(d.A.getItem("userRole")),y=(0,h.KR)(""),w=(0,h.KR)(0),A=(0,h.Kh)({}),F=(0,h.Kh)({}),C=(0,h.KR)(!1),K=(0,h.KR)(1),E=(0,h.KR)(25),I=(0,h.KR)(0),R=(0,l.EW)((()=>Math.ceil(I.value/E.value)||0)),x=(0,h.KR)(0),D=(0,h.KR)({page:1,rowsPerPage:E.value,rowsNumber:0}),V=(0,h.KR)(1),q="truckdispatch.status_pending",j="truckdispatch.status_in_transit",$="truckdispatch.status_completed",W=[{label:e(q),value:q},{label:e(j),value:j},{label:e($),value:$}],T=(0,h.KR)([]),N=e=>!!e&&/^\d{4}[-/]\d{2}[-/]\d{2}$/.test(e),P=e=>!!e&&Q.value.some((t=>t.id===e||t.truck_number===e)),S=e=>!!e&&W.some((t=>t.value===e||t.label===e)),L=(0,l.EW)((()=>N(A.dispatch_date)&&P(A.truck)&&S(A.dispatch_status))),O={class:"bg-blue text-white shadow-4",offset:[10,10],contentStyle:"font-size: 12px"},Q=(0,h.KR)(d.A.getItem(o)||[]),B=(0,h.KR)(d.A.getItem(i)||[]),U=(e,t)=>{const a=new Map;for(const t of e||[])t&&void 0!==t.id&&null!==t.id&&a.set(t.id,t);for(const e of t||[])e&&void 0!==e.id&&null!==e.id&&a.set(e.id,e);return Array.from(a.values())},X=e=>{const t=Number(e)||0;I.value=t,D.value.rowsNumber=t},M=(e,t)=>{_[e]=Array.isArray(t)?t:[],u.value=U(u.value,_[e])},z=(e,t)=>{f[e]=Array.isArray(t)?t:[]},G=e=>{const t=Number(e)||1;return le.value?f[t]||[]:_[t]||[]},H=e=>Array.isArray(_[e])&&_[e].length>0,J=e=>Array.isArray(f[e])&&f[e].length>0,Y=(e,t=!1)=>{const a=[`page=${e}`];return t&&y.value&&""!==String(y.value).trim()&&a.push(`search=${encodeURIComponent(y.value.trim())}`),`${r}/?${a.reverse().join("&")}`},Z={},ee=async(e,t)=>{if(Z[e])return Z[e];const a=(async()=>{try{return await t()}finally{delete Z[e]}})();return Z[e]=a,a},te=async(e=1,{force:t=!1}={})=>{const a=Number(e)||1;if(!t&&H(a))return c.value=G(a),D.value.page=a,K.value=a,void(V.value=a);n.value=!0;try{const e=Y(a,!1),t=await ee(e,(()=>(0,s.getauth)(e))),l=Array.isArray(t.results)?t.results:t.data||[];M(a,l),X(t.count),x.value=t.count||0,c.value=G(a),D.value.page=a,K.value=a,V.value=a}catch(e){console.error("fetchPage error:",e),c.value=[]}finally{n.value=!1}},ae=async(e=1,{force:t=!1}={})=>{const a=Number(e)||1;if(!t&&J(a))return b.value=f[a],c.value=b.value,D.value.page=a,K.value=a,void(V.value=a);n.value=!0;try{const e=Y(a,!0),t=await ee(e,(()=>(0,s.getauth)(e))),l=Array.isArray(t.results)?t.results:[];z(a,l),X(t.count),b.value=G(a),c.value=b.value,D.value.page=a,K.value=a,V.value=a}catch(e){console.error("fetchFilteredPage error:",e),b.value=[],c.value=[]}finally{n.value=!1}},le=(0,l.EW)((()=>y.value&&""!==String(y.value).trim())),re=async()=>{const e=String(y.value||"").trim();if(!e)return oe();await ae(1,{force:!0})},oe=async()=>{y.value="",b.value=[],H(K.value)?(c.value=G(K.value),X(x.value)):await te(1,{force:!1})},ie=async()=>{n.value=!0,await(0,v.e7)(o),Q.value=d.A.getItem(o)||[],B.value=d.A.getItem(i)||[],n.value=!1},ne=async()=>{n.value=!0;try{Object.keys(_).forEach((e=>delete _[e])),Object.keys(f).forEach((e=>delete f[e])),u.value=[],b.value=[],K.value=1,V.value=1,D.value.page=1,D.value.rowsNumber=0,I.value=0,Object.keys(Z).forEach((e=>delete Z[e])),await te(1,{force:!0}),await ie(),pe()}finally{n.value=!1}},ce=async()=>{let e=Number(V.value)||1;e<1?e=1:e>R.value&&(e=R.value||1),K.value=e,V.value=e,D.value.page=e,le.value?await ae(e):await te(e)},ue=async e=>{V.value=e,K.value=e,D.value.page=e,le.value?await ae(e):await te(e)},se=e=>{C.value=!0,w.value=e.id,A.dispatch_date=e.dispatch_date,A.truck="object"===typeof e.truck?e.truck.id:e.truck,A.truck_driver="object"===typeof e.truck_driver?e.truck_driver.value:e.truck_driver,A.dispatch_status=e.dispatch_status,F.dispatch_date=e.dispatch_date,F.truck="object"===typeof e.truck?e.truck.id:e.truck,F.dispatch_status=e.dispatch_status,F.truck_driver="object"===typeof e.truck_driver?e.truck_driver.value:e.truck_driver},de=async()=>{if(!L.value)return void t.notify({message:e("error.data_invalid"),icon:"sym_r_close",color:"negative"});const a=Object.fromEntries(Object.entries(A).filter((([e,t])=>t!==F[e])));if(console.log(a),!Object.keys(a).length)return t.notify({message:e("warning.no_changes"),color:"warning"});let l;try{if(t.loading.show(),l=await(0,s.patchauth)(`${r}/${w.value}/`,a),console.log(a),!l||"200"!==l.code&&200!==l.status)throw new Error;{const a=l.data||null;a&&void 0!==a.id&&(u.value=u.value.map((e=>e.id===a.id?a:e)),Object.keys(_).forEach((e=>{_[e]=_[e].map((e=>e.id===a.id?a:e))})),Object.keys(f).forEach((e=>{f[e]=f[e].map((e=>e.id===a.id?a:e))}))),await ne(),t.notify({message:e("successful.update"),color:"green"})}}catch{t.notify({message:l?.msg||e("error.update"),icon:"sym_r_close",color:"negative"})}finally{t.loading.hide()}},pe=()=>{C.value=!1,w.value=0,Object.keys(A).forEach((e=>delete A[e])),Object.keys(F).forEach((e=>delete F[e]))},ve=e=>{d.A.remove("TruckDispatchDetailData"),d.A.remove("EditDispatchDetail"),d.A.set("SelectedTruckDispatch",e),a.push({name:"TruckDispatchDetail"})},he=e=>{d.A.set("TruckDispatchCostData",e),a.push({name:"TruckDispatchCostBreakdown"})},ke=e=>C.value&&e.row.id===w.value?{backgroundColor:"#cbc6d2"}:{},me=[{round:!0,flat:!0,push:!0,color:"green",icon:"sym_r_check",action:de},{round:!0,flat:!0,push:!0,color:"red",icon:"sym_r_close",action:pe}],_e=[{round:!0,flat:!0,push:!0,color:"amber-2",icon:"sym_r_table_eye",tip:e("index.view_detail"),action:ve},{round:!0,flat:!0,push:!0,color:"amber-4",icon:"sym_r_edit",tip:e("edit"),action:se},{round:!0,flat:!0,push:!0,color:"amber-4",icon:"sym_r_mintmark",tip:e("truckdispatch.view_cost_breakdown"),action:he}],fe={required:t=>!!t||e("error.input.enterValue"),integer:t=>void 0!==t&&null!==t&&Number(t)>0||e("error.input.error2")},be=(0,h.Kh)([{field:"dispatch_date",label:e("truckdispatch.view_truckdispatch.dispatch_date"),rules:[fe.required],dateField:!0},{field:"truck",label:e("truckdispatch.view_truckdispatch.truck"),rules:[fe.required],truncate:!1,translate:!1,options:Q.value,optionsLabel:"truck_number",optionsValue:"id"},{field:"dispatch_status",label:e("truckdispatch.view_truckdispatch.status"),rules:[fe.required],translate:!0,options:W},{field:"truck_driver",label:e("truckdispatch.view_truckdispatch.truck_driver"),rules:[],truncate:!0,translate:!1,options:B.value,optionsLabel:"full_name",optionsValue:"id"}]),ge=t=>{const a=[{name:"code",label:e("truckdispatch.view_truckdispatch.code"),field:"code",align:"center",sortable:!0},{name:"dispatch_date",label:e("truckdispatch.view_truckdispatch.dispatch_date"),field:"dispatch_date",align:"left"},{name:"truck",label:e("truckdispatch.view_truckdispatch.truck"),field:"truck",align:"center"},{name:"dispatch_status",label:e("truckdispatch.view_truckdispatch.status"),field:"dispatch_status",align:"center"},{name:"truck_driver",label:e("truckdispatch.view_truckdispatch.truck_driver"),field:"truck_driver",align:"center"},{name:"total_amount",label:`${e("truckdispatch.view_truckdispatch.total_transported_gain")} (${e("ks")})`,field:"total_amount",align:"center"},{name:"total_weight",label:`${e("truckdispatch.view_truckdispatch.total_weight")} (${e("vs")})`,field:"total_weight",align:"center"}],l=[{name:"total_cost",label:`${e("truckdispatch.view_truckdispatch.truck_costbreakdown")} (${e("ks")})`,field:"total_cost",align:"center"},{name:"creator",label:e("truckdispatch.view_truckdispatch.creator"),field:"creator",align:"center"},{name:"create_time",label:e("truckdispatch.view_truckdispatch.create_time"),field:"create_time",align:"center"}],r={name:"action",label:e("action"),align:"left"};return[...a.map((e=>({...e,headerStyle:"font-weight: bold; font-size: 13px"}))),..."Admin"===t?l.map((e=>({...e,headerStyle:"font-weight: bold; font-size: 13px"}))):[],{...r,headerStyle:"font-weight: bold; font-size: 13px"}]},ye=(0,h.Kh)(ge(g.value)),we=(0,h.KR)(!1);return(0,l.sV)((()=>{we.value||(we.value=!0,ie(),Promise.all([(0,v.e7)(o)]).finally((()=>{te(1).catch((e=>console.error(e)))})))})),{pathname:r,loading:n,tableList:c,filter:y,pagination:D,editId:w,editFormData:A,editMode:C,current:K,max:R,paginationIpt:V,changePageEnter:ce,onFilterApply:re,onFilterClear:oe,reFresh:ne,editData:se,editDataSubmit:de,editDataCancel:pe,columns:ye,t:e,q:t,truckFilterOptions:T,truckList:Q,truckDriverList:B,viewDetail:ve,router:a,isEditFormValid:L,tooltip:O,actionCellStyle:ke,editActions:me,editableColumns:be,rowActions:_e,makeColumns:ge,allFetched:u,filterList:b,handlePaginationChange:ue}}};var b=a(2807),g=a(6653),y=a(6031),w=a(6384),A=a(7410),F=a(3676),C=a(9270),K=a(492),E=a(4488),I=a(5262),R=a(4700),x=a(8582),D=a.n(x);const V=(0,b.A)(f,[["render",u],["__scopeId","data-v-46dd4a5d"]]),q=V;D()(f,"components",{QTable:g.A,QBtnGroup:y.A,QBtn:w.A,QTooltip:A.A,QSpace:F.A,QInput:C.A,QIcon:K.A,QTr:E.A,QTd:I.A,QPagination:R.A})}}]);