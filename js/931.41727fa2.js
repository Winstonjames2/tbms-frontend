"use strict";(globalThis["webpackChunktbls"]=globalThis["webpackChunktbls"]||[]).push([[931],{4931:(e,t,o)=>{o.r(t),o.d(t,{default:()=>J});var l=o(1758),a=o(6683),i=o(2901);const n={class:"top-header"},r={class:"left-row"},s={class:"row items-center justify-end q-gutter-sm q-pa-sm"},c={class:"right-row"},d={key:0},u={key:1},p={class:"bottom-footer"},_={class:"footer-item"},m={class:"footer-item"},g={class:"footer-item"},k={class:"text-h6"},h={class:"q-mt-sm"},v={class:"text-h6"},f={class:"q-mt-sm"},b={class:"q-mt-sm"};function y(e,t,o,y,w,L){const q=(0,l.g2)("q-tooltip"),F=(0,l.g2)("q-btn"),C=(0,l.g2)("q-btn-group"),x=(0,l.g2)("q-select"),A=(0,l.g2)("q-date"),S=(0,l.g2)("q-popup-proxy"),W=(0,l.g2)("q-icon"),D=(0,l.g2)("q-input"),T=(0,l.g2)("q-chip"),$=(0,l.g2)("q-td"),N=(0,l.g2)("q-tr"),V=(0,l.g2)("q-table"),K=(0,l.g2)("q-card-section"),R=(0,l.g2)("q-card-actions"),z=(0,l.g2)("q-card"),Q=(0,l.g2)("q-dialog"),U=(0,l.gN)("close-popup");return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.bF)(a.eB,{appear:"","enter-active-class":"animated fadeIn"},{default:(0,l.k6)((()=>[(0,l.bF)(V,{class:"my-sticky-header-large-table shadow-24",separator:"cell",rows:y.tableList,"row-key":"id",loading:y.loading,columns:y.columns,pagination:y.pagination,"onUpdate:pagination":t[5]||(t[5]=e=>y.pagination=e),paginationModifiers:{sync:!0},"no-data-label":"No data","no-results-label":"No data you want",style:{height:"calc(100vh - 150px)","max-height":"calc(100vh - 150px)"},flat:"",bordered:"",dense:""},{top:(0,l.k6)((()=>[(0,l.Lk)("div",n,[(0,l.Lk)("div",r,[(0,l.bF)(C,{push:""},{default:(0,l.k6)((()=>[(0,l.bF)(F,{icon:"sym_r_refresh",label:e.$t("refresh"),onClick:y.reFresh},{default:(0,l.k6)((()=>[(0,l.bF)(q,(0,i._B)((0,l.Ng)(y.tooltip)),{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.$t("refreshtip")),1)])),_:1},16)])),_:1},8,["label","onClick"])])),_:1}),(0,l.bF)(x,{outlined:"",modelValue:y.truck,"onUpdate:modelValue":t[0]||(t[0]=e=>y.truck=e),"input-debounce":"200","use-input":"",dense:"",label:e.$t("dispatch_planning.check_list.truck"),"bg-color":"rgb(245,245,245)",options:y.truckFilteredOptions,onFilter:y.filterTruck,behavior:"menu",style:{width:"180px"},"option-label":"truck_number","option-value":"id","map-options":"","emit-value":""},null,8,["modelValue","label","options","onFilter"]),(0,l.bF)(x,{outlined:"",modelValue:y.truckDriver,"onUpdate:modelValue":t[1]||(t[1]=e=>y.truckDriver=e),"input-debounce":"100","use-input":y.truckDriverUseInput,dense:"",label:`${e.$t("dispatch_planning.check_list.truck_driver")} (${e.$t("optional")})`,"bg-color":"rgb(245,245,245)",options:y.truckDriverFilteredOptions,clearable:"",onFilter:y.filterTruckDriver,onPopupHide:y.onTruckDriverSelected,onPopupShow:y.onTruckDriverPopupShow,onClear:y.onTruckDriverCleared,behavior:"menu",style:{"max-width":"200px"},class:"truncate-cell","option-label":"full_name","option-value":"id","map-options":"","emit-value":""},null,8,["modelValue","use-input","label","options","onFilter","onPopupHide","onPopupShow","onClear"]),(0,l.bF)(D,{dense:"",mask:"date",modelValue:y.date,"onUpdate:modelValue":t[3]||(t[3]=e=>y.date=e),outlined:"",style:{width:"160px"}},{append:(0,l.k6)((()=>[(0,l.bF)(W,{name:"sym_r_event",color:"primary",class:"cursor-pointer"},{default:(0,l.k6)((()=>[(0,l.bF)(S,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,l.k6)((()=>[(0,l.bF)(A,{modelValue:y.date,"onUpdate:modelValue":t[2]||(t[2]=e=>y.date=e)},{default:(0,l.k6)((()=>[(0,l.Lk)("div",s,[(0,l.bo)((0,l.bF)(F,{flat:"",color:"primary",label:"Close"},null,512),[[U]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])]),(0,l.Lk)("div",c,[y.dispatchList.length?((0,l.uX)(),(0,l.Wv)(T,{key:0,dense:"",label:`${y.dispatchList.length} Locked`,flat:"","no-caps":"",style:{color:"#ff3a3a"}},null,8,["label"])):(0,l.Q3)("",!0),(0,l.bF)(F,{dense:"",label:y.tableCollapse?e.$t("expand"):e.$t("collapse"),icon:y.tableCollapse?"sym_r_expand":"sym_r_compress",color:y.tableCollapse?"green":"blue","no-caps":"",push:"",onClick:y.collapseSmallTable},null,8,["label","icon","color","onClick"]),(0,l.bF)(F,{dense:"",push:"",label:y.isAllLock?e.$t("unlockall"):e.$t("lockall"),icon:y.isAllLock?"sym_r_lock":"sym_r_lock_open",onClick:t[4]||(t[4]=e=>y.isAllLock?y.unLockAll():y.lockAll()),color:y.isAllLock?"blue":"grey"},null,8,["label","icon","color"])])])])),body:(0,l.k6)((t=>[(0,l.bF)(N,{props:t},{default:(0,l.k6)((()=>[(0,l.bF)($,{key:"consignmentCode",props:t,class:"input-row"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(t.row.code),1)])),_:2},1032,["props"]),(0,l.bF)($,{key:"received_date",props:t,class:"input-row"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(t.row.received_date),1)])),_:2},1032,["props"]),(0,l.bF)($,{key:"customer",props:t,class:"input-row truncate-cell"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(t.row.customer),1)])),_:2},1032,["props"]),(0,l.bF)($,{key:"company",props:t,class:"input-row truncate-cell"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(t.row.company),1)])),_:2},1032,["props"]),(0,l.bF)($,{key:"total_weight",props:t,class:"input-row"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(y.formatWeight(t.row.total_weight)),1)])),_:2},1032,["props"]),(0,l.bF)($,{key:"total_amount",props:t,class:"input-row"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(y.formatCurrency(t.row.total_amount)),1)])),_:2},1032,["props"]),(0,l.bF)($,{key:"action",props:t,style:{width:"120px"}},{default:(0,l.k6)((()=>[(0,l.bF)(F,{round:"",dense:"",color:t.row.isLock?"blue":"grey",icon:t.row.isLock?"sym_r_lock":"sym_r_lock_open",onClick:e=>t.row.isLock?y.onUnLock(t.row):y.onLock(t.row),title:t.row.isLock?"Unlock":"Lock"},null,8,["color","icon","onClick","title"]),t.row.isLock?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(F,{key:0,round:"",dense:"",color:"primary",icon:"sym_r_remove_selection",style:{"margin-left":"8px"},onClick:e=>y.removeSelection(t.row.id)},{default:(0,l.k6)((()=>[(0,l.bF)(q,(0,i._B)((0,l.Ng)(y.tooltip)),{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.$t("dispatch_planning.check_list.remove_selection")),1)])),_:1},16)])),_:2},1032,["onClick"]))])),_:2},1032,["props"])])),_:2},1032,["props"]),y.tableCollapse?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(N,{key:0},{default:(0,l.k6)((()=>[(0,l.bF)($,{colspan:y.columns.length},{default:(0,l.k6)((()=>[(0,l.bF)(V,{class:"my-sticky-header-small-table",rows:t.row.receive_goods_items||[],"row-key":"id",columns:y.goodsColumns,separator:"cell","hide-bottom":"",bordered:"","rows-per-page-options":[0]},{body:(0,l.k6)((e=>[(0,l.bF)(N,{props:e},{default:(0,l.k6)((()=>[(0,l.bF)($,{key:"goods_code",props:e,class:"input-row"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.row.goods_code),1)])),_:2},1032,["props"]),(0,l.bF)($,{key:"goods_name",props:e,class:"input-row truncate-cell"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.row.goods_name),1)])),_:2},1032,["props"]),(0,l.bF)($,{key:"goods_rate",props:e,class:"input-row"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(y.formatCurrency(e.row.goods_rate)),1)])),_:2},1032,["props"]),(0,l.bF)($,{key:"goods_weight",props:e,class:"input-row"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(y.formatWeight(e.row.goods_weight)),1)])),_:2},1032,["props"]),(0,l.bF)($,{key:"total_weight",props:e,class:"input-row"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(y.formatWeight(e.row.total_weight)),1)])),_:2},1032,["props"]),(0,l.bF)($,{key:"total_amount",props:e,class:"input-row"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(y.formatCurrency(e.row.total_amount)),1)])),_:2},1032,["props"]),(0,l.bF)($,{key:"quantity",props:e,class:"input-row"},{default:(0,l.k6)((()=>[t.row.isLock?((0,l.uX)(),(0,l.CE)("div",d,(0,i.v_)(e.row.quantity_loaded),1)):((0,l.uX)(),(0,l.CE)("div",u,[(0,l.bF)(D,{dense:"",type:"number",modelValue:e.row.quantity_loaded,"onUpdate:modelValue":[t=>e.row.quantity_loaded=t,()=>y.updateRow(e.row,t.row)],modelModifiers:{number:!0},min:0,max:e.row.remaining_quantity,disable:0===e.row.remaining_quantity,hint:0===e.row.remaining_quantity?"No remaining":"Min: 0, Max: "+e.row.remaining_quantity},null,8,["modelValue","onUpdate:modelValue","max","disable","hint"])]))])),_:2},1032,["props"])])),_:2},1032,["props"])])),_:2},1032,["rows","columns"])])),_:2},1032,["colspan"])])),_:2},1024))])),bottom:(0,l.k6)((()=>[(0,l.Lk)("div",p,[(0,l.Lk)("div",_,[(0,l.eW)((0,i.v_)(e.$t("dispatch_planning.check_list.totalItems"))+": ",1),(0,l.Lk)("span",null,(0,i.v_)(y.countConsignment),1)]),(0,l.Lk)("div",m,[(0,l.eW)((0,i.v_)(e.$t("dispatch_planning.check_list.grandTotalWeight"))+": ",1),(0,l.Lk)("span",null,(0,i.v_)(y.formatWeight(y.grandTotal.weight)),1)]),(0,l.Lk)("div",g,[(0,l.eW)((0,i.v_)(e.$t("dispatch_planning.check_list.grandTotalAmount"))+": ",1),(0,l.Lk)("span",null,(0,i.v_)(y.formatCurrency(y.grandTotal.amount)),1)]),(0,l.Lk)("div",null,[(0,l.bF)(F,{label:e.$t("dispatching.submit"),icon:"sym_r_send",style:{"background-color":"#21ba45",color:"white"},onClick:y.confirmSubmit,disable:!y.canSubmit||y.loading,unelevated:""},null,8,["label","onClick","disable"])])])])),_:1},8,["rows","loading","columns","pagination"])])),_:1}),(0,l.bF)(Q,{modelValue:y.removeDlg,"onUpdate:modelValue":t[7]||(t[7]=e=>y.removeDlg=e)},{default:(0,l.k6)((()=>[(0,l.bF)(z,{style:{"min-width":"400px"}},{default:(0,l.k6)((()=>[(0,l.bF)(K,null,{default:(0,l.k6)((()=>[(0,l.Lk)("div",k,(0,i.v_)(e.$t("confirmRemove")),1),(0,l.Lk)("div",h,[(0,l.eW)((0,i.v_)(e.$t("removeConfirmationTip"))+" ",1),(0,l.Lk)("strong",null,(0,i.v_)(y.removeTarget?.code||"this consignment"),1),(0,l.eW)(" "+(0,i.v_)(e.$t("fromList")),1)])])),_:1}),(0,l.bF)(R,{align:"right"},{default:(0,l.k6)((()=>[(0,l.bo)((0,l.bF)(F,{flat:"",label:e.$t("cancel"),onClick:t[6]||(t[6]=e=>y.removeDlg=!1)},null,8,["label"]),[[U]]),(0,l.bF)(F,{color:"primary",label:e.$t("remove"),onClick:y.confirmRemove},null,8,["label","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,l.bF)(Q,{modelValue:y.confirmDlg,"onUpdate:modelValue":t[9]||(t[9]=e=>y.confirmDlg=e)},{default:(0,l.k6)((()=>[(0,l.bF)(z,{style:{"min-width":"420px"}},{default:(0,l.k6)((()=>[(0,l.bF)(K,null,{default:(0,l.k6)((()=>[(0,l.Lk)("div",v,(0,i.v_)(e.$t("dispatch_planning.check_list.confirm_dispatch")),1),(0,l.Lk)("div",f,(0,i.v_)(e.$t("dispatch_planning.check_list.confirm_message")),1),(0,l.Lk)("ul",b,[(0,l.Lk)("li",null,[(0,l.eW)((0,i.v_)(e.$t("dispatch_planning.check_list.package_locked"))+": ",1),(0,l.Lk)("strong",null,(0,i.v_)(y.dispatchList.length),1)]),(0,l.Lk)("li",null,[(0,l.eW)((0,i.v_)(e.$t("dispatch_planning.check_list.grandTotalAmount"))+": ",1),(0,l.Lk)("strong",null,(0,i.v_)(y.formatCurrency(y.grandTotal.amount)),1)]),(0,l.Lk)("li",null,[(0,l.eW)((0,i.v_)(e.$t("dispatch_planning.check_list.grandTotalWeight"))+": ",1),(0,l.Lk)("strong",null,(0,i.v_)(y.formatWeight(y.grandTotal.weight)),1)])])])),_:1}),(0,l.bF)(R,{align:"right"},{default:(0,l.k6)((()=>[(0,l.bo)((0,l.bF)(F,{flat:"",label:"Cancel",onClick:t[8]||(t[8]=e=>y.confirmDlg=!1)},null,512),[[U]]),(0,l.bF)(F,{unelevated:"",color:"primary",label:"Confirm",onClick:y.doSubmit},null,8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])}o(310),o(317),o(5962),o(1308),o(95),o(6724),o(2802),o(9240);var w=o(555),L=o(4907),q=o(1271),F=o(3537),C=o(2261),x=o(455),A=o(7144);const S={name:"PageDispatching",setup(){const e=(0,L.A)(),{t}=(0,F.s9)(),o=(0,x.rd)(),a=(0,w.KR)((new Date).toISOString().slice(0,10)),i=(0,w.KR)(q.A.getItem("SelectedUnloadedGoods")||null),n=(0,w.KR)([]),r=(0,w.KR)(0),s=(0,w.Kh)({amount:0,weight:0}),c=(0,w.KR)([]),d=(0,w.KR)([]),u=(0,w.KR)(null),p=(0,w.KR)(null),_=(0,w.KR)([]),m=(0,w.KR)([]),g=(0,w.KR)(!1),k=(0,w.KR)(e.screen.height-290+"px"),h=(0,w.KR)([]),v=(0,w.KR)(!1),f=(0,w.KR)(!1),b=(0,w.KR)(!1),y=(0,w.KR)(null),S=e=>{const t=n.value.findIndex((t=>t.id===e));-1!==t&&(y.value=n.value[t],b.value=!0)},W=()=>{if(!y.value)return;const o=n.value.findIndex((e=>e.id===y.value.id));-1!==o&&(n.value[o].isLock&&Y(n.value[o]),n.value.splice(o,1),j(),e.notify({message:t("successful.remove")||"Removed",color:"positive",icon:"sym_r_check"})),b.value=!1,y.value=null},D={class:"bg-blue text-white shadow-4",offset:[10,10],contentStyle:"font-size: 12px"},T=(0,w.KR)(!1),$=(0,w.Kh)({page:1,rowsPerPage:30}),N=(0,w.KR)(!0);function V(){N.value=!0}function K(){N.value=!1}function R(){N.value=!0,p.value=null}const z=(0,w.Kh)([{name:"consignmentCode",label:t("dispatch_planning.check_list.code"),field:"consignmentCode",align:"center",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999",sortable:!0},{name:"received_date",label:t("dispatch_planning.check_list.received_date"),field:"received_date",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"customer",label:t("dispatch_planning.check_list.customer"),field:"customer",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"company",label:t("dispatch_planning.check_list.company"),field:"company",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"total_weight",label:t("dispatch_planning.check_list.total_weight"),field:"total_weight",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"total_amount",label:t("dispatch_planning.check_list.total_amount"),field:"total_amount",align:"left",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"},{name:"action",label:t("action"),align:"center",headerStyle:"font-weight: bold; font-size: 13px; z-index: 999"}]),Q=(0,w.Kh)([{name:"goods_code",label:t("dispatch_planning.check_list.goods_code"),field:"goods_code",align:"center",headerStyle:"font-weight: bold; font-size: 13px"},{name:"goods_name",label:t("dispatch_planning.check_list.goods_name"),field:"goods_name",align:"left",headerStyle:"font-weight: bold; font-size: 13px"},{name:"goods_rate",label:t("dispatch_planning.check_list.goods_rate")+" (Ks)",field:"goods_rate",align:"left",headerStyle:"font-weight: bold; font-size: 13px"},{name:"goods_weight",label:t("dispatch_planning.check_list.goods_weight")+" (Viss)",field:"goods_weight",align:"left",headerStyle:"font-weight: bold; font-size: 13px"},{name:"total_weight",label:t("dispatch_planning.check_list.total_weight")+" (Viss)",field:"w_total",align:"left",headerStyle:"font-weight: bold; font-size: 13px"},{name:"total_amount",label:t("dispatch_planning.check_list.total_amount")+" (Ks)",field:"total",align:"left",headerStyle:"font-weight: bold; font-size: 13px"},{name:"quantity",label:t("dispatch_planning.check_list.quantity"),field:"quantity",align:"center",headerStyle:"font-weight: bold; font-size: 13px"}]),U=(0,l.EW)((()=>{const e=!!u.value,t=h.value.some((e=>Array.isArray(e.receive_goods_items)&&e.receive_goods_items.some((e=>Number(e.quantity_loaded)>0))));return e&&t})),I=(0,l.EW)((()=>U.value)),P=(e,t)=>{t(""!==e?()=>{d.value=c.value.filter((t=>t.truck_number.toLowerCase().indexOf(e.toLowerCase())>-1))}:()=>{d.value=c.value})},E=(e,t)=>{t(""!==e?()=>{d.value=_.value.filter((t=>t.full_name.toLowerCase().indexOf(e.toLowerCase())>-1))}:()=>{m.value=_.value})},O=new Intl.NumberFormat("en-US",{maximumFractionDigits:2}),X=e=>{const o=Number(e||0);return O.format(o)+" "+t("ks")},B=e=>{const o=Number(e||0);return O.format(o)+" "+t("vs")},M=async()=>{if(!i.value)return n.value=[],void j();try{g.value=!0,await(0,A.e7)("truck"),c.value=q.A.getItem("truck",[]),d.value=c.value,await(0,A.e7)("truckdriver"),_.value=q.A.getItem("truckdriver",[]),m.value=_.value,n.value=i.value||[],j(),e.notify({message:t("successful.fetch")||"Data fetched",color:"positive",icon:"sym_r_check"})}catch(o){console.error("getList error",o),e.notify({message:t("error.error"),color:"negative",icon:"sym_r_close"})}finally{g.value=!1}},G=()=>{ee(),M()},H=(t,o)=>{Number.isFinite(t.quantity_loaded)||(t.quantity_loaded=0),t.quantity_loaded<0&&(t.quantity_loaded=0),t.quantity_loaded>t.remaining_quantity&&(t.quantity_loaded=t.remaining_quantity,e.notify({message:`Quantity cannot exceed ${t.remaining_quantity}.`,color:"negative",icon:"sym_r_error"}));const l=Number(t.goods_rate||0),a=Number(t.goods_weight||0);t.total_amount=l*(t.quantity_loaded||0),t.total_weight=a*(t.quantity_loaded||0),o.total_amount=o.receive_goods_items.reduce(((e,t)=>e+(t.total_amount||0)),0),o.total_weight=o.receive_goods_items.reduce(((e,t)=>e+(t.total_weight||0)),0),j()},j=()=>{s.amount=n.value.reduce(((e,t)=>e+(Number(t.total_amount)||0)),0),s.weight=n.value.reduce(((e,t)=>e+(Number(t.total_weight)||0)),0),r.value=n.value.length},J=o=>{const l=o.receive_goods_items.every((e=>{let t=Number(e.quantity_loaded||0);const o=Number(e.remaining_quantity||0);return(!Number.isFinite(t)||t<0)&&(e.quantity_loaded=0),t>o&&(t=o,e.quantity_loaded=o),t>=0&&t<=o}));if(!l)return void e.notify({message:t("dispatch_planning.check_list.invalid_quantities")||"Invalid quantities detected.",color:"negative",icon:"sym_r_error"});const a=o.receive_goods_items.some((e=>Number(e.quantity_loaded)>0));a?(o.isLock=!0,h.value.some((e=>e.id===o.id))||h.value.push(o),te(),j(),e.notify({message:t("successful.lock")||`Locked package ${o.id}`,color:"positive"})):e.notify({message:t("dispatch_planning.check_list.no_positive_quantity")||"Set at least one quantity > 0 before locking.",color:"negative",icon:"sym_r_error"})},Y=t=>{t.isLock=!1;const o=h.value.findIndex((e=>e.id===t.id));-1!==o&&h.value.splice(o,1),te(),j(),e.notify({message:`Unlocked package ${t.id}`,color:"info"})},Z=()=>{for(const o of n.value){const l=o.receive_goods_items||[],a=l.some((e=>{const t=Number(e.quantity_loaded||0),o=Number(e.remaining_quantity||0);return!Number.isFinite(t)||t<0||t>o}));if(a)return void e.notify({message:t("dispatching.lockall_invalid")||"Cannot lock: invalid quantities",color:"negative"});const i=l.some((e=>Number(e.quantity_loaded)>0));if(!i)return void e.notify({message:t("dispatching.lockall_require_positive")||"Each package must have at least one item quantity > 0 to lock all.",color:"negative"})}n.value.forEach((e=>{e.isLock=!0,h.value.some((t=>t.id===e.id))||h.value.push(e)})),te(),j(),e.notify({message:t("successful.lock_all")||"All locked",color:"positive"})},ee=()=>{n.value.forEach((e=>e.isLock=!1)),h.value=[],te(),j(),e.notify({message:"All unlocked",color:"info"})},te=()=>{v.value=n.value.length>0&&n.value.every((e=>!!e.isLock))},oe=()=>{I.value?f.value=!0:e.notify({message:t("dispatching.lockalltip")||"Lock packages and set truck before submitting",color:"negative"})},le=e=>{const t=Array.isArray(e)?e:[e];return t.flatMap((e=>Array.isArray(e?.receive_goods_items)?e.receive_goods_items.filter((e=>Number(e.quantity_loaded)>0)).map((e=>({receive_goods:e?.receive_goods_id??null,total_weight:e?.total_weight??null,total_amount:e?.total_amount??null,quantity_loaded:e?.quantity_loaded??null}))):[]))},ae=async()=>{f.value=!1,e.loading.show();try{const l=h.value.filter((e=>Array.isArray(e.receive_goods_items)&&e.receive_goods_items.some((e=>Number(e.quantity_loaded)>0)))),i=le(l);if(!l.length||!i.length)throw new Error(t("dispatch_planning.check_list.empty_dispatch")||"No items with positive quantity to dispatch.");const n=u.value&&(u.value??u.value);if(!n)throw new Error(t("dispatch_planning.check_list.select_truck")||"Please select a truck.");const r={dispatch_date:a.value.replace(/\//g,"-"),truck:n,truck_driver:p.value,total_amount:s.amount,total_weight:s.weight,consignment_data:i,consignment_ids:l.map((e=>e.id))},c=await(0,C.postauth)("truckdispatch/",r),d="consignment_unloaded_cache_v1";if(q.A.remove(d),"200"!==c.code)throw new Error(t("dispatch_planning.check_list.err_dispatch")||"Dispatch failed");q.A.remove("SelectedUnloadedGoods"),o.push({name:"TruckDispatchList"}),q.A.set("pending_link_change","TruckDispatch"),e.notify({message:t("successful.create"),color:"positive",icon:"sym_r_check"})}catch(o){e.notify({message:`${t("error.error")||"Error"}: ${o.message||o}`,color:"negative"})}finally{e.loading.hide(),g.value=!1}},ie=()=>{T.value=!T.value};return(0,l.sV)((()=>M())),{date:a,tableList:n,countConsignment:r,grandTotal:s,truck:u,truckDriver:p,filterTruckDriver:E,truckDriverFilteredOptions:m,truckDriverList:_,loading:g,height:k,dispatchList:h,isAllLock:v,pagination:$,columns:z,goodsColumns:Q,isFormValid:U,canSubmit:I,filterTruck:P,getList:M,reFresh:G,onLock:J,onUnLock:Y,lockAll:Z,unLockAll:ee,checkLock:te,truckFilteredOptions:d,confirmDlg:f,confirmSubmit:oe,doSubmit:ae,updateRow:H,UpdateTotal:j,router:o,t,formatCurrency:X,formatWeight:B,collapseSmallTable:ie,tableCollapse:T,tooltip:D,removeSelection:S,confirmRemove:W,removeDlg:b,removeTarget:y,truckList:c,truckDriverUseInput:N,onTruckDriverPopupShow:V,onTruckDriverSelected:K,onTruckDriverCleared:R}}};var W=o(2807),D=o(6653),T=o(6031),$=o(6384),N=o(7410),V=o(4940),K=o(9270),R=o(492),z=o(1356),Q=o(8462),U=o(6760),I=o(4488),P=o(5262),E=o(2156),O=o(3316),X=o(4189),B=o(2669),M=o(8672),G=o(8582),H=o.n(G);const j=(0,W.A)(S,[["render",y],["__scopeId","data-v-5979506c"]]),J=j;H()(S,"components",{QTable:D.A,QBtnGroup:T.A,QBtn:$.A,QTooltip:N.A,QSelect:V.A,QInput:K.A,QIcon:R.A,QPopupProxy:z.A,QDate:Q.A,QChip:U.A,QTr:I.A,QTd:P.A,QDialog:E.A,QCard:O.A,QCardSection:X.A,QCardActions:B.A}),H()(S,"directives",{ClosePopup:M.A})}}]);